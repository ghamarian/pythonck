<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sweep Tile - Elegant Iteration – Tile Distribution Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-038ebe7de1ad581fc619d66ba7f7845b.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-9cae0046c5fab5900eed4751693c39dd.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-038ebe7de1ad581fc619d66ba7f7845b.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-185961ed47a39db2ff9d8581d2d02664.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-1f647ac581ac6b74d75948daead8752e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-185961ed47a39db2ff9d8581d2d02664.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({ 
        startOnLoad: true,
        theme: 'default',
        themeVariables: {
            primaryColor: '#f0f7ff',
            primaryTextColor: '#1e293b',
            primaryBorderColor: '#2563eb',
            lineColor: '#6b7280',
            secondaryColor: '#fef3e2',
            tertiaryColor: '#f0fdf4',
            background: '#ffffff',
            mainBkg: '#f0f7ff',
            secondBkg: '#fef3e2',
            tertiaryBkg: '#f0fdf4',
            primaryTextColor: '#1e293b',
            fontSize: '16px'
        }
    });
});
</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../global-font-override.css">
<link rel="stylesheet" href="../diagram-sizing-fixes.css">
</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../concepts/03_tile_distribution.html">Distribution API</a></li><li class="breadcrumb-item"><a href="../concepts/03_sweep_tile.html">Sweep Tile - Elegant Iteration</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Tile Distribution Documentation</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Distribution Documentation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/00_introduction_motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction and Motivation - Why Tile Distribution Matters</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/01_buffer_view.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Buffer Views - Raw Memory Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/01_tensor_view.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Views - Multi-Dimensional Structure</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Transformation Engine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_tensor_coordinates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Coordinates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Individual Transforms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_adaptors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Adaptors - Chaining Transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_descriptors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Descriptors - Complete Tensor Specifications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_convolution_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Convolution Implementation with Tensor Descriptors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_coordinate_movement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Coordinate Operations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Distribution API</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/03_tile_distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Distribution - The Core API</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/03_tile_window.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Window - Data Access Gateway</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/03_sweep_tile.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Sweep Tile - Elegant Iteration</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Coordinate Systems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/04_coordinate_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Coordinate Systems - The Mathematical Foundation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Implementation Deep Dive</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/05_encoding_internals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Encoding Internals - The Internal Machinery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/05_static_distributed_tensor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static Distributed Tensor - Thread-Local Data Containers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Thread Mapping</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/06_thread_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Thread Mapping - Connecting to Hardware</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#basic-sweep-mechanism" id="toc-basic-sweep-mechanism" class="nav-link" data-scroll-target="#basic-sweep-mechanism">Basic Sweep Mechanism</a></li>
  <li><a href="#setup-pytensor-path-for-pyodide-environment" id="toc-setup-pytensor-path-for-pyodide-environment" class="nav-link" data-scroll-target="#setup-pytensor-path-for-pyodide-environment">Setup pytensor path for pyodide environment</a></li>
  <li><a href="#add-the-project-root-to-path-so-we-can-import-pytensor" id="toc-add-the-project-root-to-path-so-we-can-import-pytensor" class="nav-link" data-scroll-target="#add-the-project-root-to-path-so-we-can-import-pytensor">Add the project root to path so we can import pytensor</a></li>
  <li><a href="#import-the-actual-ck-modules" id="toc-import-the-actual-ck-modules" class="nav-link" data-scroll-target="#import-the-actual-ck-modules">Import the actual CK modules</a>
  <ul class="collapse">
  <li><a href="#without-sweep-operations" id="toc-without-sweep-operations" class="nav-link" data-scroll-target="#without-sweep-operations">Without Sweep Operations</a></li>
  <li><a href="#with-sweep-operations" id="toc-with-sweep-operations" class="nav-link" data-scroll-target="#with-sweep-operations">With Sweep Operations</a></li>
  <li><a href="#basic-sweep-operations" id="toc-basic-sweep-operations" class="nav-link" data-scroll-target="#basic-sweep-operations">Basic Sweep Operations</a></li>
  <li><a href="#the-power-of-sweeptile" id="toc-the-power-of-sweeptile" class="nav-link" data-scroll-target="#the-power-of-sweeptile">The Power of SweepTile</a>
  <ul class="collapse">
  <li><a href="#memory-efficiency" id="toc-memory-efficiency" class="nav-link" data-scroll-target="#memory-efficiency">1. Memory Efficiency</a></li>
  <li><a href="#code-example" id="toc-code-example" class="nav-link" data-scroll-target="#code-example">2. Code Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#demonstrate-sweep-operation" id="toc-demonstrate-sweep-operation" class="nav-link" data-scroll-target="#demonstrate-sweep-operation">Demonstrate sweep operation</a></li>
  <li><a href="#perform-the-sweep" id="toc-perform-the-sweep" class="nav-link" data-scroll-target="#perform-the-sweep">Perform the sweep</a>
  <ul class="collapse">
  <li><a href="#c-implementation-reference" id="toc-c-implementation-reference" class="nav-link" data-scroll-target="#c-implementation-reference">C++ Implementation Reference</a></li>
  <li><a href="#sweep-with-computation" id="toc-sweep-with-computation" class="nav-link" data-scroll-target="#sweep-with-computation">Sweep with Computation</a></li>
  <li><a href="#c-implementation-pattern" id="toc-c-implementation-pattern" class="nav-link" data-scroll-target="#c-implementation-pattern">C++ Implementation Pattern</a></li>
  <li><a href="#sweep-patterns" id="toc-sweep-patterns" class="nav-link" data-scroll-target="#sweep-patterns">Sweep Patterns</a>
  <ul class="collapse">
  <li><a href="#pattern-1-simple-linear-sweep" id="toc-pattern-1-simple-linear-sweep" class="nav-link" data-scroll-target="#pattern-1-simple-linear-sweep">Pattern 1: Simple Linear Sweep</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#create-result-tensor" id="toc-create-result-tensor" class="nav-link" data-scroll-target="#create-result-tensor">Create result tensor</a></li>
  <li><a href="#perform-computation-sweep" id="toc-perform-computation-sweep" class="nav-link" data-scroll-target="#perform-computation-sweep">Perform computation sweep</a>
  <ul class="collapse">
  <li><a href="#pattern-2-strided-sweep" id="toc-pattern-2-strided-sweep" class="nav-link" data-scroll-target="#pattern-2-strided-sweep">Pattern 2: Strided Sweep</a></li>
  <li><a href="#pattern-3-block-sweep" id="toc-pattern-3-block-sweep" class="nav-link" data-scroll-target="#pattern-3-block-sweep">Pattern 3: Block Sweep</a></li>
  <li><a href="#performance-characteristics" id="toc-performance-characteristics" class="nav-link" data-scroll-target="#performance-characteristics">Performance Characteristics</a></li>
  <li><a href="#advanced-sweep-features" id="toc-advanced-sweep-features" class="nav-link" data-scroll-target="#advanced-sweep-features">Advanced Sweep Features</a>
  <ul class="collapse">
  <li><a href="#conditional-sweep" id="toc-conditional-sweep" class="nav-link" data-scroll-target="#conditional-sweep">1. Conditional Sweep</a></li>
  <li><a href="#multi-dimensional-sweep" id="toc-multi-dimensional-sweep" class="nav-link" data-scroll-target="#multi-dimensional-sweep">2. Multi-Dimensional Sweep</a></li>
  <li><a href="#sweep-with-accumulation" id="toc-sweep-with-accumulation" class="nav-link" data-scroll-target="#sweep-with-accumulation">3. Sweep with Accumulation</a></li>
  </ul></li>
  <li><a href="#integration-with-tile-distribution" id="toc-integration-with-tile-distribution" class="nav-link" data-scroll-target="#integration-with-tile-distribution">Integration with Tile Distribution</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#create-test-distributed-tensor" id="toc-create-test-distributed-tensor" class="nav-link" data-scroll-target="#create-test-distributed-tensor">Create test distributed tensor</a></li>
  <li><a href="#fill-with-test-data" id="toc-fill-with-test-data" class="nav-link" data-scroll-target="#fill-with-test-data">Fill with test data</a></li>
  <li><a href="#method-1-manual-loops-the-old-way" id="toc-method-1-manual-loops-the-old-way" class="nav-link" data-scroll-target="#method-1-manual-loops-the-old-way">Method 1: Manual loops (the old way)</a></li>
  <li><a href="#method-2-sweep-operations-the-ck-way" id="toc-method-2-sweep-operations-the-ck-way" class="nav-link" data-scroll-target="#method-2-sweep-operations-the-ck-way">Method 2: Sweep operations (the CK way)</a>
  <ul class="collapse">
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../concepts/03_tile_distribution.html">Distribution API</a></li><li class="breadcrumb-item"><a href="../concepts/03_sweep_tile.html">Sweep Tile - Elegant Iteration</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Sweep Tile - Elegant Iteration</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Sweep operations are the elegant way to iterate over distributed data. They complete the tile distribution workflow by providing clean, efficient iteration patterns that automatically handle all the complex indexing details.</p>
<div>
<div id="pyodide-1" class="exercise-cell">

</div>
<script type="pyodide-1-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwib3V0cHV0IjpmYWxzZX0sImNvZGUiOiJcbiMgQXV0by1pbnN0YWxsIHB5dGhvbmNrIHBhY2thZ2VcbmltcG9ydCBtaWNyb3BpcFxuYXdhaXQgbWljcm9waXAuaW5zdGFsbChcImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9naGFtYXJpYW4vcHl0aG9uY2svbWFzdGVyL2RvY3VtZW50YXRpb24vcHl0aG9uY2stMC4xLjAtcHkzLW5vbmUtYW55LndobFwiKSJ9
</script>
</div>
</section>
<section id="basic-sweep-mechanism" class="level2">
<h2 class="anchored" data-anchor-id="basic-sweep-mechanism">Basic Sweep Mechanism</h2>
<div class="mermaid">
flowchart LR
    subgraph "X-Tile (Reused)"
        XT["X data loaded once<br>Stays in registers"]
    end
    
    subgraph "Y-Sweep"
        Y1["Y position 0"]
        Y2["Y position 1"]
        Y3["Y position 2"]
        YN["Y position N"]
    end
    
    subgraph "Computation"
        C["Process(X, Y)"]
    end
    
    XT --&gt; C
    Y1 --&gt; C
    Y2 --&gt; C
    Y3 --&gt; C
    YN --&gt; C
    
    style XT fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style C fill:#e0e7ff,stroke:#4338ca,stroke-width:2px
</div>
<p>The key insight: Load X data once, then sweep through Y positions while keeping X in fast memory.</p>
</section>
<section id="setup-pytensor-path-for-pyodide-environment" class="level1">
<h1>Setup pytensor path for pyodide environment</h1>
<p>import sys import os import numpy as np</p>
</section>
<section id="add-the-project-root-to-path-so-we-can-import-pytensor" class="level1">
<h1>Add the project root to path so we can import pytensor</h1>
<p>sys.path.insert(0, ‘/home/aghamari/github/composable_kernel/visualisation’)</p>
</section>
<section id="import-the-actual-ck-modules" class="level1">
<h1>Import the actual CK modules</h1>
<p>from pytensor.tile_distribution import make_static_tile_distribution, make_tile_distribution_encoding from pytensor.tile_window import make_tile_window from pytensor.tensor_view import make_tensor_view from pytensor.tensor_descriptor import make_naive_tensor_descriptor_packed from pytensor.static_distributed_tensor import make_static_distributed_tensor from pytensor.sweep_tile import sweep_tile, make_tile_sweeper</p>
<pre><code>
## What are Sweep Operations?

Sweep operations are the final piece of the distributed computing puzzle:

**The Challenge**: You have distributed data loaded via TileWindow. Now you need to process every element. How do you iterate elegantly?

**The Solution**: Sweep operations provide clean iteration patterns that handle all the complex indexing automatically.

## The Complete GPU Processing Pipeline

```{mermaid}
flowchart LR
    subgraph "Data Distribution"
        TD[Tile Distribution&lt;br/&gt;Work Assignment]
        TW[Tile Window&lt;br/&gt;Data Loading]
    end
    
    subgraph "Processing"
        SW[Sweep Operations&lt;br/&gt;Element Iteration]
        UC[User Computation&lt;br/&gt;Lambda Function]
    end
    
    subgraph "Memory"
        GM[Global Memory]
        R[Registers]
    end
    
    TD --&gt; TW
    TW --&gt; |load()| R
    R --&gt; SW
    SW --&gt; |foreach| UC
    UC --&gt; |store()| GM
    
    style TD fill:#e3f2fd
    style TW fill:#fff3e0
    style SW fill:#e8f5e9
    style UC fill:#fce4ec</code></pre>
<section id="without-sweep-operations" class="level3">
<h3 class="anchored" data-anchor-id="without-sweep-operations">Without Sweep Operations</h3>
<ul>
<li>Manual nested loops over Y dimensions</li>
<li>Complex index calculations</li>
<li>Easy to miss elements or double-process</li>
<li>Different code for different access patterns</li>
</ul>
</section>
<section id="with-sweep-operations" class="level3">
<h3 class="anchored" data-anchor-id="with-sweep-operations">With Sweep Operations</h3>
<ul>
<li>Elegant lambda-based iteration</li>
<li>Automatic handling of all elements</li>
<li>Same pattern for any distribution</li>
<li>Compiler-optimizable</li>
</ul>
<p><strong>Key Insight</strong>: Sweep operations are like forEach() for distributed tensors. Give them a function, and they’ll call it for every element in the optimal order.</p>
</section>
<section id="basic-sweep-operations" class="level2">
<h2 class="anchored" data-anchor-id="basic-sweep-operations">Basic Sweep Operations</h2>
<p>Let’s start with the simplest sweep pattern:</p>
<div>
<div id="pyodide-2" class="exercise-cell">

</div>
<script type="pyodide-2-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5pbXBvcnQgbnVtcHkgYXMgbnBcblxuIyBTaW11bGF0ZSBhIHNpbXBsZSAyRCBzd2VlcCBvcGVyYXRpb25cbmRlZiBzaW11bGF0ZV9zd2VlcChtYXRyaXhfc2hhcGUsIHRpbGVfc2hhcGUpOlxuICAgIFwiXCJcIkRlbW9uc3RyYXRlIHN3ZWVwIGNvbmNlcHQgd2l0aCBhIHNpbXBsZSBtYXRyaXhcIlwiXCJcbiAgICBNLCBOID0gbWF0cml4X3NoYXBlXG4gICAgdGlsZV9tLCB0aWxlX24gPSB0aWxlX3NoYXBlXG4gICAgXG4gICAgcHJpbnQoZlwiTWF0cml4OiB7TX14e059LCBUaWxlOiB7dGlsZV9tfXh7dGlsZV9ufVwiKVxuICAgIHByaW50KGZcIk51bWJlciBvZiB0aWxlczogKHtNLy90aWxlX219LCB7Ti8vdGlsZV9ufSlcIilcbiAgICBwcmludCgpXG4gICAgXG4gICAgIyBGb3IgZWFjaCB0aWxlIHBvc2l0aW9uXG4gICAgZm9yIHRpbGVfaSBpbiByYW5nZSgwLCBNLCB0aWxlX20pOlxuICAgICAgICBmb3IgdGlsZV9qIGluIHJhbmdlKDAsIE4sIHRpbGVfbik6XG4gICAgICAgICAgICBwcmludChmXCJQcm9jZXNzaW5nIHRpbGUgYXQgKHt0aWxlX2l9LCB7dGlsZV9qfSk6XCIpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICMgTG9hZCBYLXRpbGUgKGNvbHVtbiBkYXRhKSAtIGhhcHBlbnMgb25jZVxuICAgICAgICAgICAgcHJpbnQoZlwiICBMb2FkIFgtdGlsZTogY29sdW1ucyB7dGlsZV9qfSB0byB7dGlsZV9qK3RpbGVfbi0xfVwiKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAjIFN3ZWVwIHRocm91Z2ggWSBwb3NpdGlvbnMgaW4gdGhpcyB0aWxlXG4gICAgICAgICAgICBmb3IgeSBpbiByYW5nZSh0aWxlX2ksIG1pbih0aWxlX2kgKyB0aWxlX20sIE0pKTpcbiAgICAgICAgICAgICAgICBwcmludChmXCIgICAgU3dlZXAgWT17eX06IHByb2Nlc3Mgcm93IHt5fSB3aXRoIGxvYWRlZCBjb2x1bW5zXCIpXG4gICAgICAgICAgICBwcmludCgpXG5cbiMgRXhhbXBsZTogNng4IG1hdHJpeCB3aXRoIDJ4NCB0aWxlc1xuc2ltdWxhdGVfc3dlZXAoKDYsIDgpLCAoMiwgNCkpIn0=
</script>
</div>
</section>
<section id="the-power-of-sweeptile" class="level2">
<h2 class="anchored" data-anchor-id="the-power-of-sweeptile">The Power of SweepTile</h2>
<section id="memory-efficiency" class="level3">
<h3 class="anchored" data-anchor-id="memory-efficiency">1. Memory Efficiency</h3>
<div class="mermaid">
graph TB
    subgraph "Traditional Approach"
        T1["Load X[0]"] --&gt; P1["Process"]
        T2["Load Y[0]"] --&gt; P1
        T3["Load X[0]"] --&gt; P2["Process"]
        T4["Load Y[1]"] --&gt; P2
        T5["Load X[0]"] --&gt; P3["Process"]
        T6["Load Y[2]"] --&gt; P3
        Note1["X loaded 3 times!"]
    end
    
    subgraph "Sweep Approach"
        S1["Load X[0]"] --&gt; SP["Process with<br>Y[0], Y[1], Y[2]"]
        S2["Load Y[0,1,2]"] --&gt; SP
        Note2["X loaded once!"]
    end
    
    style Note1 fill:#fee2e2,stroke:#ef4444,stroke-width:2px
    style Note2 fill:#d1fae5,stroke:#10b981,stroke-width:2px
</div>
</section>
<section id="code-example" class="level3">
<h3 class="anchored" data-anchor-id="code-example">2. Code Example</h3>
</section>
</section>
</section>
<section id="demonstrate-sweep-operation" class="level1">
<h1>Demonstrate sweep operation</h1>
<p>print(“Sweeping over distributed tensor:”)</p>
<p>collected_values = []</p>
<p>def collect_value(y_indices): “““Function to collect values during sweep.”“” value = distributed_tensor.get_element(y_indices) collected_values.append((y_indices.copy(), value)) print(f” Visited Y{y_indices}: value = {value}“)</p>
</section>
<section id="perform-the-sweep" class="level1">
<h1>Perform the sweep</h1>
<p>sweep_tile(distributed_tensor, collect_value)</p>
<p>print(f”completed! Visited {len(collected_values)} elements”)</p>
<pre><code>
### C++ Implementation Reference

The sweep operation pattern is implemented in CK using template functions:

**File**: `include/ck_tile/core/tensor/sweep_tile.hpp`

```cpp
// Basic sweep over distributed tensor
template &lt;typename DistributedTensor, typename Func&gt;
__device__ void sweep_tile(const DistributedTensor&amp; tensor, Func func)
{
    // Get Y-space spans for iteration
    constexpr auto spans = DistributedTensor::get_distributed_spans();
    
    // Iterate over all Y indices
    sweep_tile_spans(spans, [&amp;](auto y_indices) {
        // Call user function with current indices
        func(y_indices);
    });
}

// Example usage in kernel
__device__ void process_tile(const auto&amp; tile)
{
    // Sum all elements
    float sum = 0.0f;
    sweep_tile(tile, [&amp;](auto y_idx) {
        sum += tile(y_idx);
    });
}</code></pre>
<section id="c-implementation-reference" class="level3">
<h3 class="anchored" data-anchor-id="c-implementation-reference">C++ Implementation Reference</h3>
<p>The sweep operation pattern is implemented in CK using template functions:</p>
<p><strong>File</strong>: <code>include/ck_tile/core/tensor/sweep_tile.hpp</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Basic sweep over distributed tensor</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> DistributedTensor<span class="op">,</span> <span class="kw">typename</span> Func<span class="op">&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> sweep_tile<span class="op">(</span><span class="at">const</span> DistributedTensor<span class="op">&amp;</span> tensor<span class="op">,</span> Func func<span class="op">)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get Y-space spans for iteration</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> spans <span class="op">=</span> DistributedTensor<span class="op">::</span>get_distributed_spans<span class="op">();</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate over all Y indices</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    sweep_tile_spans<span class="op">(</span>spans<span class="op">,</span> <span class="op">[&amp;](</span><span class="kw">auto</span> y_indices<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Call user function with current indices</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        func<span class="op">(</span>y_indices<span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Example usage in kernel</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> process_tile<span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> tile<span class="op">)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sum all elements</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> sum <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    sweep_tile<span class="op">(</span>tile<span class="op">,</span> <span class="op">[&amp;](</span><span class="kw">auto</span> y_idx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> tile<span class="op">(</span>y_idx<span class="op">);</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>What happened?</strong> <code>sweep_tile</code> automatically iterated over all Y indices in the distributed tensor and called our function for each element. No manual loops, no missed elements!</p>
</section>
<section id="sweep-with-computation" class="level2">
<h2 class="anchored" data-anchor-id="sweep-with-computation">Sweep with Computation</h2>
<p>Let’s use sweep operations for actual computation:</p>
<div>
<div id="pyodide-3" class="exercise-cell">

</div>
<script type="pyodide-3-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG4jIENvbmNlcHR1YWwgc3dlZXAgaW1wbGVtZW50YXRpb25cbmNsYXNzIFN3ZWVwVGlsZVNpbXVsYXRpb246XG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGRhdGEsIHRpbGVfc2hhcGUpOlxuICAgICAgICBzZWxmLmRhdGEgPSBkYXRhXG4gICAgICAgIHNlbGYudGlsZV9zaGFwZSA9IHRpbGVfc2hhcGVcbiAgICAgICAgXG4gICAgZGVmIHN3ZWVwX2dlbW1fdGlsZShzZWxmLCB0aWxlX3JvdywgdGlsZV9jb2wpOlxuICAgICAgICBcIlwiXCJTaW11bGF0ZSBHRU1NIHN3ZWVwIGZvciBvbmUgdGlsZVwiXCJcIlxuICAgICAgICB0aWxlX20sIHRpbGVfbiA9IHNlbGYudGlsZV9zaGFwZVxuICAgICAgICBcbiAgICAgICAgIyBQaGFzZSAxOiBMb2FkIFggdGlsZSAoQSBtYXRyaXggY29sdW1ucylcbiAgICAgICAgcHJpbnQoZlwiTG9hZGluZyBBIHRpbGUgY29sdW1ucyB7dGlsZV9jb2x9IHRvIHt0aWxlX2NvbCArIHRpbGVfbiAtIDF9XCIpXG4gICAgICAgIGFfdGlsZSA9IHNlbGYuZGF0YVt0aWxlX3Jvdzp0aWxlX3Jvdyt0aWxlX20sIHRpbGVfY29sOnRpbGVfY29sK3RpbGVfbl1cbiAgICAgICAgXG4gICAgICAgICMgUGhhc2UgMjogU3dlZXAgdGhyb3VnaCBCIHJvd3NcbiAgICAgICAgcmVzdWx0cyA9IFtdXG4gICAgICAgIGZvciBiX3JvdyBpbiByYW5nZShzZWxmLmRhdGEuc2hhcGVbMF0pOlxuICAgICAgICAgICAgIyBJbiByZWFsIEdQVTogQiByb3cgZGF0YSBzdHJlYW1zIHRocm91Z2hcbiAgICAgICAgICAgIGJfZGF0YSA9IHNlbGYuZGF0YVtiX3JvdywgdGlsZV9jb2w6dGlsZV9jb2wrdGlsZV9uXVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAjIENvbXB1dGUgZG90IHByb2R1Y3RzXG4gICAgICAgICAgICBmb3IgYV9yb3cgaW4gcmFuZ2UoYV90aWxlLnNoYXBlWzBdKTpcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBucC5kb3QoYV90aWxlW2Ffcm93XSwgYl9kYXRhKVxuICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKCh0aWxlX3JvdyArIGFfcm93LCBiX3JvdywgcmVzdWx0KSlcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcblxuIyBFeGFtcGxlIHVzYWdlXG5kYXRhID0gbnAuYXJhbmdlKDE2KS5yZXNoYXBlKDQsIDQpXG5zd2VlcCA9IFN3ZWVwVGlsZVNpbXVsYXRpb24oZGF0YSwgKDIsIDIpKVxuXG5wcmludChcIkRhdGEgbWF0cml4OlwiKVxucHJpbnQoZGF0YSlcbnByaW50KFwiXFxuU3dlZXBpbmcgdGlsZSBhdCAoMCwgMCk6XCIpXG5yZXN1bHRzID0gc3dlZXAuc3dlZXBfZ2VtbV90aWxlKDAsIDApXG5mb3IgciBpbiByZXN1bHRzWzo0XTogICMgU2hvdyBmaXJzdCBmZXcgcmVzdWx0c1xuICAgIHByaW50KGZcIiAgUmVzdWx0W3tyWzBdfSx7clsxXX1dID0ge3JbMl19XCIpIn0=
</script>
</div>
</section>
<section id="c-implementation-pattern" class="level2">
<h2 class="anchored" data-anchor-id="c-implementation-pattern">C++ Implementation Pattern</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Sweep pattern for matrix multiplication</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> ADataType<span class="op">,</span> <span class="kw">typename</span> BDataType<span class="op">,</span> <span class="kw">typename</span> CDataType<span class="op">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> gemm_sweep_tile<span class="op">(</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> TileDistribution<span class="op">&amp;</span> dist_a<span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> TileDistribution<span class="op">&amp;</span> dist_b<span class="op">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    TileDistribution<span class="op">&amp;</span> dist_c<span class="op">)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 1: Load A tile into registers (X dimension)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_tile <span class="op">=</span> make_distributed_tensor<span class="op">(</span>dist_a<span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    a_tile<span class="op">.</span>load<span class="op">();</span>  <span class="co">// Load once, reuse many times</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 2: Create sweep for B (Y dimension)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_sweep <span class="op">=</span> make_sweep_tile<span class="op">(</span>dist_b<span class="op">);</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 3: Sweep through B positions</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    sweep_tile<span class="op">(</span>b_sweep<span class="op">,</span> <span class="op">[&amp;](</span><span class="kw">auto</span> b_slice<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// b_slice is current Y position data</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Compute C = A * B for this Y position</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> c_slice <span class="op">=</span> make_distributed_tensor<span class="op">(</span>dist_c<span class="op">);</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Actual computation</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        gemm<span class="op">(</span>a_tile<span class="op">,</span> b_slice<span class="op">,</span> c_slice<span class="op">);</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Store result</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        c_slice<span class="op">.</span>store<span class="op">();</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sweep-patterns" class="level2">
<h2 class="anchored" data-anchor-id="sweep-patterns">Sweep Patterns</h2>
<section id="pattern-1-simple-linear-sweep" class="level3">
<h3 class="anchored" data-anchor-id="pattern-1-simple-linear-sweep">Pattern 1: Simple Linear Sweep</h3>
<div class="mermaid">
graph LR
    subgraph "Linear Sweep"
        S0["Start"] --&gt; P0["Y[0]"]
        P0 --&gt; P1["Y[1]"]
        P1 --&gt; P2["Y[2]"]
        P2 --&gt; P3["Y[3]"]
        P3 --&gt; E["End"]
    end
    
    style S0 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style E fill:#ffebee,stroke:#d32f2f,stroke-width:2px
</div>
</section>
</section>
</section>
<section id="create-result-tensor" class="level1">
<h1>Create result tensor</h1>
<p>result_tensor = make_static_distributed_tensor(np.float32, distributed_tensor.tile_distribution)</p>
<p>print(“Sweep with Computation”) print(“=” * 30) print(“Computing squares using sweep:”) print()</p>
<p>def compute_square(y_indices): “““Compute square of each element.”“” input_value = distributed_tensor.get_element(y_indices) output_value = input_value ** 2 result_tensor.set_element(y_indices, output_value) print(f” Y{y_indices}: {input_value}² = {output_value}“)</p>
</section>
<section id="perform-computation-sweep" class="level1">
<h1>Perform computation sweep</h1>
<p>sweep_tile(distributed_tensor, compute_square)</p>
<p>print() print(“Results verification:”) def verify_result(y_indices): original = distributed_tensor.get_element(y_indices) computed = result_tensor.get_element(y_indices) expected = original ** 2 print(f” Y{y_indices}: {original} → {computed} (expected {expected})“)</p>
<p>sweep_tile(result_tensor, verify_result)</p>
<pre><code>
**Computation Pattern**: This is the classic pattern: sweep over input tensor, compute something, store in result tensor. The sweep handles all the iteration complexity automatically!

## Advanced Sweep Patterns

Let's explore more sophisticated sweep patterns:

```{pyodide}
#| echo: true
#| output: true

def linear_sweep(data, x_indices, y_range):
    """Simple linear sweep pattern"""
    # Load X data once
    x_data = data[:, x_indices]
    print(f"Loaded X data (shape {x_data.shape}):")
    print(x_data)
    
    # Sweep through Y
    print("\nSweeping Y positions:")
    for y in y_range:
        y_data = data[y, :]
        result = np.dot(x_data.T, y_data)
        print(f"  Y[{y}]: {y_data} → result: {result}")

# Example
data = np.arange(20).reshape(4, 5)
print("Original data:")
print(data)
# Create a larger distribution for more interesting patterns
encoding = make_tile_distribution_encoding(
    rs_lengths=[],
    hs_lengthss=[[4], [4]],  # 4x4 distribution
    ps_to_rhss_major=[[], []],
    ps_to_rhss_minor=[[], []],
    ys_to_rhs_major=[1, 2],
    ys_to_rhs_minor=[0, 0]
)
distribution = make_static_tile_distribution(encoding)
distributed_tensor = make_static_distributed_tensor(np.float32, distribution)

# Fill with test data
y_lengths = distribution.get_y_vector_lengths()
for y0 in range(y_lengths[0]):
    for y1 in range(y_lengths[1]):
        distributed_tensor.set_element([y0, y1], y0 * 4 + y1)

print("Created 4x4 distributed tensor with sequential values")
print()

# Pattern 1: Conditional processing
print("🎯 Pattern 1: Conditional Processing")
def process_even_values(y_indices):
    value = distributed_tensor.get_element(y_indices)
    if int(value) % 2 == 0:
        print(f"  Processing even value at Y{y_indices}: {value}")
    else:
        print(f"  Skipping odd value at Y{y_indices}: {value}")

sweep_tile(distributed_tensor, process_even_values)
print()

linear_sweep(data, [0, 2], range(4))
# Pattern 2: Accumulation
print("🎯 Pattern 2: Accumulation")
total_sum = 0
element_count = 0

def accumulate_values(y_indices):
    global total_sum, element_count
    value = distributed_tensor.get_element(y_indices)
    total_sum += value
    element_count += 1
    print(f"  Added {value}, running total: {total_sum}")

sweep_tile(distributed_tensor, accumulate_values)
print(f"Final sum: {total_sum}, average: {total_sum/element_count}")</code></pre>
<section id="pattern-2-strided-sweep" class="level3">
<h3 class="anchored" data-anchor-id="pattern-2-strided-sweep">Pattern 2: Strided Sweep</h3>
<div>
<div id="pyodide-4" class="exercise-cell">

</div>
<script type="pyodide-4-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgc3RyaWRlZF9zd2VlcChkYXRhLCB4X3RpbGUsIHlfc3RhcnQsIHlfc3RyaWRlLCB5X2NvdW50KTpcbiAgICBcIlwiXCJTd2VlcCB3aXRoIHN0cmlkZSAtIHVzZWZ1bCBmb3IgaW50ZXJsZWF2ZWQgZGF0YVwiXCJcIlxuICAgICMgTG9hZCBYIHRpbGVcbiAgICB4X2RhdGEgPSBkYXRhWzosIHhfdGlsZVswXTp4X3RpbGVbMV1dXG4gICAgcHJpbnQoZlwiWCB0aWxlOiBjb2x1bW5zIHt4X3RpbGVbMF19IHRvIHt4X3RpbGVbMV0tMX1cIilcbiAgICBcbiAgICAjIFN0cmlkZWQgc3dlZXAgdGhyb3VnaCBZXG4gICAgcHJpbnQoZlwiU3RyaWRlZCBzd2VlcDogc3RhcnQ9e3lfc3RhcnR9LCBzdHJpZGU9e3lfc3RyaWRlfSwgY291bnQ9e3lfY291bnR9XCIpXG4gICAgZm9yIGkgaW4gcmFuZ2UoeV9jb3VudCk6XG4gICAgICAgIHlfcG9zID0geV9zdGFydCArIGkgKiB5X3N0cmlkZVxuICAgICAgICBpZiB5X3BvcyA8IGRhdGEuc2hhcGVbMF06XG4gICAgICAgICAgICBwcmludChmXCIgIFByb2Nlc3MgWVt7eV9wb3N9XVwiKVxuXG4jIEV4YW1wbGU6IFByb2Nlc3MgZXZlcnkgb3RoZXIgcm93XG5kYXRhID0gbnAuYXJhbmdlKDI0KS5yZXNoYXBlKDYsIDQpXG5zdHJpZGVkX3N3ZWVwKGRhdGEsICgwLCAyKSwgeV9zdGFydD0wLCB5X3N0cmlkZT0yLCB5X2NvdW50PTMpIn0=
</script>
</div>
</section>
<section id="pattern-3-block-sweep" class="level3">
<h3 class="anchored" data-anchor-id="pattern-3-block-sweep">Pattern 3: Block Sweep</h3>
<div>
<div id="pyodide-5" class="exercise-cell">

</div>
<script type="pyodide-5-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgYmxvY2tfc3dlZXAoZGF0YSwgeF90aWxlLCB5X2Jsb2Nrcyk6XG4gICAgXCJcIlwiU3dlZXAgdGhyb3VnaCBibG9ja3Mgb2YgWSAtIHVzZWZ1bCBmb3IgY2FjaGUgb3B0aW1pemF0aW9uXCJcIlwiXG4gICAgcHJpbnQoZlwiWCB0aWxlIGxvYWRlZDogY29sdW1ucyB7eF90aWxlfVwiKVxuICAgIFxuICAgIGZvciBibG9ja19pZCwgeV9ibG9jayBpbiBlbnVtZXJhdGUoeV9ibG9ja3MpOlxuICAgICAgICBwcmludChmXCJcXG5CbG9jayB7YmxvY2tfaWR9OiBZW3t5X2Jsb2NrWzBdfTp7eV9ibG9ja1sxXX1dXCIpXG4gICAgICAgIGJsb2NrX2RhdGEgPSBkYXRhW3lfYmxvY2tbMF06eV9ibG9ja1sxXSwgOl1cbiAgICAgICAgcHJpbnQoZlwiICBQcm9jZXNzaW5nIHtibG9ja19kYXRhLnNoYXBlWzBdfSByb3dzIHRvZ2V0aGVyXCIpXG4gICAgICAgICMgSW4gR1BVOiBUaGlzIGJsb2NrIGZpdHMgaW4gc2hhcmVkIG1lbW9yeVxuXG4jIEV4YW1wbGU6IFByb2Nlc3MgWSBpbiBibG9ja3Mgb2YgMlxuZGF0YSA9IG5wLmFyYW5nZSgzMikucmVzaGFwZSg4LCA0KVxuYmxvY2tfc3dlZXAoZGF0YSwgWzAsIDJdLCBbKDAsIDIpLCAoMiwgNCksICg0LCA2KSwgKDYsIDgpXSkifQ==
</script>
</div>
</section>
<section id="performance-characteristics" class="level2">
<h2 class="anchored" data-anchor-id="performance-characteristics">Performance Characteristics</h2>
<div class="mermaid">
graph TB
    subgraph "Sweep Performance Benefits"
        B1["Zero runtime overhead<br>Compile-time unrolling"]
        B2["Perfect memory coalescing<br>Sequential access patterns"]
        B3["Automatic vectorization<br>Compiler optimizations"]
        B4["Register reuse<br>X data stays in VGPR"]
    end
    
    subgraph "Use Cases"
        U1["Matrix Multiplication<br>Reuse A columns"]
        U2["Convolution<br>Reuse filter weights"]
        U3["Reduction<br>Accumulate over Y"]
        U4["Broadcast<br>Apply X to all Y"]
    end
    
    B1 --&gt; Performance["High Performance"]
    B2 --&gt; Performance
    B3 --&gt; Performance
    B4 --&gt; Performance
    
    Performance --&gt; U1
    Performance --&gt; U2
    Performance --&gt; U3
    Performance --&gt; U4
    
    style Performance fill:#d1fae5,stroke:#10b981,stroke-width:3px
</div>
def complete_tile_processing(input_data, window_origin, window_size, operation_name, compute_func):
    """Complete tile processing with sweep operations."""
    print(f"🚀 {operation_name} Processing")
    print(f"   Input: {input_data.shape} matrix")
    print(f"   Window: {window_size} at {window_origin}")
    print()
    
    # 1. Setup tensor infrastructure
    tensor_desc = make_naive_tensor_descriptor_packed(list(input_data.shape))
    input_view = make_tensor_view(input_data, tensor_desc)
    
    # 2. Create distribution
    encoding = make_tile_distribution_encoding(
        rs_lengths=[],
        hs_lengthss=[[window_size[0]], [window_size[1]]],
        ps_to_rhss_major=[[], []],
        ps_to_rhss_minor=[[], []],
        ys_to_rhs_major=[1, 2],
        ys_to_rhs_minor=[0, 0]
    )
    distribution = make_static_tile_distribution(encoding)
    
    # 3. Create window and load data - automatically creates distributed tensor!
    input_window = make_tile_window(input_view, window_size, window_origin, distribution)
    distributed_input = input_window.load()
    
    # 4. Create output window and load for direct processing
    output_data = input_data.copy()
    output_view = make_tensor_view(output_data, tensor_desc)
    output_window = make_tile_window(output_view, window_size, window_origin, distribution)
    distributed_output = output_window.load()
    
    def process_with_sweep(y_indices):
        """Process each element using sweep."""
        input_val = distributed_input.get_element(y_indices)
        output_val = compute_func(input_val)
        distributed_output.set_element(y_indices, output_val)
        print(f"    Y{y_indices}: {input_val} → {output_val}")
    
    print("📊 Processing elements with sweep:")
    sweep_tile(distributed_input, process_with_sweep)
    
    # 5. Store results back
    output_window.store(distributed_output)
    
    return output_data

# Test the complete workflow
test_data = np.array([[1, 2, 3, 4], 
                     [5, 6, 7, 8], 
                     [9, 10, 11, 12], 
                     [13, 14, 15, 16]], dtype=np.float32)

print("Original data:")
print(test_data)
print()

# Process a 2x2 window with different operations
result1 = complete_tile_processing(test_data, [1, 1], [2, 2], "Square", lambda x: x ** 2)
print("\nAfter square operation:")
print(result1)
print()

result2 = complete_tile_processing(test_data, [0, 2], [2, 2], "Multiply by 10", lambda x: x * 10)
print("\nAfter multiply by 10 operation:")
print(result2)
</section>
<section id="advanced-sweep-features" class="level2">
<h2 class="anchored" data-anchor-id="advanced-sweep-features">Advanced Sweep Features</h2>
<section id="conditional-sweep" class="level3">
<h3 class="anchored" data-anchor-id="conditional-sweep">1. Conditional Sweep</h3>
<div>
<div id="pyodide-6" class="exercise-cell">

</div>
<script type="pyodide-6-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgY29uZGl0aW9uYWxfc3dlZXAoZGF0YSwgeF90aWxlLCBjb25kaXRpb25fZm4pOlxuICAgIFwiXCJcIlN3ZWVwIG9ubHkgcG9zaXRpb25zIHRoYXQgbWVldCBjb25kaXRpb25cIlwiXCJcbiAgICB4X2RhdGEgPSBkYXRhWzosIHhfdGlsZVswXTp4X3RpbGVbMV1dXG4gICAgXG4gICAgc3dlcHRfcG9zaXRpb25zID0gW11cbiAgICBmb3IgeSBpbiByYW5nZShkYXRhLnNoYXBlWzBdKTpcbiAgICAgICAgaWYgY29uZGl0aW9uX2ZuKHkpOlxuICAgICAgICAgICAgc3dlcHRfcG9zaXRpb25zLmFwcGVuZCh5KVxuICAgICAgICAgICAgIyBQcm9jZXNzIHRoaXMgWSBwb3NpdGlvblxuICAgICAgICAgICAgXG4gICAgcHJpbnQoZlwiU3dlcHQge2xlbihzd2VwdF9wb3NpdGlvbnMpfSBvZiB7ZGF0YS5zaGFwZVswXX0gcG9zaXRpb25zXCIpXG4gICAgcHJpbnQoZlwiUG9zaXRpb25zOiB7c3dlcHRfcG9zaXRpb25zfVwiKVxuXG4jIEV4YW1wbGU6IE9ubHkgcHJvY2VzcyBldmVuIHJvd3NcbmRhdGEgPSBucC5hcmFuZ2UoMjApLnJlc2hhcGUoNSwgNClcbmNvbmRpdGlvbmFsX3N3ZWVwKGRhdGEsICgwLCAyKSwgbGFtYmRhIHk6IHkgJSAyID09IDApIn0=
</script>
</div>
</section>
<section id="multi-dimensional-sweep" class="level3">
<h3 class="anchored" data-anchor-id="multi-dimensional-sweep">2. Multi-Dimensional Sweep</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// C++ example: 3D sweep for tensor operations</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> XTensor<span class="op">,</span> <span class="kw">typename</span> YTensor<span class="op">&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> tensor_3d_sweep<span class="op">(</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> XTensor<span class="op">&amp;</span> x_tensor<span class="op">,</span>    <span class="co">// 2D slice loaded</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> YTensor<span class="op">&amp;</span> y_tensor<span class="op">)</span>    <span class="co">// 3D tensor to sweep</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sweep through depth dimension</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> depth <span class="op">=</span> y_tensor<span class="op">.</span>get_shape<span class="op">()[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    static_for<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> depth<span class="op">,</span> <span class="dv">1</span><span class="op">&gt;{}([&amp;](</span><span class="kw">auto</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get 2D slice at depth z</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> y_slice <span class="op">=</span> y_tensor<span class="op">.</span>get_slice<span class="op">(</span>make_tuple<span class="op">(</span>_<span class="op">,</span> _<span class="op">,</span> z<span class="op">));</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Process x_tensor with y_slice</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> tensor_op<span class="op">(</span>x_tensor<span class="op">,</span> y_slice<span class="op">);</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Store or accumulate result</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        store_result<span class="op">(</span>result<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sweep-with-accumulation" class="level3">
<h3 class="anchored" data-anchor-id="sweep-with-accumulation">3. Sweep with Accumulation</h3>
<div>
<div id="pyodide-7" class="exercise-cell">

</div>
<script type="pyodide-7-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgYWNjdW11bGF0aW9uX3N3ZWVwKGRhdGEsIHhfdGlsZSk6XG4gICAgXCJcIlwiU3dlZXAgd2l0aCBydW5uaW5nIGFjY3VtdWxhdGlvblwiXCJcIlxuICAgIHhfZGF0YSA9IGRhdGFbOiwgeF90aWxlWzBdOnhfdGlsZVsxXV1cbiAgICBcbiAgICBhY2N1bXVsYXRvciA9IG5wLnplcm9zKHhfZGF0YS5zaGFwZVsxXSlcbiAgICBwcmludChmXCJJbml0aWFsIGFjY3VtdWxhdG9yOiB7YWNjdW11bGF0b3J9XCIpXG4gICAgXG4gICAgZm9yIHkgaW4gcmFuZ2UoZGF0YS5zaGFwZVswXSk6XG4gICAgICAgIHlfZGF0YSA9IGRhdGFbeSwgeF90aWxlWzBdOnhfdGlsZVsxXV1cbiAgICAgICAgYWNjdW11bGF0b3IgKz0geV9kYXRhXG4gICAgICAgIHByaW50KGZcIiAgQWZ0ZXIgWVt7eX1dOiB7YWNjdW11bGF0b3J9XCIpXG4gICAgXG4gICAgcHJpbnQoZlwiRmluYWwgcmVzdWx0OiB7YWNjdW11bGF0b3J9XCIpXG5cbiMgRXhhbXBsZVxuZGF0YSA9IG5wLmFyYW5nZSgxMikucmVzaGFwZSgzLCA0KVxucHJpbnQoXCJEYXRhOlwiKVxucHJpbnQoZGF0YSlcbnByaW50KFwiXFxuQWNjdW11bGF0aW5nIGNvbHVtbnMgMSBhbmQgMjpcIilcbmFjY3VtdWxhdGlvbl9zd2VlcChkYXRhLCAoMSwgMykpIn0=
</script>
</div>
</section>
</section>
<section id="integration-with-tile-distribution" class="level2">
<h2 class="anchored" data-anchor-id="integration-with-tile-distribution">Integration with Tile Distribution</h2>
<div class="mermaid">
flowchart TB
    subgraph "Complete Workflow"
        TD["TileDistribution<br>Define data layout"]
        TW["TileWindow<br>Create view"]
        DT["DistributedTensor<br>Load X data"]
        ST["SweepTile<br>Iterate Y positions"]
        R["Results<br>Store outputs"]
    end
    
    TD --&gt; TW
    TW --&gt; DT
    DT --&gt; ST
    ST --&gt; R
    
    style TD fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style ST fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    style R fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>SweepTile provides: - <strong>Efficiency</strong>: Load once, use many times - <strong>Simplicity</strong>: Clean iteration abstraction - <strong>Performance</strong>: Zero overhead, perfect patterns - <strong>Flexibility</strong>: Various sweep patterns for different algorithms</p>
<p>Key benefits: 1. <strong>Memory bandwidth</strong>: Optimal reuse of loaded data 2. <strong>Register pressure</strong>: Keep hot data in fastest memory 3. <strong>Code clarity</strong>: Express algorithms naturally 4. <strong>Compiler optimization</strong>: Enable aggressive optimizations</p>
<p>The sweep pattern is fundamental to high-performance GPU kernels, turning complex iteration patterns into simple, efficient operations. print(“⚖️ Sweep Pattern Comparison”) print(“=” * 35)</p>
</section>
</section>
<section id="create-test-distributed-tensor" class="level1">
<h1>Create test distributed tensor</h1>
<p>encoding = make_tile_distribution_encoding( rs_lengths=[], hs_lengthss=[[3], [3]], # 3x3 distribution ps_to_rhss_major=[[], []], ps_to_rhss_minor=[[], []], ys_to_rhs_major=[1, 2], ys_to_rhs_minor=[0, 0] ) distribution = make_static_tile_distribution(encoding) test_tensor = make_static_distributed_tensor(np.float32, distribution)</p>
</section>
<section id="fill-with-test-data" class="level1">
<h1>Fill with test data</h1>
<p>y_lengths = distribution.get_y_vector_lengths() for y0 in range(y_lengths[0]): for y1 in range(y_lengths[1]): test_tensor.set_element([y0, y1], (y0 + 1) * (y1 + 1))</p>
<p>print(“Test tensor filled with multiplication table values”) print()</p>
</section>
<section id="method-1-manual-loops-the-old-way" class="level1">
<h1>Method 1: Manual loops (the old way)</h1>
<p>print(“❌ Method 1: Manual loops”) print(” Code: Nested for loops with manual indexing”) print(” Risk: Easy to make mistakes, hard to optimize”) manual_sum = 0 for y0 in range(y_lengths[0]): for y1 in range(y_lengths[1]): val = test_tensor.get_element([y0, y1]) manual_sum += val print(f” Manual: Y[{y0},{y1}] = {val}“) print(f” Manual sum: {manual_sum}“) print()</p>
</section>
<section id="method-2-sweep-operations-the-ck-way" class="level1">
<h1>Method 2: Sweep operations (the CK way)</h1>
<p>print(“✅ Method 2: Sweep operations”) print(” Code: Elegant lambda-based iteration”) print(” Benefits: Automatic, optimizable, error-free”) sweep_sum = 0 def sweep_accumulator(y_indices): global sweep_sum val = test_tensor.get_element(y_indices) sweep_sum += val print(f” Sweep: Y{y_indices} = {val}“)</p>
<p>sweep_tile(test_tensor, sweep_accumulator) print(f” Sweep sum: {sweep_sum}“) print()</p>
<p>print(f”Results match: {manual_sum == sweep_sum}“)</p>
<pre><code>
## Testing Your Understanding

Let's verify that sweep operations work correctly:

```{pyodide}
print("🧪 Testing Sweep Operations")
print("=" * 30)

def test_basic_sweep():
    """Test basic sweep functionality."""
    try:
        # Create simple distribution
        encoding = make_tile_distribution_encoding(
            rs_lengths=[],
            hs_lengthss=[[2], [2]],
            ps_to_rhss_major=[[], []],
            ps_to_rhss_minor=[[], []],
            ys_to_rhs_major=[1, 2],
            ys_to_rhs_minor=[0, 0]
        )
        dist = make_static_tile_distribution(encoding)
        tensor = make_static_distributed_tensor(np.float32, dist)
        
        # Fill with test data
        y_lengths = dist.get_y_vector_lengths()
        for y0 in range(y_lengths[0]):
            for y1 in range(y_lengths[1]):
                tensor.set_element([y0, y1], y0 + y1)
        
        # Test sweep
        element_count = 0
        def count_elements(y_indices):
            nonlocal element_count
            element_count += 1
        
        sweep_tile(tensor, count_elements)
        
        expected_count = y_lengths[0] * y_lengths[1]
        return element_count == expected_count
        
    except Exception:
        return False

def test_tile_sweeper():
    """Test TileSweeper functionality."""
    try:
        # Create distribution
        encoding = make_tile_distribution_encoding(
            rs_lengths=[],
            hs_lengthss=[[2], [2]],
            ps_to_rhss_major=[[], []],
            ps_to_rhss_minor=[[], []],
            ys_to_rhs_major=[1, 2],
            ys_to_rhs_minor=[0, 0]
        )
        dist = make_static_tile_distribution(encoding)
        tensor = make_static_distributed_tensor(np.float32, dist)
        
        # Create tile sweeper
        def dummy_func(y_indices):
            pass
        
        sweeper = make_tile_sweeper(tensor, dummy_func)
        
        # Test sweeper properties
        num_accesses = sweeper.get_num_of_access()
        return num_accesses &gt; 0
        
    except Exception:
        return False

def test_sweep_computation():
    """Test sweep-based computation."""
    try:
        # Create distribution
        encoding = make_tile_distribution_encoding(
            rs_lengths=[],
            hs_lengthss=[[2], [2]],
            ps_to_rhss_major=[[], []],
            ps_to_rhss_minor=[[], []],
            ys_to_rhs_major=[1, 2],
            ys_to_rhs_minor=[0, 0]
        )
        dist = make_static_tile_distribution(encoding)
        input_tensor = make_static_distributed_tensor(np.float32, dist)
        output_tensor = make_static_distributed_tensor(np.float32, dist)
        
        # Fill input with test data
        y_lengths = dist.get_y_vector_lengths()
        for y0 in range(y_lengths[0]):
            for y1 in range(y_lengths[1]):
                input_tensor.set_element([y0, y1], y0 + y1 + 1)
        
        # Compute using sweep
        def square_operation(y_indices):
            val = input_tensor.get_element(y_indices)
            result = val ** 2
            output_tensor.set_element(y_indices, result)
        
        sweep_tile(input_tensor, square_operation)
        
        # Verify results
        for y0 in range(y_lengths[0]):
            for y1 in range(y_lengths[1]):
                input_val = input_tensor.get_element([y0, y1])
                output_val = output_tensor.get_element([y0, y1])
                if output_val != input_val ** 2:
                    return False
        
        return True
        
    except Exception:
        return False

# Run tests
tests = [
    ("Basic sweep", test_basic_sweep),
    ("Tile sweeper", test_tile_sweeper),
    ("Sweep computation", test_sweep_computation)
]

print("Running sweep operation tests:")
for test_name, test_func in tests:
    result = test_func()
    status = "✅ PASS" if result else "❌ FAIL"
    print(f"  {status}: {test_name}")</code></pre>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<p>Sweep operations complete the tile distribution story with elegant iteration patterns:</p>
<p><strong>1. Elegant Iteration</strong></p>
<ul>
<li>✅ Lambda-based processing functions</li>
<li>✅ Automatic handling of all Y indices</li>
<li>✅ No manual loops or complex indexing</li>
</ul>
<p><strong>2. Error-Free Processing</strong></p>
<ul>
<li>✅ Impossible to miss elements</li>
<li>✅ No index calculation errors</li>
<li>✅ Consistent iteration patterns</li>
</ul>
<p><strong>3. Flexible Patterns</strong></p>
<ul>
<li>✅ Simple element processing</li>
<li>✅ Conditional operations</li>
<li>✅ Accumulation and reduction</li>
<li>✅ Complex computation workflows</li>
</ul>
<p><strong>4. Performance Optimization</strong></p>
<ul>
<li>✅ Compiler-friendly iteration patterns</li>
<li>✅ Optimal memory access sequences</li>
<li>✅ Hardware-aware processing</li>
</ul>
<p><strong>5. Complete Workflow Integration</strong></p>
<ul>
<li>✅ Seamless integration with TileDistribution</li>
<li>✅ Perfect pairing with TileWindow</li>
<li>✅ Enables complete load → sweep → compute → store patterns</li>
</ul>
<p>Sweep operations are the final piece that makes distributed tensor processing both elegant and efficient. With TileDistribution, TileWindow, and Sweep operations, you have the complete toolkit for high-performance GPU computing!</p>


<!-- -->

<script type="pyodide-data">
eyJvcHRpb25zIjp7ImVudiI6eyJQTE9UTFlfUkVOREVSRVIiOiJwbG90bHlfbWltZXR5cGUifSwiaW5kZXhVUkwiOiJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvcHlvZGlkZS92MC4yNy4wL2Z1bGwvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsicHlvZGlkZV9odHRwIiwibWljcm9waXAiLCJpcHl0aG9uIiwibnVtcHkiLCJwYW5kYXMiLCJzeW1weSIsIm1pY3JvcGlwIl19fQ==
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJweW9kaWRlLTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl83ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS03LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzcgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl82ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzYgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzYsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS01LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzUgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzUsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl80ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS00LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzQgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8zID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzMgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0yLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzIgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3B5b2RpZGVfdmFsdWVfMSA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRQeXRob24sIGI2NERlY29kZX0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0xLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcInB5b2RpZGUtMS1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBQeXRob24gY29kZVxuICBjb25zdCByZXN1bHQgPSBweW9kaWRlT2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjFcIiBpbiBweW9kaWRlT2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgcHl0aG9uXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFB5dGhvbihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHB5b2RpZGVPanMucmVuZGVyZWRPanNbXCIxXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6InB5b2RpZGUtcHJlbHVkZSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InB5b2RpZGVPanMgPSB7XG4gIGNvbnN0IHtcbiAgICBQeW9kaWRlRXZhbHVhdG9yLFxuICAgIFB5b2RpZGVFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBQeXRob24sXG4gICAgc3RhcnRQeW9kaWRlV29ya2VyLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGgsXG4gIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHN0YXR1c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1zdGF0dXNcIik7XG4gIGNvbnN0IGluZGljYXRvckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGluZGljYXRvckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiZC1ub25lXCIpO1xuXG4gIGxldCBzdGF0dXNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICBzdGF0dXNUZXh0LmNsYXNzTGlzdCA9IFwiZXhlcmNpc2UtbG9hZGluZy1kZXRhaWxzXCI7XG4gIHN0YXR1c1RleHQgPSBzdGF0dXNDb250YWluZXIuYXBwZW5kQ2hpbGQoc3RhdHVzVGV4dCk7XG4gIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5pdGlhbGlzZWA7XG5cbiAgLy8gSG9pc3QgaW5kaWNhdG9yIG91dCBmcm9tIGZpbmFsIHNsaWRlIHdoZW4gcnVubmluZyB1bmRlciByZXZlYWxcbiAgY29uc3QgcmV2ZWFsU3RhdHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgLmV4ZXJjaXNlLWxvYWRpbmctaW5kaWNhdG9yXCIpO1xuICBpZiAocmV2ZWFsU3RhdHVzKSB7XG4gICAgcmV2ZWFsU3RhdHVzLnJlbW92ZSgpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2ZWFsID4gLnNsaWRlc1wiKS5hcHBlbmRDaGlsZChyZXZlYWxTdGF0dXMpO1xuICB9XG5cbiAgLy8gTWFrZSBhbnkgcmV2ZWFsIHNsaWRlcyB3aXRoIGxpdmUgY2VsbHMgc2Nyb2xsYWJsZVxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJldmVhbCAuZXhlcmNpc2UtY2VsbFwiKS5mb3JFYWNoKChlbCkgPT4ge1xuICAgIGVsLmNsb3Nlc3QoJ3NlY3Rpb24uc2xpZGUnKS5jbGFzc0xpc3QuYWRkKFwic2Nyb2xsYWJsZVwiKTtcbiAgfSlcblxuICAvLyBQeW9kaWRlIHN1cHBsZW1lbnRhbCBkYXRhIGFuZCBvcHRpb25zXG4gIGNvbnN0IGRhdGFDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcInB5b2RpZGUtZGF0YVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGI2NERlY29kZShkYXRhQ29udGVudCkpO1xuXG4gIC8vIEdyYWIgbGlzdCBvZiByZXNvdXJjZXMgdG8gYmUgZG93bmxvYWRlZFxuICBjb25zdCBmaWxlc0NvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwidmZzLWZpbGVcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBmaWxlcyA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGZpbGVzQ29udGVudCkpO1xuXG4gIGxldCBweW9kaWRlUHJvbWlzZSA9IChhc3luYyAoKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBQeW9kaWRlYDtcbiAgICBjb25zdCBweW9kaWRlID0gYXdhaXQgc3RhcnRQeW9kaWRlV29ya2VyKGRhdGEub3B0aW9ucyk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6IG1pY3JvcGlwYDtcbiAgICBhd2FpdCBweW9kaWRlLmxvYWRQYWNrYWdlKFwibWljcm9waXBcIik7XG4gICAgY29uc3QgbWljcm9waXAgPSBhd2FpdCBweW9kaWRlLnB5aW1wb3J0KFwibWljcm9waXBcIik7XG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gbWljcm9waXAuaW5zdGFsbChwa2cpO1xuICAgIH0pLnJlZHVjZSgoY3VyLCBuZXh0KSA9PiBjdXIudGhlbihuZXh0KSwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIGF3YWl0IG1pY3JvcGlwLmRlc3Ryb3koKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHB5b2RpZGUuRlMubWtkaXIocGF0aCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBpZiAoZS5uYW1lICE9PSBcIkVycm5vRXJyb3JcIikgdGhyb3cgZTtcbiAgICAgICAgICBpZiAoZS5lcnJubyAhPT0gMjApIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yVGV4dFB0ciA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5fc3RyZXJyb3IoZS5lcnJubyk7XG4gICAgICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBweW9kaWRlLl9tb2R1bGUuVVRGOFRvU3RyaW5nKGVycm9yVGV4dFB0cik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpbGVzeXN0ZW0gRXJyb3IgJHtlLmVycm5vfSBcIiR7ZXJyb3JUZXh0fVwiLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHB5b2RpZGUuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUubmFtZSAhPT0gXCJFcnJub0Vycm9yXCIpIHRocm93IGU7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dFB0ciA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5fc3RyZXJyb3IoZS5lcnJubyk7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5VVEY4VG9TdHJpbmcoZXJyb3JUZXh0UHRyKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yICR7ZS5lcnJub30gXCIke2Vycm9yVGV4dH1cIi5gKTtcbiAgICAgIH1cbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgUHlvZGlkZSBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBQeXRob24ocHlvZGlkZSk7XG5cbiAgICBzdGF0dXNUZXh0LnJlbW92ZSgpO1xuICAgIGlmIChzdGF0dXNDb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoID09IDApIHtcbiAgICAgIHN0YXR1c0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcHlvZGlkZTtcbiAgfSkoKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgc3RhdHVzVGV4dC5zdHlsZS5jb2xvciA9IFwidmFyKC0tZXhlcmNpc2UtZWRpdG9yLWhsLWVyLCAjQUQwMDAwKVwiO1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBlcnIubWVzc2FnZTtcbiAgICAvL2luZGljYXRvckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLnNwaW5uZXItZ3Jvd1wiKS5jbGFzc0xpc3QuYWRkKFwiZC1ub25lXCIpO1xuICAgIHRocm93IGVycjtcbiAgfSk7XG5cbiAgLy8gS2VlcCB0cmFjayBvZiBpbml0aWFsIE9KUyBibG9jayByZW5kZXJcbiAgY29uc3QgcmVuZGVyZWRPanMgPSB7fTtcblxuICBjb25zdCBwcm9jZXNzID0gYXN5bmMgKGNvbnRleHQsIGlucHV0cykgPT4ge1xuICAgIGNvbnN0IHB5b2RpZGUgPSBhd2FpdCBweW9kaWRlUHJvbWlzZTtcbiAgICBjb25zdCBldmFsdWF0b3IgPSBuZXcgUHlvZGlkZUV2YWx1YXRvcihweW9kaWRlLCBjb250ZXh0KTtcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBweW9kaWRlUHJvbWlzZSxcbiAgICByZW5kZXJlZE9qcyxcbiAgICBwcm9jZXNzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../concepts";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb8" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Sweep Tile - Elegant Iteration"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">  live-html:</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    mermaid:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">      theme: default</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>Sweep operations are the elegant way to iterate over distributed data. They complete the tile distribution workflow by providing clean, efficient iteration patterns that automatically handle all the complex indexing details.</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| autorun: true</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-install pythonck package</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> micropip</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> micropip.install(<span class="st">"https://raw.githubusercontent.com/ghamarian/pythonck/master/documentation/pythonck-0.1.0-py3-none-any.whl"</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic Sweep Mechanism</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "X-Tile (Reused)"</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="in">        XT["X data loaded once&lt;br/&gt;Stays in registers"]</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Y-Sweep"</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="in">        Y1["Y position 0"]</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="in">        Y2["Y position 1"]</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="in">        Y3["Y position 2"]</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="in">        YN["Y position N"]</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Computation"</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="in">        C["Process(X, Y)"]</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="in">    XT --&gt; C</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="in">    Y1 --&gt; C</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="in">    Y2 --&gt; C</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="in">    Y3 --&gt; C</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="in">    YN --&gt; C</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="in">    style XT fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="in">    style C fill:#e0e7ff,stroke:#4338ca,stroke-width:2px</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>The key insight: Load X data once, then sweep through Y positions while keeping X in fast memory.</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup pytensor path for pyodide environment</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>import sys</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>import os</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>import numpy as np</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="fu"># Add the project root to path so we can import pytensor</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>sys.path.insert(0, '/home/aghamari/github/composable_kernel/visualisation')</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import the actual CK modules</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>from pytensor.tile_distribution import make_static_tile_distribution, make_tile_distribution_encoding</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>from pytensor.tile_window import make_tile_window</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>from pytensor.tensor_view import make_tensor_view</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>from pytensor.tensor_descriptor import make_naive_tensor_descriptor_packed</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>from pytensor.static_distributed_tensor import make_static_distributed_tensor</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>from pytensor.sweep_tile import sweep_tile, make_tile_sweeper</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="in">## What are Sweep Operations?</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="in">Sweep operations are the final piece of the distributed computing puzzle:</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="in">**The Challenge**: You have distributed data loaded via TileWindow. Now you need to process every element. How do you iterate elegantly?</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="in">**The Solution**: Sweep operations provide clean iteration patterns that handle all the complex indexing automatically.</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="in">## The Complete GPU Processing Pipeline</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Data Distribution"</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="in">        TD[Tile Distribution&lt;br/&gt;Work Assignment]</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="in">        TW[Tile Window&lt;br/&gt;Data Loading]</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Processing"</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="in">        SW[Sweep Operations&lt;br/&gt;Element Iteration]</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="in">        UC[User Computation&lt;br/&gt;Lambda Function]</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Memory"</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="in">        GM[Global Memory]</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="in">        R[Registers]</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="in">    TD --&gt; TW</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="in">    TW --&gt; |load()| R</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="in">    R --&gt; SW</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="in">    SW --&gt; |foreach| UC</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a><span class="in">    UC --&gt; |store()| GM</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a><span class="in">    style TD fill:#e3f2fd</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="in">    style TW fill:#fff3e0</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a><span class="in">    style SW fill:#e8f5e9</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a><span class="in">    style UC fill:#fce4ec</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a><span class="fu">### Without Sweep Operations</span></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Manual nested loops over Y dimensions</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complex index calculations</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Easy to miss elements or double-process</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different code for different access patterns</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### With Sweep Operations</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Elegant lambda-based iteration</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Automatic handling of all elements</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Same pattern for any distribution</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Compiler-optimizable</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>**Key Insight**: Sweep operations are like forEach() for distributed tensors. Give them a function, and they'll call it for every element in the optimal order.</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic Sweep Operations</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>Let's start with the simplest sweep pattern:</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a simple 2D sweep operation</span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_sweep(matrix_shape, tile_shape):</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Demonstrate sweep concept with a simple matrix"""</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>    M, N <span class="op">=</span> matrix_shape</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>    tile_m, tile_n <span class="op">=</span> tile_shape</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Matrix: </span><span class="sc">{</span>M<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>N<span class="sc">}</span><span class="ss">, Tile: </span><span class="sc">{</span>tile_m<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>tile_n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of tiles: (</span><span class="sc">{</span>M<span class="op">//</span>tile_m<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>N<span class="op">//</span>tile_n<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each tile position</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tile_i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, M, tile_m):</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tile_j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, N, tile_n):</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Processing tile at (</span><span class="sc">{</span>tile_i<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>tile_j<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Load X-tile (column data) - happens once</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Load X-tile: columns </span><span class="sc">{</span>tile_j<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>tile_j<span class="op">+</span>tile_n<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Sweep through Y positions in this tile</span></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(tile_i, <span class="bu">min</span>(tile_i <span class="op">+</span> tile_m, M)):</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"    Sweep Y=</span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">: process row </span><span class="sc">{</span>y<span class="sc">}</span><span class="ss"> with loaded columns"</span>)</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>()</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: 6x8 matrix with 2x4 tiles</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>simulate_sweep((<span class="dv">6</span>, <span class="dv">8</span>), (<span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Power of SweepTile</span></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Memory Efficiency</span></span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Traditional Approach"</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a><span class="in">        T1["Load X[0]"] --&gt; P1["Process"]</span></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a><span class="in">        T2["Load Y[0]"] --&gt; P1</span></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a><span class="in">        T3["Load X[0]"] --&gt; P2["Process"]</span></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a><span class="in">        T4["Load Y[1]"] --&gt; P2</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a><span class="in">        T5["Load X[0]"] --&gt; P3["Process"]</span></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a><span class="in">        T6["Load Y[2]"] --&gt; P3</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a><span class="in">        Note1["X loaded 3 times!"]</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Sweep Approach"</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a><span class="in">        S1["Load X[0]"] --&gt; SP["Process with&lt;br/&gt;Y[0], Y[1], Y[2]"]</span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a><span class="in">        S2["Load Y[0,1,2]"] --&gt; SP</span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a><span class="in">        Note2["X loaded once!"]</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="in">    style Note1 fill:#fee2e2,stroke:#ef4444,stroke-width:2px</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a><span class="in">    style Note2 fill:#d1fae5,stroke:#10b981,stroke-width:2px</span></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Code Example</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a><span class="fu"># Demonstrate sweep operation</span></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>print("Sweeping over distributed tensor:")</span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>collected_values = []</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>def collect_value(y_indices):</span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>    """Function to collect values during sweep."""</span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>    value = distributed_tensor.get_element(y_indices)</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>    collected_values.append((y_indices.copy(), value))</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>    print(f"  Visited Y{y_indices}: value = {value}")</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a><span class="fu"># Perform the sweep</span></span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>sweep_tile(distributed_tensor, collect_value)</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>print(f"\nSweep completed! Visited {len(collected_values)} elements")</span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a><span class="in">### C++ Implementation Reference</span></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a><span class="in">The sweep operation pattern is implemented in CK using template functions:</span></span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a><span class="in">**File**: `include/ck_tile/core/tensor/sweep_tile.hpp`</span></span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a><span class="in">// Basic sweep over distributed tensor</span></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a><span class="in">template &lt;typename DistributedTensor, typename Func&gt;</span></span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a><span class="in">__device__ void sweep_tile(const DistributedTensor&amp; tensor, Func func)</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a><span class="in">    // Get Y-space spans for iteration</span></span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a><span class="in">    constexpr auto spans = DistributedTensor::get_distributed_spans();</span></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a><span class="in">    // Iterate over all Y indices</span></span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a><span class="in">    sweep_tile_spans(spans, [&amp;](auto y_indices) {</span></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a><span class="in">        // Call user function with current indices</span></span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a><span class="in">        func(y_indices);</span></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a><span class="in">// Example usage in kernel</span></span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a><span class="in">__device__ void process_tile(const auto&amp; tile)</span></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a><span class="in">    // Sum all elements</span></span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a><span class="in">    float sum = 0.0f;</span></span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a><span class="in">    sweep_tile(tile, [&amp;](auto y_idx) {</span></span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a><span class="in">        sum += tile(y_idx);</span></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a><span class="fu">### C++ Implementation Reference</span></span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>The sweep operation pattern is implemented in CK using template functions:</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>**File**: <span class="in">`include/ck_tile/core/tensor/sweep_tile.hpp`</span></span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a><span class="co">// Basic sweep over distributed tensor</span></span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> DistributedTensor<span class="op">,</span> <span class="kw">typename</span> Func<span class="op">&gt;</span></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> sweep_tile<span class="op">(</span><span class="at">const</span> DistributedTensor<span class="op">&amp;</span> tensor<span class="op">,</span> Func func<span class="op">)</span></span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get Y-space spans for iteration</span></span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> spans <span class="op">=</span> DistributedTensor<span class="op">::</span>get_distributed_spans<span class="op">();</span></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate over all Y indices</span></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>    sweep_tile_spans<span class="op">(</span>spans<span class="op">,</span> <span class="op">[&amp;](</span><span class="kw">auto</span> y_indices<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Call user function with current indices</span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>        func<span class="op">(</span>y_indices<span class="op">);</span></span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a><span class="co">// Example usage in kernel</span></span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> process_tile<span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> tile<span class="op">)</span></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sum all elements</span></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> sum <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>    sweep_tile<span class="op">(</span>tile<span class="op">,</span> <span class="op">[&amp;](</span><span class="kw">auto</span> y_idx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> tile<span class="op">(</span>y_idx<span class="op">);</span></span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>**What happened?** <span class="in">`sweep_tile`</span> automatically iterated over all Y indices in the distributed tensor and called our function for each element. No manual loops, no missed elements!</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sweep with Computation</span></span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>Let's use sweep operations for actual computation:</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Conceptual sweep implementation</span></span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SweepTileSimulation:</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data, tile_shape):</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tile_shape <span class="op">=</span> tile_shape</span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sweep_gemm_tile(<span class="va">self</span>, tile_row, tile_col):</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Simulate GEMM sweep for one tile"""</span></span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>        tile_m, tile_n <span class="op">=</span> <span class="va">self</span>.tile_shape</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Phase 1: Load X tile (A matrix columns)</span></span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Loading A tile columns </span><span class="sc">{</span>tile_col<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>tile_col <span class="op">+</span> tile_n <span class="op">-</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>        a_tile <span class="op">=</span> <span class="va">self</span>.data[tile_row:tile_row<span class="op">+</span>tile_m, tile_col:tile_col<span class="op">+</span>tile_n]</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Phase 2: Sweep through B rows</span></span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> []</span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> b_row <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.data.shape[<span class="dv">0</span>]):</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>            <span class="co"># In real GPU: B row data streams through</span></span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>            b_data <span class="op">=</span> <span class="va">self</span>.data[b_row, tile_col:tile_col<span class="op">+</span>tile_n]</span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute dot products</span></span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> a_row <span class="kw">in</span> <span class="bu">range</span>(a_tile.shape[<span class="dv">0</span>]):</span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> np.dot(a_tile[a_row], b_data)</span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a>                results.append((tile_row <span class="op">+</span> a_row, b_row, result))</span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.arange(<span class="dv">16</span>).reshape(<span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a>sweep <span class="op">=</span> SweepTileSimulation(data, (<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data matrix:"</span>)</span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sweeping tile at (0, 0):"</span>)</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> sweep.sweep_gemm_tile(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> results[:<span class="dv">4</span>]:  <span class="co"># Show first few results</span></span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Result[</span><span class="sc">{</span>r[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>r[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">] = </span><span class="sc">{</span>r[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a><span class="fu">## C++ Implementation Pattern</span></span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a><span class="co">// Sweep pattern for matrix multiplication</span></span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> ADataType<span class="op">,</span> <span class="kw">typename</span> BDataType<span class="op">,</span> <span class="kw">typename</span> CDataType<span class="op">&gt;</span></span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> gemm_sweep_tile<span class="op">(</span></span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> TileDistribution<span class="op">&amp;</span> dist_a<span class="op">,</span></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> TileDistribution<span class="op">&amp;</span> dist_b<span class="op">,</span></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a>    TileDistribution<span class="op">&amp;</span> dist_c<span class="op">)</span></span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 1: Load A tile into registers (X dimension)</span></span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_tile <span class="op">=</span> make_distributed_tensor<span class="op">(</span>dist_a<span class="op">);</span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a>    a_tile<span class="op">.</span>load<span class="op">();</span>  <span class="co">// Load once, reuse many times</span></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 2: Create sweep for B (Y dimension)</span></span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_sweep <span class="op">=</span> make_sweep_tile<span class="op">(</span>dist_b<span class="op">);</span></span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Phase 3: Sweep through B positions</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>    sweep_tile<span class="op">(</span>b_sweep<span class="op">,</span> <span class="op">[&amp;](</span><span class="kw">auto</span> b_slice<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a>        <span class="co">// b_slice is current Y position data</span></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Compute C = A * B for this Y position</span></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> c_slice <span class="op">=</span> make_distributed_tensor<span class="op">(</span>dist_c<span class="op">);</span></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Actual computation</span></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>        gemm<span class="op">(</span>a_tile<span class="op">,</span> b_slice<span class="op">,</span> c_slice<span class="op">);</span></span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Store result</span></span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>        c_slice<span class="op">.</span>store<span class="op">();</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sweep Patterns</span></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pattern 1: Simple Linear Sweep</span></span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a><span class="in">graph LR</span></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Linear Sweep"</span></span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a><span class="in">        S0["Start"] --&gt; P0["Y[0]"]</span></span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a><span class="in">        P0 --&gt; P1["Y[1]"]</span></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a><span class="in">        P1 --&gt; P2["Y[2]"]</span></span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a><span class="in">        P2 --&gt; P3["Y[3]"]</span></span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a><span class="in">        P3 --&gt; E["End"]</span></span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a><span class="in">    style S0 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a><span class="in">    style E fill:#ffebee,stroke:#d32f2f,stroke-width:2px</span></span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a><span class="fu"># Create result tensor</span></span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>result_tensor = make_static_distributed_tensor(np.float32, distributed_tensor.tile_distribution)</span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>print("Sweep with Computation")</span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a>print("=" * 30)</span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a>print("Computing squares using sweep:")</span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a>print()</span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>def compute_square(y_indices):</span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>    """Compute square of each element."""</span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a>    input_value = distributed_tensor.get_element(y_indices)</span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a>    output_value = input_value ** 2</span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>    result_tensor.set_element(y_indices, output_value)</span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a>    print(f"  Y{y_indices}: {input_value}² = {output_value}")</span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a><span class="fu"># Perform computation sweep</span></span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a>sweep_tile(distributed_tensor, compute_square)</span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a>print()</span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a>print("Results verification:")</span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a>def verify_result(y_indices):</span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a>    original = distributed_tensor.get_element(y_indices)</span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a>    computed = result_tensor.get_element(y_indices)</span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a>    expected = original ** 2</span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a>    print(f"  Y{y_indices}: {original} → {computed} (expected {expected})")</span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a>sweep_tile(result_tensor, verify_result)</span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a><span class="in">**Computation Pattern**: This is the classic pattern: sweep over input tensor, compute something, store in result tensor. The sweep handles all the iteration complexity automatically!</span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a><span class="in">## Advanced Sweep Patterns</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a><span class="in">Let's explore more sophisticated sweep patterns:</span></span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: true</span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a><span class="in">#| output: true</span></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a><span class="in">def linear_sweep(data, x_indices, y_range):</span></span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a><span class="in">    """Simple linear sweep pattern"""</span></span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a><span class="in">    # Load X data once</span></span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a><span class="in">    x_data = data[:, x_indices]</span></span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"Loaded X data (shape {x_data.shape}):")</span></span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a><span class="in">    print(x_data)</span></span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a><span class="in">    # Sweep through Y</span></span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a><span class="in">    print("\nSweeping Y positions:")</span></span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a><span class="in">    for y in y_range:</span></span>
<span id="cb8-434"><a href="#cb8-434" aria-hidden="true" tabindex="-1"></a><span class="in">        y_data = data[y, :]</span></span>
<span id="cb8-435"><a href="#cb8-435" aria-hidden="true" tabindex="-1"></a><span class="in">        result = np.dot(x_data.T, y_data)</span></span>
<span id="cb8-436"><a href="#cb8-436" aria-hidden="true" tabindex="-1"></a><span class="in">        print(f"  Y[{y}]: {y_data} → result: {result}")</span></span>
<span id="cb8-437"><a href="#cb8-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-438"><a href="#cb8-438" aria-hidden="true" tabindex="-1"></a><span class="in"># Example</span></span>
<span id="cb8-439"><a href="#cb8-439" aria-hidden="true" tabindex="-1"></a><span class="in">data = np.arange(20).reshape(4, 5)</span></span>
<span id="cb8-440"><a href="#cb8-440" aria-hidden="true" tabindex="-1"></a><span class="in">print("Original data:")</span></span>
<span id="cb8-441"><a href="#cb8-441" aria-hidden="true" tabindex="-1"></a><span class="in">print(data)</span></span>
<span id="cb8-442"><a href="#cb8-442" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a larger distribution for more interesting patterns</span></span>
<span id="cb8-443"><a href="#cb8-443" aria-hidden="true" tabindex="-1"></a><span class="in">encoding = make_tile_distribution_encoding(</span></span>
<span id="cb8-444"><a href="#cb8-444" aria-hidden="true" tabindex="-1"></a><span class="in">    rs_lengths=[],</span></span>
<span id="cb8-445"><a href="#cb8-445" aria-hidden="true" tabindex="-1"></a><span class="in">    hs_lengthss=[[4], [4]],  # 4x4 distribution</span></span>
<span id="cb8-446"><a href="#cb8-446" aria-hidden="true" tabindex="-1"></a><span class="in">    ps_to_rhss_major=[[], []],</span></span>
<span id="cb8-447"><a href="#cb8-447" aria-hidden="true" tabindex="-1"></a><span class="in">    ps_to_rhss_minor=[[], []],</span></span>
<span id="cb8-448"><a href="#cb8-448" aria-hidden="true" tabindex="-1"></a><span class="in">    ys_to_rhs_major=[1, 2],</span></span>
<span id="cb8-449"><a href="#cb8-449" aria-hidden="true" tabindex="-1"></a><span class="in">    ys_to_rhs_minor=[0, 0]</span></span>
<span id="cb8-450"><a href="#cb8-450" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb8-451"><a href="#cb8-451" aria-hidden="true" tabindex="-1"></a><span class="in">distribution = make_static_tile_distribution(encoding)</span></span>
<span id="cb8-452"><a href="#cb8-452" aria-hidden="true" tabindex="-1"></a><span class="in">distributed_tensor = make_static_distributed_tensor(np.float32, distribution)</span></span>
<span id="cb8-453"><a href="#cb8-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-454"><a href="#cb8-454" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill with test data</span></span>
<span id="cb8-455"><a href="#cb8-455" aria-hidden="true" tabindex="-1"></a><span class="in">y_lengths = distribution.get_y_vector_lengths()</span></span>
<span id="cb8-456"><a href="#cb8-456" aria-hidden="true" tabindex="-1"></a><span class="in">for y0 in range(y_lengths[0]):</span></span>
<span id="cb8-457"><a href="#cb8-457" aria-hidden="true" tabindex="-1"></a><span class="in">    for y1 in range(y_lengths[1]):</span></span>
<span id="cb8-458"><a href="#cb8-458" aria-hidden="true" tabindex="-1"></a><span class="in">        distributed_tensor.set_element([y0, y1], y0 * 4 + y1)</span></span>
<span id="cb8-459"><a href="#cb8-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-460"><a href="#cb8-460" aria-hidden="true" tabindex="-1"></a><span class="in">print("Created 4x4 distributed tensor with sequential values")</span></span>
<span id="cb8-461"><a href="#cb8-461" aria-hidden="true" tabindex="-1"></a><span class="in">print()</span></span>
<span id="cb8-462"><a href="#cb8-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-463"><a href="#cb8-463" aria-hidden="true" tabindex="-1"></a><span class="in"># Pattern 1: Conditional processing</span></span>
<span id="cb8-464"><a href="#cb8-464" aria-hidden="true" tabindex="-1"></a><span class="in">print("🎯 Pattern 1: Conditional Processing")</span></span>
<span id="cb8-465"><a href="#cb8-465" aria-hidden="true" tabindex="-1"></a><span class="in">def process_even_values(y_indices):</span></span>
<span id="cb8-466"><a href="#cb8-466" aria-hidden="true" tabindex="-1"></a><span class="in">    value = distributed_tensor.get_element(y_indices)</span></span>
<span id="cb8-467"><a href="#cb8-467" aria-hidden="true" tabindex="-1"></a><span class="in">    if int(value) % 2 == 0:</span></span>
<span id="cb8-468"><a href="#cb8-468" aria-hidden="true" tabindex="-1"></a><span class="in">        print(f"  Processing even value at Y{y_indices}: {value}")</span></span>
<span id="cb8-469"><a href="#cb8-469" aria-hidden="true" tabindex="-1"></a><span class="in">    else:</span></span>
<span id="cb8-470"><a href="#cb8-470" aria-hidden="true" tabindex="-1"></a><span class="in">        print(f"  Skipping odd value at Y{y_indices}: {value}")</span></span>
<span id="cb8-471"><a href="#cb8-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-472"><a href="#cb8-472" aria-hidden="true" tabindex="-1"></a><span class="in">sweep_tile(distributed_tensor, process_even_values)</span></span>
<span id="cb8-473"><a href="#cb8-473" aria-hidden="true" tabindex="-1"></a><span class="in">print()</span></span>
<span id="cb8-474"><a href="#cb8-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-475"><a href="#cb8-475" aria-hidden="true" tabindex="-1"></a><span class="in">linear_sweep(data, [0, 2], range(4))</span></span>
<span id="cb8-476"><a href="#cb8-476" aria-hidden="true" tabindex="-1"></a><span class="in"># Pattern 2: Accumulation</span></span>
<span id="cb8-477"><a href="#cb8-477" aria-hidden="true" tabindex="-1"></a><span class="in">print("🎯 Pattern 2: Accumulation")</span></span>
<span id="cb8-478"><a href="#cb8-478" aria-hidden="true" tabindex="-1"></a><span class="in">total_sum = 0</span></span>
<span id="cb8-479"><a href="#cb8-479" aria-hidden="true" tabindex="-1"></a><span class="in">element_count = 0</span></span>
<span id="cb8-480"><a href="#cb8-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-481"><a href="#cb8-481" aria-hidden="true" tabindex="-1"></a><span class="in">def accumulate_values(y_indices):</span></span>
<span id="cb8-482"><a href="#cb8-482" aria-hidden="true" tabindex="-1"></a><span class="in">    global total_sum, element_count</span></span>
<span id="cb8-483"><a href="#cb8-483" aria-hidden="true" tabindex="-1"></a><span class="in">    value = distributed_tensor.get_element(y_indices)</span></span>
<span id="cb8-484"><a href="#cb8-484" aria-hidden="true" tabindex="-1"></a><span class="in">    total_sum += value</span></span>
<span id="cb8-485"><a href="#cb8-485" aria-hidden="true" tabindex="-1"></a><span class="in">    element_count += 1</span></span>
<span id="cb8-486"><a href="#cb8-486" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"  Added {value}, running total: {total_sum}")</span></span>
<span id="cb8-487"><a href="#cb8-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-488"><a href="#cb8-488" aria-hidden="true" tabindex="-1"></a><span class="in">sweep_tile(distributed_tensor, accumulate_values)</span></span>
<span id="cb8-489"><a href="#cb8-489" aria-hidden="true" tabindex="-1"></a><span class="in">print(f"Final sum: {total_sum}, average: {total_sum/element_count}")</span></span>
<span id="cb8-490"><a href="#cb8-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-491"><a href="#cb8-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-492"><a href="#cb8-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pattern 2: Strided Sweep</span></span>
<span id="cb8-493"><a href="#cb8-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-496"><a href="#cb8-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-497"><a href="#cb8-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb8-498"><a href="#cb8-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb8-499"><a href="#cb8-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-500"><a href="#cb8-500" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> strided_sweep(data, x_tile, y_start, y_stride, y_count):</span>
<span id="cb8-501"><a href="#cb8-501" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Sweep with stride - useful for interleaved data"""</span></span>
<span id="cb8-502"><a href="#cb8-502" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load X tile</span></span>
<span id="cb8-503"><a href="#cb8-503" aria-hidden="true" tabindex="-1"></a>    x_data <span class="op">=</span> data[:, x_tile[<span class="dv">0</span>]:x_tile[<span class="dv">1</span>]]</span>
<span id="cb8-504"><a href="#cb8-504" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"X tile: columns </span><span class="sc">{</span>x_tile[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>x_tile[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-505"><a href="#cb8-505" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-506"><a href="#cb8-506" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Strided sweep through Y</span></span>
<span id="cb8-507"><a href="#cb8-507" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Strided sweep: start=</span><span class="sc">{</span>y_start<span class="sc">}</span><span class="ss">, stride=</span><span class="sc">{</span>y_stride<span class="sc">}</span><span class="ss">, count=</span><span class="sc">{</span>y_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-508"><a href="#cb8-508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(y_count):</span>
<span id="cb8-509"><a href="#cb8-509" aria-hidden="true" tabindex="-1"></a>        y_pos <span class="op">=</span> y_start <span class="op">+</span> i <span class="op">*</span> y_stride</span>
<span id="cb8-510"><a href="#cb8-510" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y_pos <span class="op">&lt;</span> data.shape[<span class="dv">0</span>]:</span>
<span id="cb8-511"><a href="#cb8-511" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Process Y[</span><span class="sc">{</span>y_pos<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb8-512"><a href="#cb8-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-513"><a href="#cb8-513" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Process every other row</span></span>
<span id="cb8-514"><a href="#cb8-514" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.arange(<span class="dv">24</span>).reshape(<span class="dv">6</span>, <span class="dv">4</span>)</span>
<span id="cb8-515"><a href="#cb8-515" aria-hidden="true" tabindex="-1"></a>strided_sweep(data, (<span class="dv">0</span>, <span class="dv">2</span>), y_start<span class="op">=</span><span class="dv">0</span>, y_stride<span class="op">=</span><span class="dv">2</span>, y_count<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb8-516"><a href="#cb8-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-517"><a href="#cb8-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-518"><a href="#cb8-518" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pattern 3: Block Sweep</span></span>
<span id="cb8-519"><a href="#cb8-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-522"><a href="#cb8-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-523"><a href="#cb8-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb8-524"><a href="#cb8-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb8-525"><a href="#cb8-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-526"><a href="#cb8-526" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> block_sweep(data, x_tile, y_blocks):</span>
<span id="cb8-527"><a href="#cb8-527" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Sweep through blocks of Y - useful for cache optimization"""</span></span>
<span id="cb8-528"><a href="#cb8-528" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"X tile loaded: columns </span><span class="sc">{</span>x_tile<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-529"><a href="#cb8-529" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-530"><a href="#cb8-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id, y_block <span class="kw">in</span> <span class="bu">enumerate</span>(y_blocks):</span>
<span id="cb8-531"><a href="#cb8-531" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Block </span><span class="sc">{</span>block_id<span class="sc">}</span><span class="ss">: Y[</span><span class="sc">{</span>y_block[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>y_block[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb8-532"><a href="#cb8-532" aria-hidden="true" tabindex="-1"></a>        block_data <span class="op">=</span> data[y_block[<span class="dv">0</span>]:y_block[<span class="dv">1</span>], :]</span>
<span id="cb8-533"><a href="#cb8-533" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Processing </span><span class="sc">{</span>block_data<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> rows together"</span>)</span>
<span id="cb8-534"><a href="#cb8-534" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In GPU: This block fits in shared memory</span></span>
<span id="cb8-535"><a href="#cb8-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-536"><a href="#cb8-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Process Y in blocks of 2</span></span>
<span id="cb8-537"><a href="#cb8-537" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.arange(<span class="dv">32</span>).reshape(<span class="dv">8</span>, <span class="dv">4</span>)</span>
<span id="cb8-538"><a href="#cb8-538" aria-hidden="true" tabindex="-1"></a>block_sweep(data, [<span class="dv">0</span>, <span class="dv">2</span>], [(<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">4</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">6</span>, <span class="dv">8</span>)])</span>
<span id="cb8-539"><a href="#cb8-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-540"><a href="#cb8-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-541"><a href="#cb8-541" aria-hidden="true" tabindex="-1"></a><span class="fu">## Performance Characteristics</span></span>
<span id="cb8-542"><a href="#cb8-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-543"><a href="#cb8-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb8-544"><a href="#cb8-544" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb8-545"><a href="#cb8-545" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb8-546"><a href="#cb8-546" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Sweep Performance Benefits"</span></span>
<span id="cb8-547"><a href="#cb8-547" aria-hidden="true" tabindex="-1"></a><span class="in">        B1["Zero runtime overhead&lt;br/&gt;Compile-time unrolling"]</span></span>
<span id="cb8-548"><a href="#cb8-548" aria-hidden="true" tabindex="-1"></a><span class="in">        B2["Perfect memory coalescing&lt;br/&gt;Sequential access patterns"]</span></span>
<span id="cb8-549"><a href="#cb8-549" aria-hidden="true" tabindex="-1"></a><span class="in">        B3["Automatic vectorization&lt;br/&gt;Compiler optimizations"]</span></span>
<span id="cb8-550"><a href="#cb8-550" aria-hidden="true" tabindex="-1"></a><span class="in">        B4["Register reuse&lt;br/&gt;X data stays in VGPR"]</span></span>
<span id="cb8-551"><a href="#cb8-551" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-552"><a href="#cb8-552" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-553"><a href="#cb8-553" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Use Cases"</span></span>
<span id="cb8-554"><a href="#cb8-554" aria-hidden="true" tabindex="-1"></a><span class="in">        U1["Matrix Multiplication&lt;br/&gt;Reuse A columns"]</span></span>
<span id="cb8-555"><a href="#cb8-555" aria-hidden="true" tabindex="-1"></a><span class="in">        U2["Convolution&lt;br/&gt;Reuse filter weights"]</span></span>
<span id="cb8-556"><a href="#cb8-556" aria-hidden="true" tabindex="-1"></a><span class="in">        U3["Reduction&lt;br/&gt;Accumulate over Y"]</span></span>
<span id="cb8-557"><a href="#cb8-557" aria-hidden="true" tabindex="-1"></a><span class="in">        U4["Broadcast&lt;br/&gt;Apply X to all Y"]</span></span>
<span id="cb8-558"><a href="#cb8-558" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-559"><a href="#cb8-559" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-560"><a href="#cb8-560" aria-hidden="true" tabindex="-1"></a><span class="in">    B1 --&gt; Performance["High Performance"]</span></span>
<span id="cb8-561"><a href="#cb8-561" aria-hidden="true" tabindex="-1"></a><span class="in">    B2 --&gt; Performance</span></span>
<span id="cb8-562"><a href="#cb8-562" aria-hidden="true" tabindex="-1"></a><span class="in">    B3 --&gt; Performance</span></span>
<span id="cb8-563"><a href="#cb8-563" aria-hidden="true" tabindex="-1"></a><span class="in">    B4 --&gt; Performance</span></span>
<span id="cb8-564"><a href="#cb8-564" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-565"><a href="#cb8-565" aria-hidden="true" tabindex="-1"></a><span class="in">    Performance --&gt; U1</span></span>
<span id="cb8-566"><a href="#cb8-566" aria-hidden="true" tabindex="-1"></a><span class="in">    Performance --&gt; U2</span></span>
<span id="cb8-567"><a href="#cb8-567" aria-hidden="true" tabindex="-1"></a><span class="in">    Performance --&gt; U3</span></span>
<span id="cb8-568"><a href="#cb8-568" aria-hidden="true" tabindex="-1"></a><span class="in">    Performance --&gt; U4</span></span>
<span id="cb8-569"><a href="#cb8-569" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-570"><a href="#cb8-570" aria-hidden="true" tabindex="-1"></a><span class="in">    style Performance fill:#d1fae5,stroke:#10b981,stroke-width:3px</span></span>
<span id="cb8-571"><a href="#cb8-571" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb8-572"><a href="#cb8-572" aria-hidden="true" tabindex="-1"></a><span class="in">def complete_tile_processing(input_data, window_origin, window_size, operation_name, compute_func):</span></span>
<span id="cb8-573"><a href="#cb8-573" aria-hidden="true" tabindex="-1"></a><span class="in">    """Complete tile processing with sweep operations."""</span></span>
<span id="cb8-574"><a href="#cb8-574" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"🚀 {operation_name} Processing")</span></span>
<span id="cb8-575"><a href="#cb8-575" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"   Input: {input_data.shape} matrix")</span></span>
<span id="cb8-576"><a href="#cb8-576" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"   Window: {window_size} at {window_origin}")</span></span>
<span id="cb8-577"><a href="#cb8-577" aria-hidden="true" tabindex="-1"></a><span class="in">    print()</span></span>
<span id="cb8-578"><a href="#cb8-578" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-579"><a href="#cb8-579" aria-hidden="true" tabindex="-1"></a><span class="in">    # 1. Setup tensor infrastructure</span></span>
<span id="cb8-580"><a href="#cb8-580" aria-hidden="true" tabindex="-1"></a><span class="in">    tensor_desc = make_naive_tensor_descriptor_packed(list(input_data.shape))</span></span>
<span id="cb8-581"><a href="#cb8-581" aria-hidden="true" tabindex="-1"></a><span class="in">    input_view = make_tensor_view(input_data, tensor_desc)</span></span>
<span id="cb8-582"><a href="#cb8-582" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-583"><a href="#cb8-583" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2. Create distribution</span></span>
<span id="cb8-584"><a href="#cb8-584" aria-hidden="true" tabindex="-1"></a><span class="in">    encoding = make_tile_distribution_encoding(</span></span>
<span id="cb8-585"><a href="#cb8-585" aria-hidden="true" tabindex="-1"></a><span class="in">        rs_lengths=[],</span></span>
<span id="cb8-586"><a href="#cb8-586" aria-hidden="true" tabindex="-1"></a><span class="in">        hs_lengthss=[[window_size[0]], [window_size[1]]],</span></span>
<span id="cb8-587"><a href="#cb8-587" aria-hidden="true" tabindex="-1"></a><span class="in">        ps_to_rhss_major=[[], []],</span></span>
<span id="cb8-588"><a href="#cb8-588" aria-hidden="true" tabindex="-1"></a><span class="in">        ps_to_rhss_minor=[[], []],</span></span>
<span id="cb8-589"><a href="#cb8-589" aria-hidden="true" tabindex="-1"></a><span class="in">        ys_to_rhs_major=[1, 2],</span></span>
<span id="cb8-590"><a href="#cb8-590" aria-hidden="true" tabindex="-1"></a><span class="in">        ys_to_rhs_minor=[0, 0]</span></span>
<span id="cb8-591"><a href="#cb8-591" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb8-592"><a href="#cb8-592" aria-hidden="true" tabindex="-1"></a><span class="in">    distribution = make_static_tile_distribution(encoding)</span></span>
<span id="cb8-593"><a href="#cb8-593" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-594"><a href="#cb8-594" aria-hidden="true" tabindex="-1"></a><span class="in">    # 3. Create window and load data - automatically creates distributed tensor!</span></span>
<span id="cb8-595"><a href="#cb8-595" aria-hidden="true" tabindex="-1"></a><span class="in">    input_window = make_tile_window(input_view, window_size, window_origin, distribution)</span></span>
<span id="cb8-596"><a href="#cb8-596" aria-hidden="true" tabindex="-1"></a><span class="in">    distributed_input = input_window.load()</span></span>
<span id="cb8-597"><a href="#cb8-597" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-598"><a href="#cb8-598" aria-hidden="true" tabindex="-1"></a><span class="in">    # 4. Create output window and load for direct processing</span></span>
<span id="cb8-599"><a href="#cb8-599" aria-hidden="true" tabindex="-1"></a><span class="in">    output_data = input_data.copy()</span></span>
<span id="cb8-600"><a href="#cb8-600" aria-hidden="true" tabindex="-1"></a><span class="in">    output_view = make_tensor_view(output_data, tensor_desc)</span></span>
<span id="cb8-601"><a href="#cb8-601" aria-hidden="true" tabindex="-1"></a><span class="in">    output_window = make_tile_window(output_view, window_size, window_origin, distribution)</span></span>
<span id="cb8-602"><a href="#cb8-602" aria-hidden="true" tabindex="-1"></a><span class="in">    distributed_output = output_window.load()</span></span>
<span id="cb8-603"><a href="#cb8-603" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-604"><a href="#cb8-604" aria-hidden="true" tabindex="-1"></a><span class="in">    def process_with_sweep(y_indices):</span></span>
<span id="cb8-605"><a href="#cb8-605" aria-hidden="true" tabindex="-1"></a><span class="in">        """Process each element using sweep."""</span></span>
<span id="cb8-606"><a href="#cb8-606" aria-hidden="true" tabindex="-1"></a><span class="in">        input_val = distributed_input.get_element(y_indices)</span></span>
<span id="cb8-607"><a href="#cb8-607" aria-hidden="true" tabindex="-1"></a><span class="in">        output_val = compute_func(input_val)</span></span>
<span id="cb8-608"><a href="#cb8-608" aria-hidden="true" tabindex="-1"></a><span class="in">        distributed_output.set_element(y_indices, output_val)</span></span>
<span id="cb8-609"><a href="#cb8-609" aria-hidden="true" tabindex="-1"></a><span class="in">        print(f"    Y{y_indices}: {input_val} → {output_val}")</span></span>
<span id="cb8-610"><a href="#cb8-610" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-611"><a href="#cb8-611" aria-hidden="true" tabindex="-1"></a><span class="in">    print("📊 Processing elements with sweep:")</span></span>
<span id="cb8-612"><a href="#cb8-612" aria-hidden="true" tabindex="-1"></a><span class="in">    sweep_tile(distributed_input, process_with_sweep)</span></span>
<span id="cb8-613"><a href="#cb8-613" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-614"><a href="#cb8-614" aria-hidden="true" tabindex="-1"></a><span class="in">    # 5. Store results back</span></span>
<span id="cb8-615"><a href="#cb8-615" aria-hidden="true" tabindex="-1"></a><span class="in">    output_window.store(distributed_output)</span></span>
<span id="cb8-616"><a href="#cb8-616" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-617"><a href="#cb8-617" aria-hidden="true" tabindex="-1"></a><span class="in">    return output_data</span></span>
<span id="cb8-618"><a href="#cb8-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-619"><a href="#cb8-619" aria-hidden="true" tabindex="-1"></a><span class="in"># Test the complete workflow</span></span>
<span id="cb8-620"><a href="#cb8-620" aria-hidden="true" tabindex="-1"></a><span class="in">test_data = np.array([[1, 2, 3, 4], </span></span>
<span id="cb8-621"><a href="#cb8-621" aria-hidden="true" tabindex="-1"></a><span class="in">                     [5, 6, 7, 8], </span></span>
<span id="cb8-622"><a href="#cb8-622" aria-hidden="true" tabindex="-1"></a><span class="in">                     [9, 10, 11, 12], </span></span>
<span id="cb8-623"><a href="#cb8-623" aria-hidden="true" tabindex="-1"></a><span class="in">                     [13, 14, 15, 16]], dtype=np.float32)</span></span>
<span id="cb8-624"><a href="#cb8-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-625"><a href="#cb8-625" aria-hidden="true" tabindex="-1"></a><span class="in">print("Original data:")</span></span>
<span id="cb8-626"><a href="#cb8-626" aria-hidden="true" tabindex="-1"></a><span class="in">print(test_data)</span></span>
<span id="cb8-627"><a href="#cb8-627" aria-hidden="true" tabindex="-1"></a><span class="in">print()</span></span>
<span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a><span class="in"># Process a 2x2 window with different operations</span></span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a><span class="in">result1 = complete_tile_processing(test_data, [1, 1], [2, 2], "Square", lambda x: x ** 2)</span></span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a><span class="in">print("\nAfter square operation:")</span></span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a><span class="in">print(result1)</span></span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a><span class="in">print()</span></span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a><span class="in">result2 = complete_tile_processing(test_data, [0, 2], [2, 2], "Multiply by 10", lambda x: x * 10)</span></span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a><span class="in">print("\nAfter multiply by 10 operation:")</span></span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a><span class="in">print(result2)</span></span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Sweep Features</span></span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Conditional Sweep</span></span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> conditional_sweep(data, x_tile, condition_fn):</span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Sweep only positions that meet condition"""</span></span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a>    x_data <span class="op">=</span> data[:, x_tile[<span class="dv">0</span>]:x_tile[<span class="dv">1</span>]]</span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a>    swept_positions <span class="op">=</span> []</span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(data.shape[<span class="dv">0</span>]):</span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> condition_fn(y):</span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a>            swept_positions.append(y)</span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process this Y position</span></span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Swept </span><span class="sc">{</span><span class="bu">len</span>(swept_positions)<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span>data<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> positions"</span>)</span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Positions: </span><span class="sc">{</span>swept_positions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Only process even rows</span></span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.arange(<span class="dv">20</span>).reshape(<span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a>conditional_sweep(data, (<span class="dv">0</span>, <span class="dv">2</span>), <span class="kw">lambda</span> y: y <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Multi-Dimensional Sweep</span></span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a><span class="co">// C++ example: 3D sweep for tensor operations</span></span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> XTensor<span class="op">,</span> <span class="kw">typename</span> YTensor<span class="op">&gt;</span></span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a>__device__ <span class="dt">void</span> tensor_3d_sweep<span class="op">(</span></span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> XTensor<span class="op">&amp;</span> x_tensor<span class="op">,</span>    <span class="co">// 2D slice loaded</span></span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> YTensor<span class="op">&amp;</span> y_tensor<span class="op">)</span>    <span class="co">// 3D tensor to sweep</span></span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sweep through depth dimension</span></span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> depth <span class="op">=</span> y_tensor<span class="op">.</span>get_shape<span class="op">()[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a>    static_for<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> depth<span class="op">,</span> <span class="dv">1</span><span class="op">&gt;{}([&amp;](</span><span class="kw">auto</span> z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get 2D slice at depth z</span></span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> y_slice <span class="op">=</span> y_tensor<span class="op">.</span>get_slice<span class="op">(</span>make_tuple<span class="op">(</span>_<span class="op">,</span> _<span class="op">,</span> z<span class="op">));</span></span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Process x_tensor with y_slice</span></span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> tensor_op<span class="op">(</span>x_tensor<span class="op">,</span> y_slice<span class="op">);</span></span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Store or accumulate result</span></span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a>        store_result<span class="op">(</span>result<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-691"><a href="#cb8-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-692"><a href="#cb8-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-693"><a href="#cb8-693" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Sweep with Accumulation</span></span>
<span id="cb8-694"><a href="#cb8-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-697"><a href="#cb8-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-698"><a href="#cb8-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb8-699"><a href="#cb8-699" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb8-700"><a href="#cb8-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-701"><a href="#cb8-701" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> accumulation_sweep(data, x_tile):</span>
<span id="cb8-702"><a href="#cb8-702" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Sweep with running accumulation"""</span></span>
<span id="cb8-703"><a href="#cb8-703" aria-hidden="true" tabindex="-1"></a>    x_data <span class="op">=</span> data[:, x_tile[<span class="dv">0</span>]:x_tile[<span class="dv">1</span>]]</span>
<span id="cb8-704"><a href="#cb8-704" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-705"><a href="#cb8-705" aria-hidden="true" tabindex="-1"></a>    accumulator <span class="op">=</span> np.zeros(x_data.shape[<span class="dv">1</span>])</span>
<span id="cb8-706"><a href="#cb8-706" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Initial accumulator: </span><span class="sc">{</span>accumulator<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-707"><a href="#cb8-707" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-708"><a href="#cb8-708" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(data.shape[<span class="dv">0</span>]):</span>
<span id="cb8-709"><a href="#cb8-709" aria-hidden="true" tabindex="-1"></a>        y_data <span class="op">=</span> data[y, x_tile[<span class="dv">0</span>]:x_tile[<span class="dv">1</span>]]</span>
<span id="cb8-710"><a href="#cb8-710" aria-hidden="true" tabindex="-1"></a>        accumulator <span class="op">+=</span> y_data</span>
<span id="cb8-711"><a href="#cb8-711" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  After Y[</span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">]: </span><span class="sc">{</span>accumulator<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-712"><a href="#cb8-712" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-713"><a href="#cb8-713" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final result: </span><span class="sc">{</span>accumulator<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-714"><a href="#cb8-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-715"><a href="#cb8-715" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb8-716"><a href="#cb8-716" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.arange(<span class="dv">12</span>).reshape(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb8-717"><a href="#cb8-717" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data:"</span>)</span>
<span id="cb8-718"><a href="#cb8-718" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb8-719"><a href="#cb8-719" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Accumulating columns 1 and 2:"</span>)</span>
<span id="cb8-720"><a href="#cb8-720" aria-hidden="true" tabindex="-1"></a>accumulation_sweep(data, (<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb8-721"><a href="#cb8-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-722"><a href="#cb8-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-723"><a href="#cb8-723" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integration with Tile Distribution</span></span>
<span id="cb8-724"><a href="#cb8-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-725"><a href="#cb8-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb8-726"><a href="#cb8-726" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb8-727"><a href="#cb8-727" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart TB</span></span>
<span id="cb8-728"><a href="#cb8-728" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Complete Workflow"</span></span>
<span id="cb8-729"><a href="#cb8-729" aria-hidden="true" tabindex="-1"></a><span class="in">        TD["TileDistribution&lt;br/&gt;Define data layout"]</span></span>
<span id="cb8-730"><a href="#cb8-730" aria-hidden="true" tabindex="-1"></a><span class="in">        TW["TileWindow&lt;br/&gt;Create view"]</span></span>
<span id="cb8-731"><a href="#cb8-731" aria-hidden="true" tabindex="-1"></a><span class="in">        DT["DistributedTensor&lt;br/&gt;Load X data"]</span></span>
<span id="cb8-732"><a href="#cb8-732" aria-hidden="true" tabindex="-1"></a><span class="in">        ST["SweepTile&lt;br/&gt;Iterate Y positions"]</span></span>
<span id="cb8-733"><a href="#cb8-733" aria-hidden="true" tabindex="-1"></a><span class="in">        R["Results&lt;br/&gt;Store outputs"]</span></span>
<span id="cb8-734"><a href="#cb8-734" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb8-735"><a href="#cb8-735" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-736"><a href="#cb8-736" aria-hidden="true" tabindex="-1"></a><span class="in">    TD --&gt; TW</span></span>
<span id="cb8-737"><a href="#cb8-737" aria-hidden="true" tabindex="-1"></a><span class="in">    TW --&gt; DT</span></span>
<span id="cb8-738"><a href="#cb8-738" aria-hidden="true" tabindex="-1"></a><span class="in">    DT --&gt; ST</span></span>
<span id="cb8-739"><a href="#cb8-739" aria-hidden="true" tabindex="-1"></a><span class="in">    ST --&gt; R</span></span>
<span id="cb8-740"><a href="#cb8-740" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb8-741"><a href="#cb8-741" aria-hidden="true" tabindex="-1"></a><span class="in">    style TD fill:#e3f2fd,stroke:#1976d2,stroke-width:2px</span></span>
<span id="cb8-742"><a href="#cb8-742" aria-hidden="true" tabindex="-1"></a><span class="in">    style ST fill:#fff3e0,stroke:#f57c00,stroke-width:3px</span></span>
<span id="cb8-743"><a href="#cb8-743" aria-hidden="true" tabindex="-1"></a><span class="in">    style R fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb8-744"><a href="#cb8-744" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb8-745"><a href="#cb8-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-746"><a href="#cb8-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-747"><a href="#cb8-747" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb8-748"><a href="#cb8-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-749"><a href="#cb8-749" aria-hidden="true" tabindex="-1"></a>SweepTile provides:</span>
<span id="cb8-750"><a href="#cb8-750" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Efficiency**: Load once, use many times</span>
<span id="cb8-751"><a href="#cb8-751" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Simplicity**: Clean iteration abstraction</span>
<span id="cb8-752"><a href="#cb8-752" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Performance**: Zero overhead, perfect patterns</span>
<span id="cb8-753"><a href="#cb8-753" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flexibility**: Various sweep patterns for different algorithms</span>
<span id="cb8-754"><a href="#cb8-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-755"><a href="#cb8-755" aria-hidden="true" tabindex="-1"></a>Key benefits:</span>
<span id="cb8-756"><a href="#cb8-756" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Memory bandwidth**: Optimal reuse of loaded data</span>
<span id="cb8-757"><a href="#cb8-757" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Register pressure**: Keep hot data in fastest memory</span>
<span id="cb8-758"><a href="#cb8-758" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Code clarity**: Express algorithms naturally</span>
<span id="cb8-759"><a href="#cb8-759" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Compiler optimization**: Enable aggressive optimizations</span>
<span id="cb8-760"><a href="#cb8-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-761"><a href="#cb8-761" aria-hidden="true" tabindex="-1"></a>The sweep pattern is fundamental to high-performance GPU kernels, turning complex iteration patterns into simple, efficient operations.</span>
<span id="cb8-762"><a href="#cb8-762" aria-hidden="true" tabindex="-1"></a>print("⚖️ Sweep Pattern Comparison")</span>
<span id="cb8-763"><a href="#cb8-763" aria-hidden="true" tabindex="-1"></a>print("=" * 35)</span>
<span id="cb8-764"><a href="#cb8-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-765"><a href="#cb8-765" aria-hidden="true" tabindex="-1"></a><span class="fu"># Create test distributed tensor</span></span>
<span id="cb8-766"><a href="#cb8-766" aria-hidden="true" tabindex="-1"></a>encoding = make_tile_distribution_encoding(</span>
<span id="cb8-767"><a href="#cb8-767" aria-hidden="true" tabindex="-1"></a>    rs_lengths=[],</span>
<span id="cb8-768"><a href="#cb8-768" aria-hidden="true" tabindex="-1"></a>    hs_lengthss=[<span class="co">[</span><span class="ot">3</span><span class="co">]</span>, <span class="co">[</span><span class="ot">3</span><span class="co">]</span>],  # 3x3 distribution</span>
<span id="cb8-769"><a href="#cb8-769" aria-hidden="true" tabindex="-1"></a>    ps_to_rhss_major=[[], []],</span>
<span id="cb8-770"><a href="#cb8-770" aria-hidden="true" tabindex="-1"></a>    ps_to_rhss_minor=[[], []],</span>
<span id="cb8-771"><a href="#cb8-771" aria-hidden="true" tabindex="-1"></a>    ys_to_rhs_major=<span class="co">[</span><span class="ot">1, 2</span><span class="co">]</span>,</span>
<span id="cb8-772"><a href="#cb8-772" aria-hidden="true" tabindex="-1"></a>    ys_to_rhs_minor=<span class="co">[</span><span class="ot">0, 0</span><span class="co">]</span></span>
<span id="cb8-773"><a href="#cb8-773" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-774"><a href="#cb8-774" aria-hidden="true" tabindex="-1"></a>distribution = make_static_tile_distribution(encoding)</span>
<span id="cb8-775"><a href="#cb8-775" aria-hidden="true" tabindex="-1"></a>test_tensor = make_static_distributed_tensor(np.float32, distribution)</span>
<span id="cb8-776"><a href="#cb8-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-777"><a href="#cb8-777" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fill with test data</span></span>
<span id="cb8-778"><a href="#cb8-778" aria-hidden="true" tabindex="-1"></a>y_lengths = distribution.get_y_vector_lengths()</span>
<span id="cb8-779"><a href="#cb8-779" aria-hidden="true" tabindex="-1"></a>for y0 in range(y_lengths<span class="co">[</span><span class="ot">0</span><span class="co">]</span>):</span>
<span id="cb8-780"><a href="#cb8-780" aria-hidden="true" tabindex="-1"></a>    for y1 in range(y_lengths<span class="co">[</span><span class="ot">1</span><span class="co">]</span>):</span>
<span id="cb8-781"><a href="#cb8-781" aria-hidden="true" tabindex="-1"></a>        test_tensor.set_element(<span class="co">[</span><span class="ot">y0, y1</span><span class="co">]</span>, (y0 + 1) * (y1 + 1))</span>
<span id="cb8-782"><a href="#cb8-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-783"><a href="#cb8-783" aria-hidden="true" tabindex="-1"></a>print("Test tensor filled with multiplication table values")</span>
<span id="cb8-784"><a href="#cb8-784" aria-hidden="true" tabindex="-1"></a>print()</span>
<span id="cb8-785"><a href="#cb8-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-786"><a href="#cb8-786" aria-hidden="true" tabindex="-1"></a><span class="fu"># Method 1: Manual loops (the old way)</span></span>
<span id="cb8-787"><a href="#cb8-787" aria-hidden="true" tabindex="-1"></a>print("❌ Method 1: Manual loops")</span>
<span id="cb8-788"><a href="#cb8-788" aria-hidden="true" tabindex="-1"></a>print("   Code: Nested for loops with manual indexing")</span>
<span id="cb8-789"><a href="#cb8-789" aria-hidden="true" tabindex="-1"></a>print("   Risk: Easy to make mistakes, hard to optimize")</span>
<span id="cb8-790"><a href="#cb8-790" aria-hidden="true" tabindex="-1"></a>manual_sum = 0</span>
<span id="cb8-791"><a href="#cb8-791" aria-hidden="true" tabindex="-1"></a>for y0 in range(y_lengths<span class="co">[</span><span class="ot">0</span><span class="co">]</span>):</span>
<span id="cb8-792"><a href="#cb8-792" aria-hidden="true" tabindex="-1"></a>    for y1 in range(y_lengths<span class="co">[</span><span class="ot">1</span><span class="co">]</span>):</span>
<span id="cb8-793"><a href="#cb8-793" aria-hidden="true" tabindex="-1"></a>        val = test_tensor.get_element(<span class="co">[</span><span class="ot">y0, y1</span><span class="co">]</span>)</span>
<span id="cb8-794"><a href="#cb8-794" aria-hidden="true" tabindex="-1"></a>        manual_sum += val</span>
<span id="cb8-795"><a href="#cb8-795" aria-hidden="true" tabindex="-1"></a>        print(f"   Manual: Y<span class="co">[</span><span class="ot">{y0},{y1}</span><span class="co">]</span> = {val}")</span>
<span id="cb8-796"><a href="#cb8-796" aria-hidden="true" tabindex="-1"></a>print(f"   Manual sum: {manual_sum}")</span>
<span id="cb8-797"><a href="#cb8-797" aria-hidden="true" tabindex="-1"></a>print()</span>
<span id="cb8-798"><a href="#cb8-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-799"><a href="#cb8-799" aria-hidden="true" tabindex="-1"></a><span class="fu"># Method 2: Sweep operations (the CK way)</span></span>
<span id="cb8-800"><a href="#cb8-800" aria-hidden="true" tabindex="-1"></a>print("✅ Method 2: Sweep operations")</span>
<span id="cb8-801"><a href="#cb8-801" aria-hidden="true" tabindex="-1"></a>print("   Code: Elegant lambda-based iteration")</span>
<span id="cb8-802"><a href="#cb8-802" aria-hidden="true" tabindex="-1"></a>print("   Benefits: Automatic, optimizable, error-free")</span>
<span id="cb8-803"><a href="#cb8-803" aria-hidden="true" tabindex="-1"></a>sweep_sum = 0</span>
<span id="cb8-804"><a href="#cb8-804" aria-hidden="true" tabindex="-1"></a>def sweep_accumulator(y_indices):</span>
<span id="cb8-805"><a href="#cb8-805" aria-hidden="true" tabindex="-1"></a>    global sweep_sum</span>
<span id="cb8-806"><a href="#cb8-806" aria-hidden="true" tabindex="-1"></a>    val = test_tensor.get_element(y_indices)</span>
<span id="cb8-807"><a href="#cb8-807" aria-hidden="true" tabindex="-1"></a>    sweep_sum += val</span>
<span id="cb8-808"><a href="#cb8-808" aria-hidden="true" tabindex="-1"></a>    print(f"   Sweep: Y{y_indices} = {val}")</span>
<span id="cb8-809"><a href="#cb8-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-810"><a href="#cb8-810" aria-hidden="true" tabindex="-1"></a>sweep_tile(test_tensor, sweep_accumulator)</span>
<span id="cb8-811"><a href="#cb8-811" aria-hidden="true" tabindex="-1"></a>print(f"   Sweep sum: {sweep_sum}")</span>
<span id="cb8-812"><a href="#cb8-812" aria-hidden="true" tabindex="-1"></a>print()</span>
<span id="cb8-813"><a href="#cb8-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-814"><a href="#cb8-814" aria-hidden="true" tabindex="-1"></a>print(f"Results match: {manual_sum == sweep_sum}")</span>
<span id="cb8-815"><a href="#cb8-815" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-816"><a href="#cb8-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-817"><a href="#cb8-817" aria-hidden="true" tabindex="-1"></a><span class="in">## Testing Your Understanding</span></span>
<span id="cb8-818"><a href="#cb8-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-819"><a href="#cb8-819" aria-hidden="true" tabindex="-1"></a><span class="in">Let's verify that sweep operations work correctly:</span></span>
<span id="cb8-820"><a href="#cb8-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-823"><a href="#cb8-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb8-824"><a href="#cb8-824" aria-hidden="true" tabindex="-1"></a><span class="in">print("🧪 Testing Sweep Operations")</span></span>
<span id="cb8-825"><a href="#cb8-825" aria-hidden="true" tabindex="-1"></a><span class="in">print("=" * 30)</span></span>
<span id="cb8-826"><a href="#cb8-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-827"><a href="#cb8-827" aria-hidden="true" tabindex="-1"></a><span class="in">def test_basic_sweep():</span></span>
<span id="cb8-828"><a href="#cb8-828" aria-hidden="true" tabindex="-1"></a><span class="in">    """Test basic sweep functionality."""</span></span>
<span id="cb8-829"><a href="#cb8-829" aria-hidden="true" tabindex="-1"></a><span class="in">    try:</span></span>
<span id="cb8-830"><a href="#cb8-830" aria-hidden="true" tabindex="-1"></a><span class="in">        # Create simple distribution</span></span>
<span id="cb8-831"><a href="#cb8-831" aria-hidden="true" tabindex="-1"></a><span class="in">        encoding = make_tile_distribution_encoding(</span></span>
<span id="cb8-832"><a href="#cb8-832" aria-hidden="true" tabindex="-1"></a><span class="in">            rs_lengths=[],</span></span>
<span id="cb8-833"><a href="#cb8-833" aria-hidden="true" tabindex="-1"></a><span class="in">            hs_lengthss=[[2], [2]],</span></span>
<span id="cb8-834"><a href="#cb8-834" aria-hidden="true" tabindex="-1"></a><span class="in">            ps_to_rhss_major=[[], []],</span></span>
<span id="cb8-835"><a href="#cb8-835" aria-hidden="true" tabindex="-1"></a><span class="in">            ps_to_rhss_minor=[[], []],</span></span>
<span id="cb8-836"><a href="#cb8-836" aria-hidden="true" tabindex="-1"></a><span class="in">            ys_to_rhs_major=[1, 2],</span></span>
<span id="cb8-837"><a href="#cb8-837" aria-hidden="true" tabindex="-1"></a><span class="in">            ys_to_rhs_minor=[0, 0]</span></span>
<span id="cb8-838"><a href="#cb8-838" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb8-839"><a href="#cb8-839" aria-hidden="true" tabindex="-1"></a><span class="in">        dist = make_static_tile_distribution(encoding)</span></span>
<span id="cb8-840"><a href="#cb8-840" aria-hidden="true" tabindex="-1"></a><span class="in">        tensor = make_static_distributed_tensor(np.float32, dist)</span></span>
<span id="cb8-841"><a href="#cb8-841" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-842"><a href="#cb8-842" aria-hidden="true" tabindex="-1"></a><span class="in">        # Fill with test data</span></span>
<span id="cb8-843"><a href="#cb8-843" aria-hidden="true" tabindex="-1"></a><span class="in">        y_lengths = dist.get_y_vector_lengths()</span></span>
<span id="cb8-844"><a href="#cb8-844" aria-hidden="true" tabindex="-1"></a><span class="in">        for y0 in range(y_lengths[0]):</span></span>
<span id="cb8-845"><a href="#cb8-845" aria-hidden="true" tabindex="-1"></a><span class="in">            for y1 in range(y_lengths[1]):</span></span>
<span id="cb8-846"><a href="#cb8-846" aria-hidden="true" tabindex="-1"></a><span class="in">                tensor.set_element([y0, y1], y0 + y1)</span></span>
<span id="cb8-847"><a href="#cb8-847" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-848"><a href="#cb8-848" aria-hidden="true" tabindex="-1"></a><span class="in">        # Test sweep</span></span>
<span id="cb8-849"><a href="#cb8-849" aria-hidden="true" tabindex="-1"></a><span class="in">        element_count = 0</span></span>
<span id="cb8-850"><a href="#cb8-850" aria-hidden="true" tabindex="-1"></a><span class="in">        def count_elements(y_indices):</span></span>
<span id="cb8-851"><a href="#cb8-851" aria-hidden="true" tabindex="-1"></a><span class="in">            nonlocal element_count</span></span>
<span id="cb8-852"><a href="#cb8-852" aria-hidden="true" tabindex="-1"></a><span class="in">            element_count += 1</span></span>
<span id="cb8-853"><a href="#cb8-853" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-854"><a href="#cb8-854" aria-hidden="true" tabindex="-1"></a><span class="in">        sweep_tile(tensor, count_elements)</span></span>
<span id="cb8-855"><a href="#cb8-855" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-856"><a href="#cb8-856" aria-hidden="true" tabindex="-1"></a><span class="in">        expected_count = y_lengths[0] * y_lengths[1]</span></span>
<span id="cb8-857"><a href="#cb8-857" aria-hidden="true" tabindex="-1"></a><span class="in">        return element_count == expected_count</span></span>
<span id="cb8-858"><a href="#cb8-858" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-859"><a href="#cb8-859" aria-hidden="true" tabindex="-1"></a><span class="in">    except Exception:</span></span>
<span id="cb8-860"><a href="#cb8-860" aria-hidden="true" tabindex="-1"></a><span class="in">        return False</span></span>
<span id="cb8-861"><a href="#cb8-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-862"><a href="#cb8-862" aria-hidden="true" tabindex="-1"></a><span class="in">def test_tile_sweeper():</span></span>
<span id="cb8-863"><a href="#cb8-863" aria-hidden="true" tabindex="-1"></a><span class="in">    """Test TileSweeper functionality."""</span></span>
<span id="cb8-864"><a href="#cb8-864" aria-hidden="true" tabindex="-1"></a><span class="in">    try:</span></span>
<span id="cb8-865"><a href="#cb8-865" aria-hidden="true" tabindex="-1"></a><span class="in">        # Create distribution</span></span>
<span id="cb8-866"><a href="#cb8-866" aria-hidden="true" tabindex="-1"></a><span class="in">        encoding = make_tile_distribution_encoding(</span></span>
<span id="cb8-867"><a href="#cb8-867" aria-hidden="true" tabindex="-1"></a><span class="in">            rs_lengths=[],</span></span>
<span id="cb8-868"><a href="#cb8-868" aria-hidden="true" tabindex="-1"></a><span class="in">            hs_lengthss=[[2], [2]],</span></span>
<span id="cb8-869"><a href="#cb8-869" aria-hidden="true" tabindex="-1"></a><span class="in">            ps_to_rhss_major=[[], []],</span></span>
<span id="cb8-870"><a href="#cb8-870" aria-hidden="true" tabindex="-1"></a><span class="in">            ps_to_rhss_minor=[[], []],</span></span>
<span id="cb8-871"><a href="#cb8-871" aria-hidden="true" tabindex="-1"></a><span class="in">            ys_to_rhs_major=[1, 2],</span></span>
<span id="cb8-872"><a href="#cb8-872" aria-hidden="true" tabindex="-1"></a><span class="in">            ys_to_rhs_minor=[0, 0]</span></span>
<span id="cb8-873"><a href="#cb8-873" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb8-874"><a href="#cb8-874" aria-hidden="true" tabindex="-1"></a><span class="in">        dist = make_static_tile_distribution(encoding)</span></span>
<span id="cb8-875"><a href="#cb8-875" aria-hidden="true" tabindex="-1"></a><span class="in">        tensor = make_static_distributed_tensor(np.float32, dist)</span></span>
<span id="cb8-876"><a href="#cb8-876" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-877"><a href="#cb8-877" aria-hidden="true" tabindex="-1"></a><span class="in">        # Create tile sweeper</span></span>
<span id="cb8-878"><a href="#cb8-878" aria-hidden="true" tabindex="-1"></a><span class="in">        def dummy_func(y_indices):</span></span>
<span id="cb8-879"><a href="#cb8-879" aria-hidden="true" tabindex="-1"></a><span class="in">            pass</span></span>
<span id="cb8-880"><a href="#cb8-880" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-881"><a href="#cb8-881" aria-hidden="true" tabindex="-1"></a><span class="in">        sweeper = make_tile_sweeper(tensor, dummy_func)</span></span>
<span id="cb8-882"><a href="#cb8-882" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-883"><a href="#cb8-883" aria-hidden="true" tabindex="-1"></a><span class="in">        # Test sweeper properties</span></span>
<span id="cb8-884"><a href="#cb8-884" aria-hidden="true" tabindex="-1"></a><span class="in">        num_accesses = sweeper.get_num_of_access()</span></span>
<span id="cb8-885"><a href="#cb8-885" aria-hidden="true" tabindex="-1"></a><span class="in">        return num_accesses &gt; 0</span></span>
<span id="cb8-886"><a href="#cb8-886" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-887"><a href="#cb8-887" aria-hidden="true" tabindex="-1"></a><span class="in">    except Exception:</span></span>
<span id="cb8-888"><a href="#cb8-888" aria-hidden="true" tabindex="-1"></a><span class="in">        return False</span></span>
<span id="cb8-889"><a href="#cb8-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-890"><a href="#cb8-890" aria-hidden="true" tabindex="-1"></a><span class="in">def test_sweep_computation():</span></span>
<span id="cb8-891"><a href="#cb8-891" aria-hidden="true" tabindex="-1"></a><span class="in">    """Test sweep-based computation."""</span></span>
<span id="cb8-892"><a href="#cb8-892" aria-hidden="true" tabindex="-1"></a><span class="in">    try:</span></span>
<span id="cb8-893"><a href="#cb8-893" aria-hidden="true" tabindex="-1"></a><span class="in">        # Create distribution</span></span>
<span id="cb8-894"><a href="#cb8-894" aria-hidden="true" tabindex="-1"></a><span class="in">        encoding = make_tile_distribution_encoding(</span></span>
<span id="cb8-895"><a href="#cb8-895" aria-hidden="true" tabindex="-1"></a><span class="in">            rs_lengths=[],</span></span>
<span id="cb8-896"><a href="#cb8-896" aria-hidden="true" tabindex="-1"></a><span class="in">            hs_lengthss=[[2], [2]],</span></span>
<span id="cb8-897"><a href="#cb8-897" aria-hidden="true" tabindex="-1"></a><span class="in">            ps_to_rhss_major=[[], []],</span></span>
<span id="cb8-898"><a href="#cb8-898" aria-hidden="true" tabindex="-1"></a><span class="in">            ps_to_rhss_minor=[[], []],</span></span>
<span id="cb8-899"><a href="#cb8-899" aria-hidden="true" tabindex="-1"></a><span class="in">            ys_to_rhs_major=[1, 2],</span></span>
<span id="cb8-900"><a href="#cb8-900" aria-hidden="true" tabindex="-1"></a><span class="in">            ys_to_rhs_minor=[0, 0]</span></span>
<span id="cb8-901"><a href="#cb8-901" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb8-902"><a href="#cb8-902" aria-hidden="true" tabindex="-1"></a><span class="in">        dist = make_static_tile_distribution(encoding)</span></span>
<span id="cb8-903"><a href="#cb8-903" aria-hidden="true" tabindex="-1"></a><span class="in">        input_tensor = make_static_distributed_tensor(np.float32, dist)</span></span>
<span id="cb8-904"><a href="#cb8-904" aria-hidden="true" tabindex="-1"></a><span class="in">        output_tensor = make_static_distributed_tensor(np.float32, dist)</span></span>
<span id="cb8-905"><a href="#cb8-905" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-906"><a href="#cb8-906" aria-hidden="true" tabindex="-1"></a><span class="in">        # Fill input with test data</span></span>
<span id="cb8-907"><a href="#cb8-907" aria-hidden="true" tabindex="-1"></a><span class="in">        y_lengths = dist.get_y_vector_lengths()</span></span>
<span id="cb8-908"><a href="#cb8-908" aria-hidden="true" tabindex="-1"></a><span class="in">        for y0 in range(y_lengths[0]):</span></span>
<span id="cb8-909"><a href="#cb8-909" aria-hidden="true" tabindex="-1"></a><span class="in">            for y1 in range(y_lengths[1]):</span></span>
<span id="cb8-910"><a href="#cb8-910" aria-hidden="true" tabindex="-1"></a><span class="in">                input_tensor.set_element([y0, y1], y0 + y1 + 1)</span></span>
<span id="cb8-911"><a href="#cb8-911" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-912"><a href="#cb8-912" aria-hidden="true" tabindex="-1"></a><span class="in">        # Compute using sweep</span></span>
<span id="cb8-913"><a href="#cb8-913" aria-hidden="true" tabindex="-1"></a><span class="in">        def square_operation(y_indices):</span></span>
<span id="cb8-914"><a href="#cb8-914" aria-hidden="true" tabindex="-1"></a><span class="in">            val = input_tensor.get_element(y_indices)</span></span>
<span id="cb8-915"><a href="#cb8-915" aria-hidden="true" tabindex="-1"></a><span class="in">            result = val ** 2</span></span>
<span id="cb8-916"><a href="#cb8-916" aria-hidden="true" tabindex="-1"></a><span class="in">            output_tensor.set_element(y_indices, result)</span></span>
<span id="cb8-917"><a href="#cb8-917" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-918"><a href="#cb8-918" aria-hidden="true" tabindex="-1"></a><span class="in">        sweep_tile(input_tensor, square_operation)</span></span>
<span id="cb8-919"><a href="#cb8-919" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-920"><a href="#cb8-920" aria-hidden="true" tabindex="-1"></a><span class="in">        # Verify results</span></span>
<span id="cb8-921"><a href="#cb8-921" aria-hidden="true" tabindex="-1"></a><span class="in">        for y0 in range(y_lengths[0]):</span></span>
<span id="cb8-922"><a href="#cb8-922" aria-hidden="true" tabindex="-1"></a><span class="in">            for y1 in range(y_lengths[1]):</span></span>
<span id="cb8-923"><a href="#cb8-923" aria-hidden="true" tabindex="-1"></a><span class="in">                input_val = input_tensor.get_element([y0, y1])</span></span>
<span id="cb8-924"><a href="#cb8-924" aria-hidden="true" tabindex="-1"></a><span class="in">                output_val = output_tensor.get_element([y0, y1])</span></span>
<span id="cb8-925"><a href="#cb8-925" aria-hidden="true" tabindex="-1"></a><span class="in">                if output_val != input_val ** 2:</span></span>
<span id="cb8-926"><a href="#cb8-926" aria-hidden="true" tabindex="-1"></a><span class="in">                    return False</span></span>
<span id="cb8-927"><a href="#cb8-927" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-928"><a href="#cb8-928" aria-hidden="true" tabindex="-1"></a><span class="in">        return True</span></span>
<span id="cb8-929"><a href="#cb8-929" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb8-930"><a href="#cb8-930" aria-hidden="true" tabindex="-1"></a><span class="in">    except Exception:</span></span>
<span id="cb8-931"><a href="#cb8-931" aria-hidden="true" tabindex="-1"></a><span class="in">        return False</span></span>
<span id="cb8-932"><a href="#cb8-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-933"><a href="#cb8-933" aria-hidden="true" tabindex="-1"></a><span class="in"># Run tests</span></span>
<span id="cb8-934"><a href="#cb8-934" aria-hidden="true" tabindex="-1"></a><span class="in">tests = [</span></span>
<span id="cb8-935"><a href="#cb8-935" aria-hidden="true" tabindex="-1"></a><span class="in">    ("Basic sweep", test_basic_sweep),</span></span>
<span id="cb8-936"><a href="#cb8-936" aria-hidden="true" tabindex="-1"></a><span class="in">    ("Tile sweeper", test_tile_sweeper),</span></span>
<span id="cb8-937"><a href="#cb8-937" aria-hidden="true" tabindex="-1"></a><span class="in">    ("Sweep computation", test_sweep_computation)</span></span>
<span id="cb8-938"><a href="#cb8-938" aria-hidden="true" tabindex="-1"></a><span class="in">]</span></span>
<span id="cb8-939"><a href="#cb8-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-940"><a href="#cb8-940" aria-hidden="true" tabindex="-1"></a><span class="in">print("Running sweep operation tests:")</span></span>
<span id="cb8-941"><a href="#cb8-941" aria-hidden="true" tabindex="-1"></a><span class="in">for test_name, test_func in tests:</span></span>
<span id="cb8-942"><a href="#cb8-942" aria-hidden="true" tabindex="-1"></a><span class="in">    result = test_func()</span></span>
<span id="cb8-943"><a href="#cb8-943" aria-hidden="true" tabindex="-1"></a><span class="in">    status = "✅ PASS" if result else "❌ FAIL"</span></span>
<span id="cb8-944"><a href="#cb8-944" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"  {status}: {test_name}")</span></span>
<span id="cb8-945"><a href="#cb8-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-946"><a href="#cb8-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-947"><a href="#cb8-947" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways</span></span>
<span id="cb8-948"><a href="#cb8-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-949"><a href="#cb8-949" aria-hidden="true" tabindex="-1"></a>Sweep operations complete the tile distribution story with elegant iteration patterns:</span>
<span id="cb8-950"><a href="#cb8-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-951"><a href="#cb8-951" aria-hidden="true" tabindex="-1"></a>**1. Elegant Iteration**</span>
<span id="cb8-952"><a href="#cb8-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-953"><a href="#cb8-953" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Lambda-based processing functions</span>
<span id="cb8-954"><a href="#cb8-954" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Automatic handling of all Y indices</span>
<span id="cb8-955"><a href="#cb8-955" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ No manual loops or complex indexing</span>
<span id="cb8-956"><a href="#cb8-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-957"><a href="#cb8-957" aria-hidden="true" tabindex="-1"></a>**2. Error-Free Processing**</span>
<span id="cb8-958"><a href="#cb8-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-959"><a href="#cb8-959" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Impossible to miss elements</span>
<span id="cb8-960"><a href="#cb8-960" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ No index calculation errors</span>
<span id="cb8-961"><a href="#cb8-961" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Consistent iteration patterns</span>
<span id="cb8-962"><a href="#cb8-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-963"><a href="#cb8-963" aria-hidden="true" tabindex="-1"></a>**3. Flexible Patterns**</span>
<span id="cb8-964"><a href="#cb8-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-965"><a href="#cb8-965" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Simple element processing</span>
<span id="cb8-966"><a href="#cb8-966" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Conditional operations</span>
<span id="cb8-967"><a href="#cb8-967" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Accumulation and reduction</span>
<span id="cb8-968"><a href="#cb8-968" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Complex computation workflows</span>
<span id="cb8-969"><a href="#cb8-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-970"><a href="#cb8-970" aria-hidden="true" tabindex="-1"></a>**4. Performance Optimization**</span>
<span id="cb8-971"><a href="#cb8-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-972"><a href="#cb8-972" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Compiler-friendly iteration patterns</span>
<span id="cb8-973"><a href="#cb8-973" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Optimal memory access sequences</span>
<span id="cb8-974"><a href="#cb8-974" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Hardware-aware processing</span>
<span id="cb8-975"><a href="#cb8-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-976"><a href="#cb8-976" aria-hidden="true" tabindex="-1"></a>**5. Complete Workflow Integration**</span>
<span id="cb8-977"><a href="#cb8-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-978"><a href="#cb8-978" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Seamless integration with TileDistribution</span>
<span id="cb8-979"><a href="#cb8-979" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Perfect pairing with TileWindow</span>
<span id="cb8-980"><a href="#cb8-980" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>✅ Enables complete load → sweep → compute → store patterns</span>
<span id="cb8-981"><a href="#cb8-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-982"><a href="#cb8-982" aria-hidden="true" tabindex="-1"></a>Sweep operations are the final piece that makes distributed tensor processing both elegant and efficient. With TileDistribution, TileWindow, and Sweep operations, you have the complete toolkit for high-performance GPU computing! </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script src="font-cleanup.js"></script>




</body></html>