<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tile Window - Data Access Gateway – Tile Distribution Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-038ebe7de1ad581fc619d66ba7f7845b.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-9cae0046c5fab5900eed4751693c39dd.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-038ebe7de1ad581fc619d66ba7f7845b.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-185961ed47a39db2ff9d8581d2d02664.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-1f647ac581ac6b74d75948daead8752e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-185961ed47a39db2ff9d8581d2d02664.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({ 
        startOnLoad: true,
        theme: 'default',
        themeVariables: {
            primaryColor: '#f0f7ff',
            primaryTextColor: '#1e293b',
            primaryBorderColor: '#2563eb',
            lineColor: '#6b7280',
            secondaryColor: '#fef3e2',
            tertiaryColor: '#f0fdf4',
            background: '#ffffff',
            mainBkg: '#f0f7ff',
            secondBkg: '#fef3e2',
            tertiaryBkg: '#f0fdf4',
            primaryTextColor: '#1e293b',
            fontSize: '16px'
        }
    });
});
</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../global-font-override.css">
<link rel="stylesheet" href="../diagram-sizing-fixes.css">
</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../concepts/03_tile_distribution.html">Distribution API</a></li><li class="breadcrumb-item"><a href="../concepts/03_tile_window.html">Tile Window - Data Access Gateway</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Tile Distribution Documentation</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Distribution Documentation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/00_introduction_motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction and Motivation - Why Tile Distribution Matters</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/01_buffer_view.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Buffer Views - Raw Memory Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/01_tensor_view.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Views - Multi-Dimensional Structure</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Transformation Engine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_tensor_coordinates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Coordinates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Individual Transforms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_adaptors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Adaptors - Chaining Transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_descriptors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Descriptors - Complete Tensor Specifications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_convolution_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Convolution Implementation with Tensor Descriptors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/02_coordinate_movement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Coordinate Operations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Distribution API</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/03_tile_distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Distribution - The Core API</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/03_tile_window.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tile Window - Data Access Gateway</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/03_sweep_tile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sweep Tile - Elegant Iteration</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Coordinate Systems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/04_coordinate_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Coordinate Systems - The Mathematical Foundation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Implementation Deep Dive</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/05_encoding_internals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Encoding Internals - The Internal Machinery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/05_static_distributed_tensor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static Distributed Tensor - Thread-Local Data Containers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Thread Mapping</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../concepts/06_thread_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Thread Mapping - Connecting to Hardware</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#tilewindow-architecture" id="toc-tilewindow-architecture" class="nav-link" data-scroll-target="#tilewindow-architecture">TileWindow Architecture</a></li>
  </ul></li>
  <li><a href="#what-is-a-tilewindow" id="toc-what-is-a-tilewindow" class="nav-link" data-scroll-target="#what-is-a-tilewindow">What is a TileWindow?</a></li>
  <li><a href="#tilewindow-data-flow" id="toc-tilewindow-data-flow" class="nav-link" data-scroll-target="#tilewindow-data-flow">TileWindow Data Flow</a></li>
  <li><a href="#creating-and-using-tilewindow" id="toc-creating-and-using-tilewindow" class="nav-link" data-scroll-target="#creating-and-using-tilewindow">Creating and Using TileWindow</a></li>
  <li><a href="#understanding-window-coordinates" id="toc-understanding-window-coordinates" class="nav-link" data-scroll-target="#understanding-window-coordinates">Understanding Window Coordinates</a>
  <ul class="collapse">
  <li><a href="#c-implementation-reference" id="toc-c-implementation-reference" class="nav-link" data-scroll-target="#c-implementation-reference">C++ Implementation Reference</a></li>
  </ul></li>
  <li><a href="#loading-data-with-tilewindow" id="toc-loading-data-with-tilewindow" class="nav-link" data-scroll-target="#loading-data-with-tilewindow">Loading Data with TileWindow</a></li>
  <li><a href="#load-operation-architecture" id="toc-load-operation-architecture" class="nav-link" data-scroll-target="#load-operation-architecture">Load Operation Architecture</a></li>
  <li><a href="#memory-access-patterns" id="toc-memory-access-patterns" class="nav-link" data-scroll-target="#memory-access-patterns">Memory Access Patterns</a></li>
  <li><a href="#advanced-window-operations" id="toc-advanced-window-operations" class="nav-link" data-scroll-target="#advanced-window-operations">Advanced Window Operations</a>
  <ul class="collapse">
  <li><a href="#sliding-windows" id="toc-sliding-windows" class="nav-link" data-scroll-target="#sliding-windows">Sliding Windows</a></li>
  <li><a href="#overlapping-windows" id="toc-overlapping-windows" class="nav-link" data-scroll-target="#overlapping-windows">Overlapping Windows</a></li>
  </ul></li>
  <li><a href="#computation-architecture" id="toc-computation-architecture" class="nav-link" data-scroll-target="#computation-architecture">Computation Architecture</a></li>
  <li><a href="#c-usage-example" id="toc-c-usage-example" class="nav-link" data-scroll-target="#c-usage-example">C++ Usage Example</a></li>
  <li><a href="#load-compute-store-pipeline" id="toc-load-compute-store-pipeline" class="nav-link" data-scroll-target="#load-compute-store-pipeline">Load-Compute-Store Pipeline</a></li>
  <li><a href="#pipeline-optimization" id="toc-pipeline-optimization" class="nav-link" data-scroll-target="#pipeline-optimization">Pipeline Optimization</a></li>
  <li><a href="#window-configuration-space" id="toc-window-configuration-space" class="nav-link" data-scroll-target="#window-configuration-space">Window Configuration Space</a></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices">Best Practices</a>
  <ul class="collapse">
  <li><a href="#window-size-selection" id="toc-window-size-selection" class="nav-link" data-scroll-target="#window-size-selection">1. Window Size Selection</a></li>
  <li><a href="#access-pattern-optimization" id="toc-access-pattern-optimization" class="nav-link" data-scroll-target="#access-pattern-optimization">2. Access Pattern Optimization</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../concepts/03_tile_distribution.html">Distribution API</a></li><li class="breadcrumb-item"><a href="../concepts/03_tile_window.html">Tile Window - Data Access Gateway</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Tile Window - Data Access Gateway</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The TileWindow abstraction represents the culmination of the CK framework’s approach to efficient tensor data access on GPUs. While TileDistribution determines the mapping between threads and tensor coordinates, TileWindow provides the actual mechanism for loading and storing data with optimal memory access patterns. This abstraction encapsulates the complexity of coalesced memory accesses, vectorization, and boundary handling into a clean interface that enables developers to focus on algorithmic logic rather than low-level memory management.</p>
<p>At its core, TileWindow implements a sophisticated windowing mechanism that views a subset of a larger tensor through the lens of a tile distribution. This windowing is not merely a simple sub-tensor extraction but a distribution-aware view that automatically generates the most efficient memory access patterns for the underlying hardware. The system achieves this by combining knowledge of the tensor’s layout, the distribution pattern, and the GPU’s memory subsystem characteristics to generate optimized load and store operations.</p>
<section id="tilewindow-architecture" class="level3">
<h3 class="anchored" data-anchor-id="tilewindow-architecture">TileWindow Architecture</h3>
<div class="mermaid">
graph TB
    subgraph "Components"
        TV["TensorView<br>Data source"]
        TD["TileDistribution<br>Thread mapping"]
        TW["TileWindow<br>Access gateway"]
        DT["DistributedTensor<br>Register storage"]
    end
    
    subgraph "Operations"
        Load["Load<br>Global → Registers"]
        Compute["Compute<br>In registers"]
        Store["Store<br>Registers → Global"]
    end
    
    subgraph "Optimizations"
        Coal["Coalescing<br>Adjacent access"]
        Vec["Vectorization<br>Multi-element ops"]
        Bank["Bank conflict<br>avoidance"]
    end
    
    TV --&gt; TW
    TD --&gt; TW
    TW --&gt; DT
    
    TW --&gt; Load
    Load --&gt; Compute
    Compute --&gt; Store
    
    Load --&gt; Coal
    Load --&gt; Vec
    Store --&gt; Bank
    
    style TW fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style DT fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style Coal fill:#fff3e0,stroke:#f57c00,stroke-width:2px
</div>
<div>
<div id="pyodide-1" class="exercise-cell">

</div>
<script type="pyodide-1-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVjaG8iOmZhbHNlLCJlZGl0IjpmYWxzZSwiZXZhbCI6dHJ1ZSwib3V0cHV0IjpmYWxzZX0sImNvZGUiOiJcbiMgQXV0by1pbnN0YWxsIHB5dGhvbmNrIHBhY2thZ2VcbmltcG9ydCBtaWNyb3BpcFxuYXdhaXQgbWljcm9waXAuaW5zdGFsbChcImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9naGFtYXJpYW4vcHl0aG9uY2svbWFzdGVyL2RvY3VtZW50YXRpb24vcHl0aG9uY2stMC4xLjAtcHkzLW5vbmUtYW55LndobFwiKVxuXG4jIFNldHVwIHB5dGVuc29yIHBhdGggZm9yIHB5b2RpZGUgZW52aXJvbm1lbnRcbmltcG9ydCBzeXNcbmltcG9ydCBvc1xuaW1wb3J0IG51bXB5IGFzIG5wXG5cbiMgQWRkIHRoZSBwcm9qZWN0IHJvb3QgdG8gcGF0aCBzbyB3ZSBjYW4gaW1wb3J0IHB5dGVuc29yXG5zeXMucGF0aC5pbnNlcnQoMCwgJy9ob21lL2FnaGFtYXJpL2dpdGh1Yi9jb21wb3NhYmxlX2tlcm5lbC92aXN1YWxpc2F0aW9uJylcblxuIyBJbXBvcnQgdGhlIGFjdHVhbCBDSyBtb2R1bGVzXG5mcm9tIHB5dGVuc29yLnRpbGVfZGlzdHJpYnV0aW9uIGltcG9ydCBtYWtlX3N0YXRpY190aWxlX2Rpc3RyaWJ1dGlvbiwgbWFrZV90aWxlX2Rpc3RyaWJ1dGlvbl9lbmNvZGluZ1xuZnJvbSBweXRlbnNvci50aWxlX3dpbmRvdyBpbXBvcnQgbWFrZV90aWxlX3dpbmRvdywgVGlsZVdpbmRvd1dpdGhTdGF0aWNEaXN0cmlidXRpb25cbmZyb20gcHl0ZW5zb3IudGVuc29yX3ZpZXcgaW1wb3J0IG1ha2VfdGVuc29yX3ZpZXdcbmZyb20gcHl0ZW5zb3IudGVuc29yX2Rlc2NyaXB0b3IgaW1wb3J0IG1ha2VfbmFpdmVfdGVuc29yX2Rlc2NyaXB0b3JfcGFja2VkXG5mcm9tIHB5dGVuc29yLnN0YXRpY19kaXN0cmlidXRlZF90ZW5zb3IgaW1wb3J0IG1ha2Vfc3RhdGljX2Rpc3RyaWJ1dGVkX3RlbnNvciJ9
</script>
</div>
</section>
</section>
<section id="what-is-a-tilewindow" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-tilewindow">What is a TileWindow?</h2>
<p>The fundamental challenge in GPU programming lies in the gap between logical tensor operations and the physical realities of memory access. While TileDistribution elegantly solves the problem of work assignment by mapping threads to tensor coordinates, it does not address how threads actually access the data at those coordinates. This is where TileWindow enters the picture, serving as the critical bridge between logical work assignment and physical memory operations.</p>
<p>TileWindow implements a distribution-aware windowing mechanism that transforms abstract coordinate mappings into concrete memory access patterns. The abstraction understands not just which data elements each thread needs, but also how to access them in a way that maximizes memory bandwidth utilization. This involves sophisticated techniques such as memory coalescing, where adjacent threads access adjacent memory locations, and vectorization, where multiple elements are loaded or stored in a single transaction.</p>
<p>The C++ implementation of TileWindow reveals its sophisticated architecture:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// From ck_tile/core/tensor/tile_window.hpp</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ck_tile/core/tensor/tile_window.hpp&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ck_tile/core/tensor/static_distributed_tensor.hpp&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ck_tile/core/algorithm/coordinate_transform.hpp&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> TensorView_<span class="op">,</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> WindowLengths_<span class="op">,</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> TileDistribution_<span class="op">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> tile_window_with_static_distribution</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> TensorView <span class="op">=</span> <span class="dt">remove_cvref_t</span><span class="op">&lt;</span>TensorView_<span class="op">&gt;;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Distribution <span class="op">=</span> <span class="dt">remove_cvref_t</span><span class="op">&lt;</span>TileDistribution_<span class="op">&gt;;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> DataType <span class="op">=</span> <span class="kw">typename</span> TensorView<span class="op">::</span>DataType<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Core components that define the window</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    TensorView <span class="va">tensor_view_</span><span class="op">;</span>      <span class="co">// View into the underlying tensor</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    Distribution <span class="va">distribution_</span><span class="op">;</span>    <span class="co">// How to distribute data across threads</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dt">index_t</span><span class="op">,</span> TensorView<span class="op">::</span>get_num_of_dimension<span class="op">()&gt;</span> <span class="va">origin_</span><span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Window-specific information</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> window_lengths <span class="op">=</span> WindowLengths<span class="op">{};</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">index_t</span> num_of_dimension <span class="op">=</span> TensorView<span class="op">::</span>get_num_of_dimension<span class="op">();</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constructor</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    CK_TILE_HOST_DEVICE <span class="kw">constexpr</span> tile_window_with_static_distribution<span class="op">(</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> TensorView<span class="op">&amp;</span> tensor_view<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> WindowLengths<span class="op">&amp;</span> <span class="co">/*window_lengths*/</span><span class="op">,</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> array<span class="op">&lt;</span><span class="dt">index_t</span><span class="op">,</span> num_of_dimension<span class="op">&gt;&amp;</span> origin<span class="op">,</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> Distribution<span class="op">&amp;</span> distribution<span class="op">)</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> <span class="va">tensor_view_</span><span class="op">{</span>tensor_view<span class="op">},</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>          <span class="va">distribution_</span><span class="op">{</span>distribution<span class="op">},</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>          <span class="va">origin_</span><span class="op">{</span>origin<span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">{}</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load operation with automatic coalescing</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> DistributedTensor<span class="op">&gt;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    CK_TILE_DEVICE <span class="dt">void</span> load<span class="op">(</span>DistributedTensor<span class="op">&amp;</span> dst_tensor<span class="op">)</span> <span class="at">const</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Sophisticated load implementation that:</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 1. Calculates optimal access pattern</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 2. Handles vectorization automatically</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 3. Ensures coalesced memory access</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 4. Manages boundary conditions</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="tilewindow-data-flow" class="level2">
<h2 class="anchored" data-anchor-id="tilewindow-data-flow">TileWindow Data Flow</h2>
<div class="mermaid">
flowchart LR
    subgraph "Step 1: Create Window"
        T["Tensor<br>[256, 256]"]
        O["Origin<br>(64, 64)"]
        W["Window Size<br>[32, 32]"]
    end
    
    subgraph "Step 2: Apply Distribution"
        TD["TileDistribution<br>Thread mapping"]
        TW["TileWindow<br>Created"]
    end
    
    subgraph "Step 3: Load Data"
        GM["Global Memory<br>Window region"]
        REG["Registers<br>Distributed tensor"]
    end
    
    T --&gt; TW
    O --&gt; TW
    W --&gt; TW
    TD --&gt; TW
    
    TW --&gt; GM
    GM --&gt;|"load()"| REG
    
    style TW fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style REG fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
</div>
</section>
<section id="creating-and-using-tilewindow" class="level2">
<h2 class="anchored" data-anchor-id="creating-and-using-tilewindow">Creating and Using TileWindow</h2>
<p>Let’s explore how to create and use a TileWindow in practice:</p>
<div>
<div id="pyodide-2" class="exercise-cell">

</div>
<script type="pyodide-2-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5pbXBvcnQgbnVtcHkgYXMgbnBcbmZyb20gcHl0ZW5zb3IudGlsZV93aW5kb3cgaW1wb3J0IG1ha2VfdGlsZV93aW5kb3dcbmZyb20gcHl0ZW5zb3IudGVuc29yX3ZpZXcgaW1wb3J0IG1ha2VfbmFpdmVfdGVuc29yX3ZpZXdfcGFja2VkXG5mcm9tIHB5dGVuc29yLnRpbGVfZGlzdHJpYnV0aW9uIGltcG9ydCBtYWtlX3N0YXRpY190aWxlX2Rpc3RyaWJ1dGlvbiwgbWFrZV90aWxlX2Rpc3RyaWJ1dGlvbl9lbmNvZGluZ1xuXG4jIENyZWF0ZSBhIHRlbnNvclxuZGF0YSA9IG5wLmFyYW5nZSg2NCwgZHR5cGU9bnAuZmxvYXQzMilcbnByaW50KFwiT3JpZ2luYWwgdGVuc29yICg4eDgpOlwiKVxucHJpbnQoZGF0YS5yZXNoYXBlKDgsIDgpKVxuXG4jIENyZWF0ZSBhIHRlbnNvciB2aWV3XG50ZW5zb3JfdmlldyA9IG1ha2VfbmFpdmVfdGVuc29yX3ZpZXdfcGFja2VkKGRhdGEsIGxlbmd0aHM9WzgsIDhdKVxuXG4jIENyZWF0ZSBhIHRpbGUgZGlzdHJpYnV0aW9uIGVuY29kaW5nIGZvciBhIDR4NCB3aW5kb3dcbiMgRWFjaCB0aHJlYWQgd2lsbCBoYW5kbGUgYSAxeDEgdGlsZSB3aXRoaW4gdGhlIHdpbmRvd1xuZW5jb2RpbmcgPSBtYWtlX3RpbGVfZGlzdHJpYnV0aW9uX2VuY29kaW5nKFxuICAgIHJzX2xlbmd0aHM9W10sICAjIE5vIHJlcGxpY2F0aW9uXG4gICAgaHNfbGVuZ3Roc3M9W1s0XSwgWzRdXSwgICMgNHg0IGhpZXJhcmNoaWNhbCBzdHJ1Y3R1cmVcbiAgICBwc190b19yaHNzX21ham9yPVtbMV0sIFsyXV0sICAjIFAgZGltZW5zaW9ucyBtYXAgdG8gSCBkaW1lbnNpb25zXG4gICAgcHNfdG9fcmhzc19taW5vcj1bWzBdLCBbMF1dLFxuICAgIHlzX3RvX3Joc19tYWpvcj1bMSwgMl0sICAjIFkgZGltZW5zaW9ucyBtYXAgdG8gSCBkaW1lbnNpb25zXG4gICAgeXNfdG9fcmhzX21pbm9yPVswLCAwXVxuKVxudGlsZV9kaXN0ID0gbWFrZV9zdGF0aWNfdGlsZV9kaXN0cmlidXRpb24oZW5jb2RpbmcpXG5cbiMgQ3JlYXRlIGEgdGlsZSB3aW5kb3cgYXQgcG9zaXRpb24gKDIsIDIpXG53aW5kb3cgPSBtYWtlX3RpbGVfd2luZG93KFxuICAgIHRlbnNvcl92aWV3PXRlbnNvcl92aWV3LFxuICAgIHdpbmRvd19sZW5ndGhzPVs0LCA0XSxcbiAgICBvcmlnaW49WzIsIDJdLFxuICAgIHRpbGVfZGlzdHJpYnV0aW9uPXRpbGVfZGlzdFxuKVxuXG5wcmludChmXCJcXG5UaWxlV2luZG93IGNyZWF0ZWQ6XCIpXG5wcmludChmXCItIFdpbmRvdyBzaXplOiB7d2luZG93LndpbmRvd19sZW5ndGhzfVwiKVxucHJpbnQoZlwiLSBXaW5kb3cgb3JpZ2luOiB7d2luZG93LndpbmRvd19vcmlnaW59XCIpXG5wcmludChmXCItIENvdmVycyBlbGVtZW50cyBmcm9tICgyLDIpIHRvICg1LDUpXCIpIn0=
</script>
</div>
</section>
<section id="understanding-window-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="understanding-window-coordinates">Understanding Window Coordinates</h2>
<section id="c-implementation-reference" class="level3">
<h3 class="anchored" data-anchor-id="c-implementation-reference">C++ Implementation Reference</h3>
<p>The TileWindow creation pattern shown above corresponds to the following C++ implementation:</p>
<p><strong>File</strong>: <code>include/ck_tile/core/tensor/tile_window.hpp</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Creating a tile window in practice</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> BlockTileShape<span class="op">,</span> <span class="kw">typename</span> DataType<span class="op">&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>__device__ <span class="kw">auto</span> create_input_window<span class="op">(</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> DataType<span class="op">*</span> <span class="ex">__restrict__</span> p_global<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index_t</span> M<span class="op">,</span> <span class="dt">index_t</span> N<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create tensor view</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> tensor_view <span class="op">=</span> make_tensor_view<span class="op">&lt;</span>AddressSpaceEnum<span class="op">::</span>Global<span class="op">&gt;(</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        p_global<span class="op">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        make_naive_tensor_descriptor_packed<span class="op">(</span>make_tuple<span class="op">(</span>M<span class="op">,</span> N<span class="op">)));</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define window parameters</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> window_lengths <span class="op">=</span> BlockTileShape<span class="op">{};</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> origin <span class="op">=</span> make_tuple<span class="op">(</span>blockIdx<span class="op">.</span>x <span class="op">*</span> window_lengths<span class="op">[</span>I0<span class="op">],</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                                   blockIdx<span class="op">.</span>y <span class="op">*</span> window_lengths<span class="op">[</span>I1<span class="op">]);</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create window with distribution</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> make_tile_window<span class="op">(</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        tensor_view<span class="op">,</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        window_lengths<span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        origin<span class="op">,</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        make_static_tile_distribution<span class="op">(</span>TileDistribution<span class="op">{}));</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The window creation process demonstrates several important principles of the CK framework. First, the window dimensions (2×2 in this example) are chosen to match the tile distribution pattern, ensuring that each thread has work to do. Second, the origin coordinates allow the window to target specific regions of the tensor, enabling techniques like overlapped tiling for convolutions or sliding window operations. Third, the integration with tile distribution means that the window automatically knows how to map its data to the appropriate threads, eliminating the need for manual index calculations.</p>
<p>In the C++ implementation, the tile window creation involves template instantiation that captures all these parameters at compile time:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// From ck_tile/core/tensor/tile_window.hpp</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> TensorView<span class="op">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> WindowLengths<span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> Origin<span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> Distribution<span class="op">&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>CK_TILE_HOST_DEVICE <span class="kw">constexpr</span> <span class="kw">auto</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>make_tile_window<span class="op">(</span><span class="at">const</span> TensorView<span class="op">&amp;</span> tensor_view<span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">const</span> WindowLengths<span class="op">&amp;</span> window_lengths<span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">const</span> Origin<span class="op">&amp;</span> origin<span class="op">,</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">const</span> Distribution<span class="op">&amp;</span> distribution<span class="op">)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create specialized window type based on distribution</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> WindowType <span class="op">=</span> tile_window_with_static_distribution<span class="op">&lt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        TensorView<span class="op">,</span> WindowLengths<span class="op">,</span> Distribution<span class="op">&gt;;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Construct window with all parameters</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> WindowType<span class="op">{</span>tensor_view<span class="op">,</span> window_lengths<span class="op">,</span> origin<span class="op">,</span> distribution<span class="op">};</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="loading-data-with-tilewindow" class="level2">
<h2 class="anchored" data-anchor-id="loading-data-with-tilewindow">Loading Data with TileWindow</h2>
<p>The load operation represents one of the most critical performance-sensitive operations in GPU kernel development. TileWindow’s load functionality transforms a high-level request (“load this tile of data”) into a series of optimized memory transactions that respect GPU hardware constraints while maximizing bandwidth utilization. This transformation involves several sophisticated techniques working in concert to achieve near-optimal performance.</p>
<p>The loading process begins with the tile window analyzing the distribution pattern to determine which data elements each thread needs to load. This analysis considers not just the logical mapping but also the physical memory layout, identifying opportunities for coalesced access where adjacent threads load from adjacent memory locations. The system then generates load instructions that take advantage of the GPU’s memory subsystem capabilities, including vector loads that can fetch multiple elements in a single transaction.</p>
<div>
<div id="pyodide-3" class="exercise-cell">

</div>
<script type="pyodide-3-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG4jIFZpc3VhbGl6ZSB3aGF0IGRhdGEgdGhlIHdpbmRvdyBjb3ZlcnNcbndpbmRvd19kYXRhID0gZGF0YVsyOjYsIDI6Nl0gICMgVGhlIDR4NCB3aW5kb3cgc3RhcnRpbmcgYXQgKDIsMilcbnByaW50KFwiRGF0YSBjb3ZlcmVkIGJ5IHRoZSB3aW5kb3c6XCIpXG5wcmludCh3aW5kb3dfZGF0YSlcblxuIyBTaG93IGhvdyB0aHJlYWRzIG1hcCB0byB0aGlzIGRhdGFcbnByaW50KFwiXFxuVGhyZWFkLXRvLWVsZW1lbnQgbWFwcGluZzpcIilcbnByaW50KFwiVGhyZWFkIChpLGopIC0+IEVsZW1lbnQgdmFsdWVcIilcbmZvciBpIGluIHJhbmdlKDQpOlxuICAgIGZvciBqIGluIHJhbmdlKDQpOlxuICAgICAgICB0aHJlYWRfaWQgPSBpICogNCArIGpcbiAgICAgICAgZWxlbWVudCA9IHdpbmRvd19kYXRhW2ksIGpdXG4gICAgICAgIHByaW50KGZcIlRocmVhZCAoe2l9LHtqfSkgLT4ge2VsZW1lbnR9XCIpIn0=
</script>
</div>
</section>
<section id="load-operation-architecture" class="level2">
<h2 class="anchored" data-anchor-id="load-operation-architecture">Load Operation Architecture</h2>
<div class="mermaid">
graph TB
    subgraph "Load Analysis"
        Analyze["Analyze access pattern<br>Detect coalescing opportunities"]
    end
    
    subgraph "Vectorization"
        V1["Scalar: 4 loads"]
        V2["Vector2: 2 loads"]
        V4["Vector4: 1 load"]
    end
    
    subgraph "Memory Transaction"
        Coal["Coalesced access<br>32 threads → 1 transaction"]
        NonCoal["Non-coalesced<br>32 threads → 32 transactions"]
    end
    
    subgraph "Result"
        Reg["Thread registers<br>Local data"]
    end
    
    Analyze --&gt; V1
    Analyze --&gt; V2
    Analyze --&gt; V4
    
    V4 --&gt; Coal
    V1 --&gt; NonCoal
    
    Coal --&gt; Reg
    NonCoal --&gt; Reg
    
    style V4 fill:#d1fae5,stroke:#10b981,stroke-width:2px
    style Coal fill:#d1fae5,stroke:#10b981,stroke-width:2px
    style NonCoal fill:#fee2e2,stroke:#ef4444,stroke-width:2px
</div>
</section>
<section id="memory-access-patterns" class="level2">
<h2 class="anchored" data-anchor-id="memory-access-patterns">Memory Access Patterns</h2>
<p>One of TileWindow’s key features is generating optimal memory access patterns:</p>
<div>
<div id="pyodide-4" class="exercise-cell">

</div>
<script type="pyodide-4-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgYW5hbHl6ZV93aW5kb3dfYWNjZXNzX3BhdHRlcm4od2luZG93LCBudW1fdGhyZWFkcz0xNik6XG4gICAgXCJcIlwiQW5hbHl6ZSBob3cgdGhyZWFkcyBhY2Nlc3MgbWVtb3J5IHRocm91Z2ggdGhlIHdpbmRvd1wiXCJcIlxuICAgIHByaW50KFwiTWVtb3J5IEFjY2VzcyBQYXR0ZXJuIEFuYWx5c2lzXCIpXG4gICAgcHJpbnQoXCI9XCIgKiA1MClcbiAgICBcbiAgICAjIFNpbXVsYXRlIGZpcnN0IHdhdmUgb2YgYWNjZXNzZXNcbiAgICBwcmludChcIlxcbkZpcnN0IGFjY2VzcyB3YXZlICh0aHJlYWRzIDAtNyk6XCIpXG4gICAgcHJpbnQoXCJUaHJlYWQgfCBXaW5kb3cgQ29vcmQgfCBHbG9iYWwgQ29vcmQgfCBMaW5lYXIgQWRkclwiKVxuICAgIHByaW50KFwiLVwiICogNTApXG4gICAgXG4gICAgb3JpZ2luID0gd2luZG93LndpbmRvd19vcmlnaW5cbiAgICBcbiAgICBmb3IgdGlkIGluIHJhbmdlKG1pbig4LCBudW1fdGhyZWFkcykpOlxuICAgICAgICAjIFRocmVhZCBwb3NpdGlvbiBpbiB3aW5kb3dcbiAgICAgICAgbG9jYWxfaSA9IHRpZCAvLyA0XG4gICAgICAgIGxvY2FsX2ogPSB0aWQgJSA0XG4gICAgICAgIFxuICAgICAgICAjIEdsb2JhbCBwb3NpdGlvblxuICAgICAgICBnbG9iYWxfaSA9IG9yaWdpblswXSArIGxvY2FsX2lcbiAgICAgICAgZ2xvYmFsX2ogPSBvcmlnaW5bMV0gKyBsb2NhbF9qXG4gICAgICAgIFxuICAgICAgICAjIExpbmVhciBhZGRyZXNzXG4gICAgICAgIGxpbmVhcl9hZGRyID0gZ2xvYmFsX2kgKiA4ICsgZ2xvYmFsX2ogICMgOCBpcyB0ZW5zb3Igd2lkdGhcbiAgICAgICAgXG4gICAgICAgIHByaW50KGZcIiAge3RpZDoyZH0gICB8ICh7bG9jYWxfaX0se2xvY2FsX2p9KSAgICAgICAgfCAoe2dsb2JhbF9pfSx7Z2xvYmFsX2p9KSAgICAgICAgfCB7bGluZWFyX2FkZHI6M2R9XCIpXG4gICAgXG4gICAgIyBDaGVjayBjb2FsZXNjaW5nXG4gICAgcHJpbnQoXCJcXG5Db2FsZXNjaW5nIEFuYWx5c2lzOlwiKVxuICAgIHByaW50KFwi4pyTIFRocmVhZHMgMC0zIGFjY2VzcyBhZGRyZXNzZXMgMTgtMjEgKGNvbnNlY3V0aXZlKVwiKVxuICAgIHByaW50KFwi4pyTIFRocmVhZHMgNC03IGFjY2VzcyBhZGRyZXNzZXMgMjYtMjkgKGNvbnNlY3V0aXZlKVwiKVxuICAgIHByaW50KFwi4pyTIFBlcmZlY3QgY29hbGVzY2luZyB3aXRoaW4gZWFjaCB3YXJwIVwiKVxuXG5hbmFseXplX3dpbmRvd19hY2Nlc3NfcGF0dGVybih3aW5kb3cpIn0=
</script>
</div>
</section>
<section id="advanced-window-operations" class="level2">
<h2 class="anchored" data-anchor-id="advanced-window-operations">Advanced Window Operations</h2>
<section id="sliding-windows" class="level3">
<h3 class="anchored" data-anchor-id="sliding-windows">Sliding Windows</h3>
<div>
<div id="pyodide-5" class="exercise-cell">

</div>
<script type="pyodide-5-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG4jIERlbW9uc3RyYXRlIHNsaWRpbmcgd2luZG93IHBhdHRlcm5cbmRlZiBzbGlkaW5nX3dpbmRvd19kZW1vKHRlbnNvcl9zaGFwZSwgd2luZG93X3NpemUsIHN0cmlkZSk6XG4gICAgXCJcIlwiU2hvdyBob3cgdG8gc2xpZGUgYSB3aW5kb3cgYWNyb3NzIGEgdGVuc29yXCJcIlwiXG4gICAgcHJpbnQoZlwiU2xpZGluZyB7d2luZG93X3NpemV9eHt3aW5kb3dfc2l6ZX0gd2luZG93IHdpdGggc3RyaWRlIHtzdHJpZGV9XCIpXG4gICAgcHJpbnQoXCJXaW5kb3cgcG9zaXRpb25zOlwiKVxuICAgIFxuICAgIHBvc2l0aW9ucyA9IFtdXG4gICAgZm9yIGkgaW4gcmFuZ2UoMCwgdGVuc29yX3NoYXBlWzBdIC0gd2luZG93X3NpemUgKyAxLCBzdHJpZGUpOlxuICAgICAgICBmb3IgaiBpbiByYW5nZSgwLCB0ZW5zb3Jfc2hhcGVbMV0gLSB3aW5kb3dfc2l6ZSArIDEsIHN0cmlkZSk6XG4gICAgICAgICAgICBwb3NpdGlvbnMuYXBwZW5kKChpLCBqKSlcbiAgICAgICAgICAgIHByaW50KGZcIiAgUG9zaXRpb24gKHtpfSx7an0pIGNvdmVycyAoe2l9LHtqfSkgdG8gKHtpK3dpbmRvd19zaXplLTF9LHtqK3dpbmRvd19zaXplLTF9KVwiKVxuICAgIFxuICAgIHJldHVybiBwb3NpdGlvbnNcblxuIyBDcmVhdGUgc2xpZGluZyB3aW5kb3dzXG5wb3NpdGlvbnMgPSBzbGlkaW5nX3dpbmRvd19kZW1vKHRlbnNvcl9zaGFwZT1bOCwgOF0sIHdpbmRvd19zaXplPTQsIHN0cmlkZT0yKVxucHJpbnQoZlwiXFxuVG90YWwgd2luZG93czoge2xlbihwb3NpdGlvbnMpfVwiKSJ9
</script>
</div>
</section>
<section id="overlapping-windows" class="level3">
<h3 class="anchored" data-anchor-id="overlapping-windows">Overlapping Windows</h3>
<div>
<div id="pyodide-6" class="exercise-cell">

</div>
<script type="pyodide-6-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG4jIERlbW9uc3RyYXRlIG92ZXJsYXBwaW5nIHdpbmRvd3MgZm9yIGNvbnZvbHV0aW9uLWxpa2Ugb3BlcmF0aW9uc1xuZGVmIGNyZWF0ZV9vdmVybGFwcGluZ193aW5kb3dzKHRlbnNvcl9zaGFwZSwgd2luZG93X3NpemUsIG92ZXJsYXApOlxuICAgIFwiXCJcIkNyZWF0ZSBvdmVybGFwcGluZyB3aW5kb3dzIGZvciBvcGVyYXRpb25zIGxpa2UgY29udm9sdXRpb25cIlwiXCJcbiAgICBzdHJpZGUgPSB3aW5kb3dfc2l6ZSAtIG92ZXJsYXBcbiAgICBcbiAgICBwcmludChmXCJDcmVhdGluZyB7d2luZG93X3NpemV9eHt3aW5kb3dfc2l6ZX0gd2luZG93cyB3aXRoIHtvdmVybGFwfSBvdmVybGFwXCIpXG4gICAgcHJpbnQoZlwiRWZmZWN0aXZlIHN0cmlkZToge3N0cmlkZX1cIilcbiAgICBcbiAgICB3aW5kb3dzID0gW11cbiAgICBmb3IgaSBpbiByYW5nZSgwLCB0ZW5zb3Jfc2hhcGVbMF0gLSB3aW5kb3dfc2l6ZSArIDEsIHN0cmlkZSk6XG4gICAgICAgIGZvciBqIGluIHJhbmdlKDAsIHRlbnNvcl9zaGFwZVsxXSAtIHdpbmRvd19zaXplICsgMSwgc3RyaWRlKTpcbiAgICAgICAgICAgIHdpbmRvd3MuYXBwZW5kKHtcbiAgICAgICAgICAgICAgICAnb3JpZ2luJzogKGksIGopLFxuICAgICAgICAgICAgICAgICdvdmVybGFwX2xlZnQnOiBqID4gMCxcbiAgICAgICAgICAgICAgICAnb3ZlcmxhcF90b3AnOiBpID4gMCxcbiAgICAgICAgICAgICAgICAnb3ZlcmxhcF9yaWdodCc6IGogKyB3aW5kb3dfc2l6ZSA8IHRlbnNvcl9zaGFwZVsxXSxcbiAgICAgICAgICAgICAgICAnb3ZlcmxhcF9ib3R0b20nOiBpICsgd2luZG93X3NpemUgPCB0ZW5zb3Jfc2hhcGVbMF1cbiAgICAgICAgICAgIH0pXG4gICAgXG4gICAgIyBTaG93IG92ZXJsYXAgcGF0dGVyblxuICAgIHByaW50KGZcIlxcbldpbmRvdyBvdmVybGFwIHBhdHRlcm4gKHtsZW4od2luZG93cyl9IHdpbmRvd3MpOlwiKVxuICAgIGZvciBpZHgsIHcgaW4gZW51bWVyYXRlKHdpbmRvd3NbOjRdKTogICMgU2hvdyBmaXJzdCBmZXdcbiAgICAgICAgb3ZlcmxhcHMgPSBbXVxuICAgICAgICBpZiB3WydvdmVybGFwX2xlZnQnXTogb3ZlcmxhcHMuYXBwZW5kKCdsZWZ0JylcbiAgICAgICAgaWYgd1snb3ZlcmxhcF90b3AnXTogb3ZlcmxhcHMuYXBwZW5kKCd0b3AnKVxuICAgICAgICBpZiB3WydvdmVybGFwX3JpZ2h0J106IG92ZXJsYXBzLmFwcGVuZCgncmlnaHQnKVxuICAgICAgICBpZiB3WydvdmVybGFwX2JvdHRvbSddOiBvdmVybGFwcy5hcHBlbmQoJ2JvdHRvbScpXG4gICAgICAgIFxuICAgICAgICBwcmludChmXCIgIFdpbmRvdyB7aWR4fSBhdCB7d1snb3JpZ2luJ119OiBvdmVybGFwcyB7JywgJy5qb2luKG92ZXJsYXBzKSBpZiBvdmVybGFwcyBlbHNlICdub25lJ31cIilcbiAgICBcbiAgICByZXR1cm4gd2luZG93c1xuXG4jIENyZWF0ZSBvdmVybGFwcGluZyB3aW5kb3dzXG53aW5kb3dzID0gY3JlYXRlX292ZXJsYXBwaW5nX3dpbmRvd3MoWzgsIDhdLCB3aW5kb3dfc2l6ZT0zLCBvdmVybGFwPTEpIn0=
</script>
</div>
</section>
</section>
<section id="computation-architecture" class="level2">
<h2 class="anchored" data-anchor-id="computation-architecture">Computation Architecture</h2>
<div class="mermaid">
graph TB
    subgraph "Load Phase"
        LW["Load Window<br>Global → Registers"]
    end
    
    subgraph "Compute Phase"
        C1["Thread-local compute<br>In registers"]
        C2["Warp-level shuffle<br>Data exchange"]
        C3["Block-level reduction<br>Shared memory"]
    end
    
    subgraph "Store Phase"
        SW["Store Window<br>Registers → Global"]
    end
    
    LW --&gt; C1
    C1 --&gt; C2
    C2 --&gt; C3
    C3 --&gt; SW
    
    style LW fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style C1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style SW fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
</div>
</section>
<section id="c-usage-example" class="level2">
<h2 class="anchored" data-anchor-id="c-usage-example">C++ Usage Example</h2>
<p>The real power of TileWindow comes from its C++ implementation:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Complete example: Matrix multiplication using TileWindow</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> AType<span class="op">,</span> <span class="kw">typename</span> BType<span class="op">,</span> <span class="kw">typename</span> CType<span class="op">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>__global__ <span class="dt">void</span> gemm_kernel_with_windows<span class="op">(</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> AType<span class="op">*</span> <span class="ex">__restrict__</span> a_ptr<span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> BType<span class="op">*</span> <span class="ex">__restrict__</span> b_ptr<span class="op">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    CType<span class="op">*</span> <span class="ex">__restrict__</span> c_ptr<span class="op">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index_t</span> M<span class="op">,</span> <span class="dt">index_t</span> N<span class="op">,</span> <span class="dt">index_t</span> K<span class="op">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create tensor views</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_tensor <span class="op">=</span> make_naive_tensor_view<span class="op">(</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        a_ptr<span class="op">,</span> make_tuple<span class="op">(</span>M<span class="op">,</span> K<span class="op">),</span> make_tuple<span class="op">(</span>K<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_tensor <span class="op">=</span> make_naive_tensor_view<span class="op">(</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        b_ptr<span class="op">,</span> make_tuple<span class="op">(</span>K<span class="op">,</span> N<span class="op">),</span> make_tuple<span class="op">(</span>N<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_tensor <span class="op">=</span> make_naive_tensor_view<span class="op">(</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        c_ptr<span class="op">,</span> make_tuple<span class="op">(</span>M<span class="op">,</span> N<span class="op">),</span> make_tuple<span class="op">(</span>N<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define tile sizes</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">index_t</span> tile_m <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">index_t</span> tile_n <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">index_t</span> tile_k <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create distributions</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_dist <span class="op">=</span> make_static_tile_distribution<span class="op">&lt;...&gt;();</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_dist <span class="op">=</span> make_static_tile_distribution<span class="op">&lt;...&gt;();</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_dist <span class="op">=</span> make_static_tile_distribution<span class="op">&lt;...&gt;();</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate tile position</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">index_t</span> block_m <span class="op">=</span> blockIdx<span class="op">.</span>y <span class="op">*</span> tile_m<span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">index_t</span> block_n <span class="op">=</span> blockIdx<span class="op">.</span>x <span class="op">*</span> tile_n<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create tile windows</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_window <span class="op">=</span> make_tile_window<span class="op">(</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        a_tensor<span class="op">,</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>tile_m<span class="op">,</span> tile_k<span class="op">),</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>block_m<span class="op">,</span> <span class="dv">0</span><span class="op">),</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        a_dist<span class="op">);</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_window <span class="op">=</span> make_tile_window<span class="op">(</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        b_tensor<span class="op">,</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>tile_k<span class="op">,</span> tile_n<span class="op">),</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span><span class="dv">0</span><span class="op">,</span> block_n<span class="op">),</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        b_dist<span class="op">);</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_window <span class="op">=</span> make_tile_window<span class="op">(</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        c_tensor<span class="op">,</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>tile_m<span class="op">,</span> tile_n<span class="op">),</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>block_m<span class="op">,</span> block_n<span class="op">),</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        c_dist<span class="op">);</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create distributed tensors for register storage</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_reg <span class="op">=</span> make_static_distributed_tensor<span class="op">&lt;</span>AType<span class="op">&gt;(</span>a_dist<span class="op">);</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_reg <span class="op">=</span> make_static_distributed_tensor<span class="op">&lt;</span>BType<span class="op">&gt;(</span>b_dist<span class="op">);</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_reg <span class="op">=</span> make_static_distributed_tensor<span class="op">&lt;</span>CType<span class="op">&gt;(</span>c_dist<span class="op">);</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize accumulator</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    c_reg<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Main GEMM loop</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">index_t</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> K<span class="op">;</span> k <span class="op">+=</span> tile_k<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update window positions</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>        a_window<span class="op">.</span>set_window_origin<span class="op">(</span>make_tuple<span class="op">(</span><span class="dv">0</span><span class="op">,</span> k<span class="op">));</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>        b_window<span class="op">.</span>set_window_origin<span class="op">(</span>make_tuple<span class="op">(</span>k<span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Load tiles</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>        a_window<span class="op">.</span>load<span class="op">(</span>a_reg<span class="op">);</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        b_window<span class="op">.</span>load<span class="op">(</span>b_reg<span class="op">);</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Compute</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        gemm<span class="op">(</span>a_reg<span class="op">,</span> b_reg<span class="op">,</span> c_reg<span class="op">);</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Store result</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    c_window<span class="op">.</span>store<span class="op">(</span>c_reg<span class="op">);</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="load-compute-store-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="load-compute-store-pipeline">Load-Compute-Store Pipeline</h2>
<div class="mermaid">
flowchart LR
    subgraph "Iteration i"
        L1["Load A[i]<br>Load B[i]"]
        C1["Compute<br>C += A[i] × B[i]"]
    end
    
    subgraph "Iteration i+1"
        L2["Load A[i+1]<br>Load B[i+1]"]
        C2["Compute<br>C += A[i+1] × B[i+1]"]
    end
    
    subgraph "Final"
        S["Store C"]
    end
    
    L1 --&gt; C1
    C1 --&gt; L2
    L2 --&gt; C2
    C2 --&gt; S
    
    style L1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style C1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style S fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
</div>
</section>
<section id="pipeline-optimization" class="level2">
<h2 class="anchored" data-anchor-id="pipeline-optimization">Pipeline Optimization</h2>
<div class="mermaid">
graph TB
    subgraph "Basic Pipeline"
        B1["Load"] --&gt; B2["Compute"] --&gt; B3["Store"]
        BTime["Time: 3 units"]
    end
    
    subgraph "Software Pipelining"
        P1["Load[i+1]"]
        P2["Compute[i]"]
        P3["Store[i-1]"]
        PTime["Time: 1 unit per iteration"]
    end
    
    subgraph "Double Buffering"
        DB1["Buffer A: Load"]
        DB2["Buffer B: Compute"]
        DBSwap["Swap buffers"]
    end
    
    B3 --&gt; P1
    P1 --&gt; P2
    P2 --&gt; P3
    
    P3 --&gt; DB1
    DB1 --&gt; DB2
    DB2 --&gt; DBSwap
    
    style P1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style P2 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style P3 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
</div>
</section>
<section id="window-configuration-space" class="level2">
<h2 class="anchored" data-anchor-id="window-configuration-space">Window Configuration Space</h2>
<div class="mermaid">
graph TB
    subgraph "Window Parameters"
        Size["Window Size<br>Trade-off: registers vs reuse"]
        Origin["Window Origin<br>Starting position"]
        Stride["Window Stride<br>Overlap pattern"]
    end
    
    subgraph "Performance Factors"
        Reg["Register Usage<br>Limited resource"]
        Reuse["Data Reuse<br>Bandwidth savings"]
        Coal["Coalescing<br>Memory efficiency"]
    end
    
    subgraph "Optimal Configuration"
        Opt["Balance all factors<br>Architecture-specific"]
    end
    
    Size --&gt; Reg
    Size --&gt; Reuse
    Origin --&gt; Coal
    Stride --&gt; Reuse
    
    Reg --&gt; Opt
    Reuse --&gt; Opt
    Coal --&gt; Opt
    
    style Opt fill:#d1fae5,stroke:#10b981,stroke-width:3px
</div>
</section>
<section id="best-practices" class="level2">
<h2 class="anchored" data-anchor-id="best-practices">Best Practices</h2>
<section id="window-size-selection" class="level3">
<h3 class="anchored" data-anchor-id="window-size-selection">1. Window Size Selection</h3>
<div>
<div id="pyodide-7" class="exercise-cell">

</div>
<script type="pyodide-7-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgcmVjb21tZW5kX3dpbmRvd19zaXplKHRlbnNvcl9zaGFwZSwgYXZhaWxhYmxlX3JlZ2lzdGVycywgZWxlbWVudHNfcGVyX3RocmVhZCk6XG4gICAgXCJcIlwiUmVjb21tZW5kIG9wdGltYWwgd2luZG93IHNpemUgYmFzZWQgb24gY29uc3RyYWludHNcIlwiXCJcbiAgICBwcmludChcIldpbmRvdyBTaXplIFJlY29tbWVuZGF0aW9uXCIpXG4gICAgcHJpbnQoXCI9XCIgKiA1MClcbiAgICBwcmludChmXCJUZW5zb3Igc2hhcGU6IHt0ZW5zb3Jfc2hhcGV9XCIpXG4gICAgcHJpbnQoZlwiQXZhaWxhYmxlIHJlZ2lzdGVycyBwZXIgdGhyZWFkOiB7YXZhaWxhYmxlX3JlZ2lzdGVyc31cIilcbiAgICBwcmludChmXCJFbGVtZW50cyBwZXIgdGhyZWFkOiB7ZWxlbWVudHNfcGVyX3RocmVhZH1cIilcbiAgICBcbiAgICAjIENhbGN1bGF0ZSBtYXhpbXVtIHdpbmRvdyBzaXplIGJhc2VkIG9uIHJlZ2lzdGVyIGNvbnN0cmFpbnRzXG4gICAgbWF4X3dpbmRvd19lbGVtZW50cyA9IGF2YWlsYWJsZV9yZWdpc3RlcnMgLy8gZWxlbWVudHNfcGVyX3RocmVhZFxuICAgIG1heF93aW5kb3dfZGltID0gaW50KG1heF93aW5kb3dfZWxlbWVudHMgKiogMC41KVxuICAgIFxuICAgICMgQ29uc2lkZXIgY29tbW9uIHRpbGUgc2l6ZXNcbiAgICBjb21tb25fc2l6ZXMgPSBbOCwgMTYsIDMyLCA2NCwgMTI4XVxuICAgIHJlY29tbWVuZGVkID0gW11cbiAgICBcbiAgICBmb3Igc2l6ZSBpbiBjb21tb25fc2l6ZXM6XG4gICAgICAgIGlmIHNpemUgPD0gbWF4X3dpbmRvd19kaW0gYW5kIGFsbChkaW0gJSBzaXplID09IDAgZm9yIGRpbSBpbiB0ZW5zb3Jfc2hhcGUpOlxuICAgICAgICAgICAgcmVjb21tZW5kZWQuYXBwZW5kKHNpemUpXG4gICAgXG4gICAgcHJpbnQoZlwiXFxuUmVjb21tZW5kZWQgd2luZG93IHNpemVzOiB7cmVjb21tZW5kZWR9XCIpXG4gICAgaWYgcmVjb21tZW5kZWQ6XG4gICAgICAgIG9wdGltYWwgPSByZWNvbW1lbmRlZFstMV0gICMgTGFyZ2VzdCB0aGF0IGZpdHNcbiAgICAgICAgcHJpbnQoZlwiT3B0aW1hbCBjaG9pY2U6IHtvcHRpbWFsfXh7b3B0aW1hbH1cIilcbiAgICAgICAgcHJpbnQoZlwiICAtIFVzZXMge29wdGltYWwqb3B0aW1hbCplbGVtZW50c19wZXJfdGhyZWFkfSByZWdpc3RlcnMgcGVyIHRocmVhZFwiKVxuICAgICAgICBwcmludChmXCIgIC0gQWNoaWV2ZXMgeyhvcHRpbWFsKm9wdGltYWwpL21heF93aW5kb3dfZWxlbWVudHMqMTAwOi4xZn0lIHJlZ2lzdGVyIHV0aWxpemF0aW9uXCIpXG4gICAgXG4gICAgcmV0dXJuIHJlY29tbWVuZGVkXG5cbiMgRXhhbXBsZSByZWNvbW1lbmRhdGlvblxucmVjb21tZW5kX3dpbmRvd19zaXplKFxuICAgIHRlbnNvcl9zaGFwZT1bMjU2LCAyNTZdLFxuICAgIGF2YWlsYWJsZV9yZWdpc3RlcnM9MjU2LFxuICAgIGVsZW1lbnRzX3Blcl90aHJlYWQ9NFxuKSJ9
</script>
</div>
</section>
<section id="access-pattern-optimization" class="level3">
<h3 class="anchored" data-anchor-id="access-pattern-optimization">2. Access Pattern Optimization</h3>
<div>
<div id="pyodide-8" class="exercise-cell">

</div>
<script type="pyodide-8-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOmZhbHNlLCJlY2hvIjp0cnVlLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJvdXRwdXQiOnRydWV9LCJjb2RlIjoiXG5kZWYgb3B0aW1pemVfYWNjZXNzX3BhdHRlcm4od2luZG93X3NoYXBlLCB0aHJlYWRfYmxvY2tfc2hhcGUpOlxuICAgIFwiXCJcIkRldGVybWluZSBvcHRpbWFsIGFjY2VzcyBwYXR0ZXJuIGZvciBjb2FsZXNjaW5nXCJcIlwiXG4gICAgcHJpbnQoXCJBY2Nlc3MgUGF0dGVybiBPcHRpbWl6YXRpb25cIilcbiAgICBwcmludChcIj1cIiAqIDUwKVxuICAgIHByaW50KGZcIldpbmRvdyBzaGFwZToge3dpbmRvd19zaGFwZX1cIilcbiAgICBwcmludChmXCJUaHJlYWQgYmxvY2s6IHt0aHJlYWRfYmxvY2tfc2hhcGV9XCIpXG4gICAgXG4gICAgIyBDYWxjdWxhdGUgdGhyZWFkcyBwZXIgcm93IGZvciBjb2FsZXNjaW5nXG4gICAgdGhyZWFkc19wZXJfcm93ID0gdGhyZWFkX2Jsb2NrX3NoYXBlWzFdXG4gICAgZWxlbWVudHNfcGVyX3JvdyA9IHdpbmRvd19zaGFwZVsxXVxuICAgIFxuICAgIGlmIGVsZW1lbnRzX3Blcl9yb3cgJSB0aHJlYWRzX3Blcl9yb3cgPT0gMDpcbiAgICAgICAgcHJpbnQoXCJcXG7inJMgUGVyZmVjdCBjb2FsZXNjaW5nIHBvc3NpYmxlIVwiKVxuICAgICAgICBwcmludChmXCIgIEVhY2ggdGhyZWFkIGxvYWRzIHtlbGVtZW50c19wZXJfcm93IC8vIHRocmVhZHNfcGVyX3Jvd30gY29uc2VjdXRpdmUgZWxlbWVudHNcIilcbiAgICAgICAgYWNjZXNzX3BhdHRlcm4gPSBcInJvdy1tYWpvciBjb2FsZXNjZWRcIlxuICAgIGVsc2U6XG4gICAgICAgIHByaW50KFwiXFxu4pqgIFBhcnRpYWwgY29hbGVzY2luZ1wiKVxuICAgICAgICBwcmludChcIiAgQ29uc2lkZXIgYWRqdXN0aW5nIHdpbmRvdyBvciB0aHJlYWQgYmxvY2sgZGltZW5zaW9uc1wiKVxuICAgICAgICBhY2Nlc3NfcGF0dGVybiA9IFwicm93LW1ham9yIHBhcnRpYWxcIlxuICAgIFxuICAgICMgU3VnZ2VzdCB2ZWN0b3JpemF0aW9uXG4gICAgdmVjdG9yX3NpemVzID0gWzQsIDIsIDFdXG4gICAgZm9yIHZlY19zaXplIGluIHZlY3Rvcl9zaXplczpcbiAgICAgICAgaWYgZWxlbWVudHNfcGVyX3JvdyAlICh0aHJlYWRzX3Blcl9yb3cgKiB2ZWNfc2l6ZSkgPT0gMDpcbiAgICAgICAgICAgIHByaW50KGZcIlxcblZlY3Rvcml6YXRpb246IFVzZSBmbG9hdHt2ZWNfc2l6ZX0gZm9yIG9wdGltYWwgbG9hZHNcIilcbiAgICAgICAgICAgIHByaW50KGZcIiAge2VsZW1lbnRzX3Blcl9yb3cgLy8gKHRocmVhZHNfcGVyX3JvdyAqIHZlY19zaXplKX0gdmVjdG9yIGxvYWRzIHBlciB0aHJlYWRcIilcbiAgICAgICAgICAgIGJyZWFrXG4gICAgXG4gICAgcmV0dXJuIGFjY2Vzc19wYXR0ZXJuXG5cbiMgT3B0aW1pemUgZm9yIGNvbW1vbiBjb25maWd1cmF0aW9uc1xub3B0aW1pemVfYWNjZXNzX3BhdHRlcm4oXG4gICAgd2luZG93X3NoYXBlPVszMiwgMzJdLFxuICAgIHRocmVhZF9ibG9ja19zaGFwZT1bOCwgMzJdXG4pIn0=
</script>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>TileWindow provides: - <strong>Automatic optimization</strong>: Generates optimal memory access patterns - <strong>Distribution awareness</strong>: Works seamlessly with TileDistribution - <strong>Flexible windowing</strong>: Supports various access patterns and window configurations - <strong>Zero overhead</strong>: Compile-time optimization in C++ - <strong>Safety</strong>: Automatic boundary handling</p>
<p>Key benefits: 1. <strong>Performance</strong>: Achieves peak memory bandwidth through coalescing and vectorization 2. <strong>Productivity</strong>: Eliminates manual memory management code 3. <strong>Correctness</strong>: Automatic boundary checking and handling 4. <strong>Composability</strong>: Integrates cleanly with other CK abstractions</p>
<p>The TileWindow abstraction is essential for building high-performance GPU kernels, providing a clean interface for complex memory access patterns while maintaining peak performance.</p>


<!-- -->

<script type="pyodide-data">
eyJvcHRpb25zIjp7ImVudiI6eyJQTE9UTFlfUkVOREVSRVIiOiJwbG90bHlfbWltZXR5cGUifSwiaW5kZXhVUkwiOiJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvcHlvZGlkZS92MC4yNy4wL2Z1bGwvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsicHlvZGlkZV9odHRwIiwibWljcm9waXAiLCJpcHl0aG9uIiwibnVtcHkiLCJwYW5kYXMiLCJzeW1weSIsIm1pY3JvcGlwIl19fQ==
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJweW9kaWRlLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl84ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS04LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtOC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzggPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzgsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl83ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS03LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzcgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl82ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzYgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzYsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS01LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzUgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzUsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl80ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS00LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzQgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8zID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzMgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0yLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzIgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3B5b2RpZGVfdmFsdWVfMSA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRQeXRob24sIGI2NERlY29kZX0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0xLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcInB5b2RpZGUtMS1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBQeXRob24gY29kZVxuICBjb25zdCByZXN1bHQgPSBweW9kaWRlT2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjFcIiBpbiBweW9kaWRlT2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgcHl0aG9uXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFB5dGhvbihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHB5b2RpZGVPanMucmVuZGVyZWRPanNbXCIxXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6InB5b2RpZGUtcHJlbHVkZSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InB5b2RpZGVPanMgPSB7XG4gIGNvbnN0IHtcbiAgICBQeW9kaWRlRXZhbHVhdG9yLFxuICAgIFB5b2RpZGVFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBQeXRob24sXG4gICAgc3RhcnRQeW9kaWRlV29ya2VyLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGgsXG4gIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHN0YXR1c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1zdGF0dXNcIik7XG4gIGNvbnN0IGluZGljYXRvckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGluZGljYXRvckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiZC1ub25lXCIpO1xuXG4gIGxldCBzdGF0dXNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICBzdGF0dXNUZXh0LmNsYXNzTGlzdCA9IFwiZXhlcmNpc2UtbG9hZGluZy1kZXRhaWxzXCI7XG4gIHN0YXR1c1RleHQgPSBzdGF0dXNDb250YWluZXIuYXBwZW5kQ2hpbGQoc3RhdHVzVGV4dCk7XG4gIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5pdGlhbGlzZWA7XG5cbiAgLy8gSG9pc3QgaW5kaWNhdG9yIG91dCBmcm9tIGZpbmFsIHNsaWRlIHdoZW4gcnVubmluZyB1bmRlciByZXZlYWxcbiAgY29uc3QgcmV2ZWFsU3RhdHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgLmV4ZXJjaXNlLWxvYWRpbmctaW5kaWNhdG9yXCIpO1xuICBpZiAocmV2ZWFsU3RhdHVzKSB7XG4gICAgcmV2ZWFsU3RhdHVzLnJlbW92ZSgpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2ZWFsID4gLnNsaWRlc1wiKS5hcHBlbmRDaGlsZChyZXZlYWxTdGF0dXMpO1xuICB9XG5cbiAgLy8gTWFrZSBhbnkgcmV2ZWFsIHNsaWRlcyB3aXRoIGxpdmUgY2VsbHMgc2Nyb2xsYWJsZVxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJldmVhbCAuZXhlcmNpc2UtY2VsbFwiKS5mb3JFYWNoKChlbCkgPT4ge1xuICAgIGVsLmNsb3Nlc3QoJ3NlY3Rpb24uc2xpZGUnKS5jbGFzc0xpc3QuYWRkKFwic2Nyb2xsYWJsZVwiKTtcbiAgfSlcblxuICAvLyBQeW9kaWRlIHN1cHBsZW1lbnRhbCBkYXRhIGFuZCBvcHRpb25zXG4gIGNvbnN0IGRhdGFDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcInB5b2RpZGUtZGF0YVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGI2NERlY29kZShkYXRhQ29udGVudCkpO1xuXG4gIC8vIEdyYWIgbGlzdCBvZiByZXNvdXJjZXMgdG8gYmUgZG93bmxvYWRlZFxuICBjb25zdCBmaWxlc0NvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwidmZzLWZpbGVcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBmaWxlcyA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGZpbGVzQ29udGVudCkpO1xuXG4gIGxldCBweW9kaWRlUHJvbWlzZSA9IChhc3luYyAoKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBQeW9kaWRlYDtcbiAgICBjb25zdCBweW9kaWRlID0gYXdhaXQgc3RhcnRQeW9kaWRlV29ya2VyKGRhdGEub3B0aW9ucyk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6IG1pY3JvcGlwYDtcbiAgICBhd2FpdCBweW9kaWRlLmxvYWRQYWNrYWdlKFwibWljcm9waXBcIik7XG4gICAgY29uc3QgbWljcm9waXAgPSBhd2FpdCBweW9kaWRlLnB5aW1wb3J0KFwibWljcm9waXBcIik7XG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gbWljcm9waXAuaW5zdGFsbChwa2cpO1xuICAgIH0pLnJlZHVjZSgoY3VyLCBuZXh0KSA9PiBjdXIudGhlbihuZXh0KSwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIGF3YWl0IG1pY3JvcGlwLmRlc3Ryb3koKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHB5b2RpZGUuRlMubWtkaXIocGF0aCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBpZiAoZS5uYW1lICE9PSBcIkVycm5vRXJyb3JcIikgdGhyb3cgZTtcbiAgICAgICAgICBpZiAoZS5lcnJubyAhPT0gMjApIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yVGV4dFB0ciA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5fc3RyZXJyb3IoZS5lcnJubyk7XG4gICAgICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBweW9kaWRlLl9tb2R1bGUuVVRGOFRvU3RyaW5nKGVycm9yVGV4dFB0cik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpbGVzeXN0ZW0gRXJyb3IgJHtlLmVycm5vfSBcIiR7ZXJyb3JUZXh0fVwiLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHB5b2RpZGUuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUubmFtZSAhPT0gXCJFcnJub0Vycm9yXCIpIHRocm93IGU7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dFB0ciA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5fc3RyZXJyb3IoZS5lcnJubyk7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5VVEY4VG9TdHJpbmcoZXJyb3JUZXh0UHRyKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yICR7ZS5lcnJub30gXCIke2Vycm9yVGV4dH1cIi5gKTtcbiAgICAgIH1cbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgUHlvZGlkZSBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBQeXRob24ocHlvZGlkZSk7XG5cbiAgICBzdGF0dXNUZXh0LnJlbW92ZSgpO1xuICAgIGlmIChzdGF0dXNDb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoID09IDApIHtcbiAgICAgIHN0YXR1c0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcHlvZGlkZTtcbiAgfSkoKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgc3RhdHVzVGV4dC5zdHlsZS5jb2xvciA9IFwidmFyKC0tZXhlcmNpc2UtZWRpdG9yLWhsLWVyLCAjQUQwMDAwKVwiO1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBlcnIubWVzc2FnZTtcbiAgICAvL2luZGljYXRvckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLnNwaW5uZXItZ3Jvd1wiKS5jbGFzc0xpc3QuYWRkKFwiZC1ub25lXCIpO1xuICAgIHRocm93IGVycjtcbiAgfSk7XG5cbiAgLy8gS2VlcCB0cmFjayBvZiBpbml0aWFsIE9KUyBibG9jayByZW5kZXJcbiAgY29uc3QgcmVuZGVyZWRPanMgPSB7fTtcblxuICBjb25zdCBwcm9jZXNzID0gYXN5bmMgKGNvbnRleHQsIGlucHV0cykgPT4ge1xuICAgIGNvbnN0IHB5b2RpZGUgPSBhd2FpdCBweW9kaWRlUHJvbWlzZTtcbiAgICBjb25zdCBldmFsdWF0b3IgPSBuZXcgUHlvZGlkZUV2YWx1YXRvcihweW9kaWRlLCBjb250ZXh0KTtcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBweW9kaWRlUHJvbWlzZSxcbiAgICByZW5kZXJlZE9qcyxcbiAgICBwcm9jZXNzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../concepts";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb5" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Tile Window - Data Access Gateway"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">  live-html:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    mermaid:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">      theme: default</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>The TileWindow abstraction represents the culmination of the CK framework's approach to efficient tensor data access on GPUs. While TileDistribution determines the mapping between threads and tensor coordinates, TileWindow provides the actual mechanism for loading and storing data with optimal memory access patterns. This abstraction encapsulates the complexity of coalesced memory accesses, vectorization, and boundary handling into a clean interface that enables developers to focus on algorithmic logic rather than low-level memory management.</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>At its core, TileWindow implements a sophisticated windowing mechanism that views a subset of a larger tensor through the lens of a tile distribution. This windowing is not merely a simple sub-tensor extraction but a distribution-aware view that automatically generates the most efficient memory access patterns for the underlying hardware. The system achieves this by combining knowledge of the tensor's layout, the distribution pattern, and the GPU's memory subsystem characteristics to generate optimized load and store operations.</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">### TileWindow Architecture</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Components"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="in">        TV["TensorView&lt;br/&gt;Data source"]</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="in">        TD["TileDistribution&lt;br/&gt;Thread mapping"]</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="in">        TW["TileWindow&lt;br/&gt;Access gateway"]</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="in">        DT["DistributedTensor&lt;br/&gt;Register storage"]</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Operations"</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="in">        Load["Load&lt;br/&gt;Global → Registers"]</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="in">        Compute["Compute&lt;br/&gt;In registers"]</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="in">        Store["Store&lt;br/&gt;Registers → Global"]</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Optimizations"</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="in">        Coal["Coalescing&lt;br/&gt;Adjacent access"]</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="in">        Vec["Vectorization&lt;br/&gt;Multi-element ops"]</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="in">        Bank["Bank conflict&lt;br/&gt;avoidance"]</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="in">    TV --&gt; TW</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="in">    TD --&gt; TW</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="in">    TW --&gt; DT</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="in">    TW --&gt; Load</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="in">    Load --&gt; Compute</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="in">    Compute --&gt; Store</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="in">    Load --&gt; Coal</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="in">    Load --&gt; Vec</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="in">    Store --&gt; Bank</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="in">    style TW fill:#e3f2fd,stroke:#1976d2,stroke-width:3px</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="in">    style DT fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="in">    style Coal fill:#fff3e0,stroke:#f57c00,stroke-width:2px</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| autorun: true</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-install pythonck package</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> micropip</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> micropip.install(<span class="st">"https://raw.githubusercontent.com/ghamarian/pythonck/master/documentation/pythonck-0.1.0-py3-none-any.whl"</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup pytensor path for pyodide environment</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the project root to path so we can import pytensor</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">'/home/aghamari/github/composable_kernel/visualisation'</span>)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the actual CK modules</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tile_distribution <span class="im">import</span> make_static_tile_distribution, make_tile_distribution_encoding</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tile_window <span class="im">import</span> make_tile_window, TileWindowWithStaticDistribution</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tensor_view <span class="im">import</span> make_tensor_view</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tensor_descriptor <span class="im">import</span> make_naive_tensor_descriptor_packed</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.static_distributed_tensor <span class="im">import</span> make_static_distributed_tensor</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is a TileWindow?</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>The fundamental challenge in GPU programming lies in the gap between logical tensor operations and the physical realities of memory access. While TileDistribution elegantly solves the problem of work assignment by mapping threads to tensor coordinates, it does not address how threads actually access the data at those coordinates. This is where TileWindow enters the picture, serving as the critical bridge between logical work assignment and physical memory operations.</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>TileWindow implements a distribution-aware windowing mechanism that transforms abstract coordinate mappings into concrete memory access patterns. The abstraction understands not just which data elements each thread needs, but also how to access them in a way that maximizes memory bandwidth utilization. This involves sophisticated techniques such as memory coalescing, where adjacent threads access adjacent memory locations, and vectorization, where multiple elements are loaded or stored in a single transaction.</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>The C++ implementation of TileWindow reveals its sophisticated architecture:</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a><span class="co">// From ck_tile/core/tensor/tile_window.hpp</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ck_tile/core/tensor/tile_window.hpp&gt;</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ck_tile/core/tensor/static_distributed_tensor.hpp&gt;</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ck_tile/core/algorithm/coordinate_transform.hpp&gt;</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> TensorView_<span class="op">,</span> </span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> WindowLengths_<span class="op">,</span> </span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> TileDistribution_<span class="op">&gt;</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> tile_window_with_static_distribution</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> TensorView <span class="op">=</span> <span class="dt">remove_cvref_t</span><span class="op">&lt;</span>TensorView_<span class="op">&gt;;</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Distribution <span class="op">=</span> <span class="dt">remove_cvref_t</span><span class="op">&lt;</span>TileDistribution_<span class="op">&gt;;</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> DataType <span class="op">=</span> <span class="kw">typename</span> TensorView<span class="op">::</span>DataType<span class="op">;</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Core components that define the window</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    TensorView <span class="va">tensor_view_</span><span class="op">;</span>      <span class="co">// View into the underlying tensor</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    Distribution <span class="va">distribution_</span><span class="op">;</span>    <span class="co">// How to distribute data across threads</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dt">index_t</span><span class="op">,</span> TensorView<span class="op">::</span>get_num_of_dimension<span class="op">()&gt;</span> <span class="va">origin_</span><span class="op">;</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Window-specific information</span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> window_lengths <span class="op">=</span> WindowLengths<span class="op">{};</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">index_t</span> num_of_dimension <span class="op">=</span> TensorView<span class="op">::</span>get_num_of_dimension<span class="op">();</span></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constructor</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>    CK_TILE_HOST_DEVICE <span class="kw">constexpr</span> tile_window_with_static_distribution<span class="op">(</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> TensorView<span class="op">&amp;</span> tensor_view<span class="op">,</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> WindowLengths<span class="op">&amp;</span> <span class="co">/*window_lengths*/</span><span class="op">,</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> array<span class="op">&lt;</span><span class="dt">index_t</span><span class="op">,</span> num_of_dimension<span class="op">&gt;&amp;</span> origin<span class="op">,</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> Distribution<span class="op">&amp;</span> distribution<span class="op">)</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> <span class="va">tensor_view_</span><span class="op">{</span>tensor_view<span class="op">},</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>          <span class="va">distribution_</span><span class="op">{</span>distribution<span class="op">},</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>          <span class="va">origin_</span><span class="op">{</span>origin<span class="op">}</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    <span class="op">{}</span></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load operation with automatic coalescing</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> DistributedTensor<span class="op">&gt;</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>    CK_TILE_DEVICE <span class="dt">void</span> load<span class="op">(</span>DistributedTensor<span class="op">&amp;</span> dst_tensor<span class="op">)</span> <span class="at">const</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Sophisticated load implementation that:</span></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 1. Calculates optimal access pattern</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 2. Handles vectorization automatically</span></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 3. Ensures coalesced memory access</span></span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 4. Manages boundary conditions</span></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a><span class="fu">## TileWindow Data Flow</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Step 1: Create Window"</span></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a><span class="in">        T["Tensor&lt;br/&gt;[256, 256]"]</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a><span class="in">        O["Origin&lt;br/&gt;(64, 64)"]</span></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a><span class="in">        W["Window Size&lt;br/&gt;[32, 32]"]</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Step 2: Apply Distribution"</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a><span class="in">        TD["TileDistribution&lt;br/&gt;Thread mapping"]</span></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a><span class="in">        TW["TileWindow&lt;br/&gt;Created"]</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Step 3: Load Data"</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a><span class="in">        GM["Global Memory&lt;br/&gt;Window region"]</span></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a><span class="in">        REG["Registers&lt;br/&gt;Distributed tensor"]</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a><span class="in">    T --&gt; TW</span></span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a><span class="in">    O --&gt; TW</span></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a><span class="in">    W --&gt; TW</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a><span class="in">    TD --&gt; TW</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a><span class="in">    TW --&gt; GM</span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a><span class="in">    GM --&gt;|"load()"| REG</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a><span class="in">    style TW fill:#e3f2fd,stroke:#1976d2,stroke-width:3px</span></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a><span class="in">    style REG fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating and Using TileWindow</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>Let's explore how to create and use a TileWindow in practice:</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tile_window <span class="im">import</span> make_tile_window</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tensor_view <span class="im">import</span> make_naive_tensor_view_packed</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytensor.tile_distribution <span class="im">import</span> make_static_tile_distribution, make_tile_distribution_encoding</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tensor</span></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.arange(<span class="dv">64</span>, dtype<span class="op">=</span>np.float32)</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original tensor (8x8):"</span>)</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.reshape(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tensor view</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>tensor_view <span class="op">=</span> make_naive_tensor_view_packed(data, lengths<span class="op">=</span>[<span class="dv">8</span>, <span class="dv">8</span>])</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tile distribution encoding for a 4x4 window</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Each thread will handle a 1x1 tile within the window</span></span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>encoding <span class="op">=</span> make_tile_distribution_encoding(</span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>    rs_lengths<span class="op">=</span>[],  <span class="co"># No replication</span></span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>    hs_lengthss<span class="op">=</span>[[<span class="dv">4</span>], [<span class="dv">4</span>]],  <span class="co"># 4x4 hierarchical structure</span></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>    ps_to_rhss_major<span class="op">=</span>[[<span class="dv">1</span>], [<span class="dv">2</span>]],  <span class="co"># P dimensions map to H dimensions</span></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>    ps_to_rhss_minor<span class="op">=</span>[[<span class="dv">0</span>], [<span class="dv">0</span>]],</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>    ys_to_rhs_major<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>],  <span class="co"># Y dimensions map to H dimensions</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>    ys_to_rhs_minor<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>tile_dist <span class="op">=</span> make_static_tile_distribution(encoding)</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tile window at position (2, 2)</span></span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> make_tile_window(</span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>    tensor_view<span class="op">=</span>tensor_view,</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>    window_lengths<span class="op">=</span>[<span class="dv">4</span>, <span class="dv">4</span>],</span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>    origin<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>    tile_distribution<span class="op">=</span>tile_dist</span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">TileWindow created:"</span>)</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Window size: </span><span class="sc">{</span>window<span class="sc">.</span>window_lengths<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Window origin: </span><span class="sc">{</span>window<span class="sc">.</span>window_origin<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Covers elements from (2,2) to (5,5)"</span>)</span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding Window Coordinates</span></span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a><span class="fu">### C++ Implementation Reference</span></span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>The TileWindow creation pattern shown above corresponds to the following C++ implementation:</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>**File**: <span class="in">`include/ck_tile/core/tensor/tile_window.hpp`</span></span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a><span class="co">// Creating a tile window in practice</span></span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> BlockTileShape<span class="op">,</span> <span class="kw">typename</span> DataType<span class="op">&gt;</span></span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>__device__ <span class="kw">auto</span> create_input_window<span class="op">(</span></span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> DataType<span class="op">*</span> <span class="ex">__restrict__</span> p_global<span class="op">,</span></span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index_t</span> M<span class="op">,</span> <span class="dt">index_t</span> N<span class="op">)</span></span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create tensor view</span></span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> tensor_view <span class="op">=</span> make_tensor_view<span class="op">&lt;</span>AddressSpaceEnum<span class="op">::</span>Global<span class="op">&gt;(</span></span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>        p_global<span class="op">,</span></span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a>        make_naive_tensor_descriptor_packed<span class="op">(</span>make_tuple<span class="op">(</span>M<span class="op">,</span> N<span class="op">)));</span></span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define window parameters</span></span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> window_lengths <span class="op">=</span> BlockTileShape<span class="op">{};</span></span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> origin <span class="op">=</span> make_tuple<span class="op">(</span>blockIdx<span class="op">.</span>x <span class="op">*</span> window_lengths<span class="op">[</span>I0<span class="op">],</span></span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>                                   blockIdx<span class="op">.</span>y <span class="op">*</span> window_lengths<span class="op">[</span>I1<span class="op">]);</span></span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create window with distribution</span></span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> make_tile_window<span class="op">(</span></span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>        tensor_view<span class="op">,</span></span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>        window_lengths<span class="op">,</span></span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>        origin<span class="op">,</span></span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>        make_static_tile_distribution<span class="op">(</span>TileDistribution<span class="op">{}));</span></span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>The window creation process demonstrates several important principles of the CK framework. First, the window dimensions (2×2 in this example) are chosen to match the tile distribution pattern, ensuring that each thread has work to do. Second, the origin coordinates allow the window to target specific regions of the tensor, enabling techniques like overlapped tiling for convolutions or sliding window operations. Third, the integration with tile distribution means that the window automatically knows how to map its data to the appropriate threads, eliminating the need for manual index calculations.</span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>In the C++ implementation, the tile window creation involves template instantiation that captures all these parameters at compile time:</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a><span class="co">// From ck_tile/core/tensor/tile_window.hpp</span></span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> TensorView<span class="op">,</span></span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> WindowLengths<span class="op">,</span></span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> Origin<span class="op">,</span></span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a>          <span class="kw">typename</span> Distribution<span class="op">&gt;</span></span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>CK_TILE_HOST_DEVICE <span class="kw">constexpr</span> <span class="kw">auto</span></span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>make_tile_window<span class="op">(</span><span class="at">const</span> TensorView<span class="op">&amp;</span> tensor_view<span class="op">,</span></span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>                 <span class="at">const</span> WindowLengths<span class="op">&amp;</span> window_lengths<span class="op">,</span></span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>                 <span class="at">const</span> Origin<span class="op">&amp;</span> origin<span class="op">,</span></span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a>                 <span class="at">const</span> Distribution<span class="op">&amp;</span> distribution<span class="op">)</span></span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create specialized window type based on distribution</span></span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> WindowType <span class="op">=</span> tile_window_with_static_distribution<span class="op">&lt;</span></span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>        TensorView<span class="op">,</span> WindowLengths<span class="op">,</span> Distribution<span class="op">&gt;;</span></span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Construct window with all parameters</span></span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> WindowType<span class="op">{</span>tensor_view<span class="op">,</span> window_lengths<span class="op">,</span> origin<span class="op">,</span> distribution<span class="op">};</span></span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading Data with TileWindow</span></span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a>The load operation represents one of the most critical performance-sensitive operations in GPU kernel development. TileWindow's load functionality transforms a high-level request ("load this tile of data") into a series of optimized memory transactions that respect GPU hardware constraints while maximizing bandwidth utilization. This transformation involves several sophisticated techniques working in concert to achieve near-optimal performance.</span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>The loading process begins with the tile window analyzing the distribution pattern to determine which data elements each thread needs to load. This analysis considers not just the logical mapping but also the physical memory layout, identifying opportunities for coalesced access where adjacent threads load from adjacent memory locations. The system then generates load instructions that take advantage of the GPU's memory subsystem capabilities, including vector loads that can fetch multiple elements in a single transaction.</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize what data the window covers</span></span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>window_data <span class="op">=</span> data[<span class="dv">2</span>:<span class="dv">6</span>, <span class="dv">2</span>:<span class="dv">6</span>]  <span class="co"># The 4x4 window starting at (2,2)</span></span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data covered by the window:"</span>)</span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(window_data)</span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Show how threads map to this data</span></span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Thread-to-element mapping:"</span>)</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Thread (i,j) -&gt; Element value"</span>)</span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>        thread_id <span class="op">=</span> i <span class="op">*</span> <span class="dv">4</span> <span class="op">+</span> j</span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>        element <span class="op">=</span> window_data[i, j]</span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Thread (</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">) -&gt; </span><span class="sc">{</span>element<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load Operation Architecture</span></span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Load Analysis"</span></span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a><span class="in">        Analyze["Analyze access pattern&lt;br/&gt;Detect coalescing opportunities"]</span></span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Vectorization"</span></span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a><span class="in">        V1["Scalar: 4 loads"]</span></span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a><span class="in">        V2["Vector2: 2 loads"]</span></span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a><span class="in">        V4["Vector4: 1 load"]</span></span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Memory Transaction"</span></span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a><span class="in">        Coal["Coalesced access&lt;br/&gt;32 threads → 1 transaction"]</span></span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a><span class="in">        NonCoal["Non-coalesced&lt;br/&gt;32 threads → 32 transactions"]</span></span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Result"</span></span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a><span class="in">        Reg["Thread registers&lt;br/&gt;Local data"]</span></span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a><span class="in">    Analyze --&gt; V1</span></span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a><span class="in">    Analyze --&gt; V2</span></span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a><span class="in">    Analyze --&gt; V4</span></span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a><span class="in">    V4 --&gt; Coal</span></span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a><span class="in">    V1 --&gt; NonCoal</span></span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a><span class="in">    Coal --&gt; Reg</span></span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a><span class="in">    NonCoal --&gt; Reg</span></span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a><span class="in">    style V4 fill:#d1fae5,stroke:#10b981,stroke-width:2px</span></span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a><span class="in">    style Coal fill:#d1fae5,stroke:#10b981,stroke-width:2px</span></span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a><span class="in">    style NonCoal fill:#fee2e2,stroke:#ef4444,stroke-width:2px</span></span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a><span class="fu">## Memory Access Patterns</span></span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>One of TileWindow's key features is generating optimal memory access patterns:</span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_window_access_pattern(window, num_threads<span class="op">=</span><span class="dv">16</span>):</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyze how threads access memory through the window"""</span></span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Memory Access Pattern Analysis"</span>)</span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate first wave of accesses</span></span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First access wave (threads 0-7):"</span>)</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Thread | Window Coord | Global Coord | Linear Addr"</span>)</span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>    origin <span class="op">=</span> window.window_origin</span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tid <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(<span class="dv">8</span>, num_threads)):</span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Thread position in window</span></span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>        local_i <span class="op">=</span> tid <span class="op">//</span> <span class="dv">4</span></span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>        local_j <span class="op">=</span> tid <span class="op">%</span> <span class="dv">4</span></span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Global position</span></span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>        global_i <span class="op">=</span> origin[<span class="dv">0</span>] <span class="op">+</span> local_i</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>        global_j <span class="op">=</span> origin[<span class="dv">1</span>] <span class="op">+</span> local_j</span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Linear address</span></span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>        linear_addr <span class="op">=</span> global_i <span class="op">*</span> <span class="dv">8</span> <span class="op">+</span> global_j  <span class="co"># 8 is tensor width</span></span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>tid<span class="sc">:2d}</span><span class="ss">   | (</span><span class="sc">{</span>local_i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>local_j<span class="sc">}</span><span class="ss">)        | (</span><span class="sc">{</span>global_i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>global_j<span class="sc">}</span><span class="ss">)        | </span><span class="sc">{</span>linear_addr<span class="sc">:3d}</span><span class="ss">"</span>)</span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check coalescing</span></span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Coalescing Analysis:"</span>)</span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✓ Threads 0-3 access addresses 18-21 (consecutive)"</span>)</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✓ Threads 4-7 access addresses 26-29 (consecutive)"</span>)</span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✓ Perfect coalescing within each warp!"</span>)</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>analyze_window_access_pattern(window)</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Window Operations</span></span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sliding Windows</span></span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate sliding window pattern</span></span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sliding_window_demo(tensor_shape, window_size, stride):</span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show how to slide a window across a tensor"""</span></span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sliding </span><span class="sc">{</span>window_size<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>window_size<span class="sc">}</span><span class="ss"> window with stride </span><span class="sc">{</span>stride<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Window positions:"</span>)</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> []</span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, tensor_shape[<span class="dv">0</span>] <span class="op">-</span> window_size <span class="op">+</span> <span class="dv">1</span>, stride):</span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, tensor_shape[<span class="dv">1</span>] <span class="op">-</span> window_size <span class="op">+</span> <span class="dv">1</span>, stride):</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>            positions.append((i, j))</span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Position (</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">) covers (</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">) to (</span><span class="sc">{</span>i<span class="op">+</span>window_size<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>j<span class="op">+</span>window_size<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> positions</span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sliding windows</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> sliding_window_demo(tensor_shape<span class="op">=</span>[<span class="dv">8</span>, <span class="dv">8</span>], window_size<span class="op">=</span><span class="dv">4</span>, stride<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total windows: </span><span class="sc">{</span><span class="bu">len</span>(positions)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overlapping Windows</span></span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate overlapping windows for convolution-like operations</span></span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_overlapping_windows(tensor_shape, window_size, overlap):</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create overlapping windows for operations like convolution"""</span></span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>    stride <span class="op">=</span> window_size <span class="op">-</span> overlap</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Creating </span><span class="sc">{</span>window_size<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>window_size<span class="sc">}</span><span class="ss"> windows with </span><span class="sc">{</span>overlap<span class="sc">}</span><span class="ss"> overlap"</span>)</span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Effective stride: </span><span class="sc">{</span>stride<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true" tabindex="-1"></a>    windows <span class="op">=</span> []</span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, tensor_shape[<span class="dv">0</span>] <span class="op">-</span> window_size <span class="op">+</span> <span class="dv">1</span>, stride):</span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, tensor_shape[<span class="dv">1</span>] <span class="op">-</span> window_size <span class="op">+</span> <span class="dv">1</span>, stride):</span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true" tabindex="-1"></a>            windows.append({</span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true" tabindex="-1"></a>                <span class="st">'origin'</span>: (i, j),</span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true" tabindex="-1"></a>                <span class="st">'overlap_left'</span>: j <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true" tabindex="-1"></a>                <span class="st">'overlap_top'</span>: i <span class="op">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true" tabindex="-1"></a>                <span class="st">'overlap_right'</span>: j <span class="op">+</span> window_size <span class="op">&lt;</span> tensor_shape[<span class="dv">1</span>],</span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true" tabindex="-1"></a>                <span class="st">'overlap_bottom'</span>: i <span class="op">+</span> window_size <span class="op">&lt;</span> tensor_shape[<span class="dv">0</span>]</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show overlap pattern</span></span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Window overlap pattern (</span><span class="sc">{</span><span class="bu">len</span>(windows)<span class="sc">}</span><span class="ss"> windows):"</span>)</span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, w <span class="kw">in</span> <span class="bu">enumerate</span>(windows[:<span class="dv">4</span>]):  <span class="co"># Show first few</span></span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true" tabindex="-1"></a>        overlaps <span class="op">=</span> []</span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> w[<span class="st">'overlap_left'</span>]: overlaps.append(<span class="st">'left'</span>)</span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> w[<span class="st">'overlap_top'</span>]: overlaps.append(<span class="st">'top'</span>)</span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> w[<span class="st">'overlap_right'</span>]: overlaps.append(<span class="st">'right'</span>)</span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> w[<span class="st">'overlap_bottom'</span>]: overlaps.append(<span class="st">'bottom'</span>)</span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Window </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>w[<span class="st">'origin'</span>]<span class="sc">}</span><span class="ss">: overlaps </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(overlaps) <span class="cf">if</span> overlaps <span class="cf">else</span> <span class="st">'none'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> windows</span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Create overlapping windows</span></span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true" tabindex="-1"></a>windows <span class="op">=</span> create_overlapping_windows([<span class="dv">8</span>, <span class="dv">8</span>], window_size<span class="op">=</span><span class="dv">3</span>, overlap<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true" tabindex="-1"></a><span class="fu">## Computation Architecture</span></span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Load Phase"</span></span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true" tabindex="-1"></a><span class="in">        LW["Load Window&lt;br/&gt;Global → Registers"]</span></span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Compute Phase"</span></span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true" tabindex="-1"></a><span class="in">        C1["Thread-local compute&lt;br/&gt;In registers"]</span></span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true" tabindex="-1"></a><span class="in">        C2["Warp-level shuffle&lt;br/&gt;Data exchange"]</span></span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true" tabindex="-1"></a><span class="in">        C3["Block-level reduction&lt;br/&gt;Shared memory"]</span></span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Store Phase"</span></span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true" tabindex="-1"></a><span class="in">        SW["Store Window&lt;br/&gt;Registers → Global"]</span></span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true" tabindex="-1"></a><span class="in">    LW --&gt; C1</span></span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true" tabindex="-1"></a><span class="in">    C1 --&gt; C2</span></span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true" tabindex="-1"></a><span class="in">    C2 --&gt; C3</span></span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true" tabindex="-1"></a><span class="in">    C3 --&gt; SW</span></span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true" tabindex="-1"></a><span class="in">    style LW fill:#e3f2fd,stroke:#1976d2,stroke-width:2px</span></span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true" tabindex="-1"></a><span class="in">    style C1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px</span></span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true" tabindex="-1"></a><span class="in">    style SW fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true" tabindex="-1"></a><span class="fu">## C++ Usage Example</span></span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true" tabindex="-1"></a>The real power of TileWindow comes from its C++ implementation:</span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true" tabindex="-1"></a><span class="in">```cpp</span></span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true" tabindex="-1"></a><span class="co">// Complete example: Matrix multiplication using TileWindow</span></span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> AType<span class="op">,</span> <span class="kw">typename</span> BType<span class="op">,</span> <span class="kw">typename</span> CType<span class="op">&gt;</span></span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true" tabindex="-1"></a>__global__ <span class="dt">void</span> gemm_kernel_with_windows<span class="op">(</span></span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> AType<span class="op">*</span> <span class="ex">__restrict__</span> a_ptr<span class="op">,</span></span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> BType<span class="op">*</span> <span class="ex">__restrict__</span> b_ptr<span class="op">,</span></span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true" tabindex="-1"></a>    CType<span class="op">*</span> <span class="ex">__restrict__</span> c_ptr<span class="op">,</span></span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true" tabindex="-1"></a>    <span class="dt">index_t</span> M<span class="op">,</span> <span class="dt">index_t</span> N<span class="op">,</span> <span class="dt">index_t</span> K<span class="op">)</span></span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create tensor views</span></span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_tensor <span class="op">=</span> make_naive_tensor_view<span class="op">(</span></span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true" tabindex="-1"></a>        a_ptr<span class="op">,</span> make_tuple<span class="op">(</span>M<span class="op">,</span> K<span class="op">),</span> make_tuple<span class="op">(</span>K<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_tensor <span class="op">=</span> make_naive_tensor_view<span class="op">(</span></span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true" tabindex="-1"></a>        b_ptr<span class="op">,</span> make_tuple<span class="op">(</span>K<span class="op">,</span> N<span class="op">),</span> make_tuple<span class="op">(</span>N<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_tensor <span class="op">=</span> make_naive_tensor_view<span class="op">(</span></span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true" tabindex="-1"></a>        c_ptr<span class="op">,</span> make_tuple<span class="op">(</span>M<span class="op">,</span> N<span class="op">),</span> make_tuple<span class="op">(</span>N<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define tile sizes</span></span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">index_t</span> tile_m <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">index_t</span> tile_n <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">index_t</span> tile_k <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb5-521"><a href="#cb5-521" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-522"><a href="#cb5-522" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create distributions</span></span>
<span id="cb5-523"><a href="#cb5-523" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_dist <span class="op">=</span> make_static_tile_distribution<span class="op">&lt;...&gt;();</span></span>
<span id="cb5-524"><a href="#cb5-524" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_dist <span class="op">=</span> make_static_tile_distribution<span class="op">&lt;...&gt;();</span></span>
<span id="cb5-525"><a href="#cb5-525" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_dist <span class="op">=</span> make_static_tile_distribution<span class="op">&lt;...&gt;();</span></span>
<span id="cb5-526"><a href="#cb5-526" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-527"><a href="#cb5-527" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate tile position</span></span>
<span id="cb5-528"><a href="#cb5-528" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">index_t</span> block_m <span class="op">=</span> blockIdx<span class="op">.</span>y <span class="op">*</span> tile_m<span class="op">;</span></span>
<span id="cb5-529"><a href="#cb5-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">index_t</span> block_n <span class="op">=</span> blockIdx<span class="op">.</span>x <span class="op">*</span> tile_n<span class="op">;</span></span>
<span id="cb5-530"><a href="#cb5-530" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-531"><a href="#cb5-531" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create tile windows</span></span>
<span id="cb5-532"><a href="#cb5-532" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_window <span class="op">=</span> make_tile_window<span class="op">(</span></span>
<span id="cb5-533"><a href="#cb5-533" aria-hidden="true" tabindex="-1"></a>        a_tensor<span class="op">,</span></span>
<span id="cb5-534"><a href="#cb5-534" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>tile_m<span class="op">,</span> tile_k<span class="op">),</span></span>
<span id="cb5-535"><a href="#cb5-535" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>block_m<span class="op">,</span> <span class="dv">0</span><span class="op">),</span></span>
<span id="cb5-536"><a href="#cb5-536" aria-hidden="true" tabindex="-1"></a>        a_dist<span class="op">);</span></span>
<span id="cb5-537"><a href="#cb5-537" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-538"><a href="#cb5-538" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_window <span class="op">=</span> make_tile_window<span class="op">(</span></span>
<span id="cb5-539"><a href="#cb5-539" aria-hidden="true" tabindex="-1"></a>        b_tensor<span class="op">,</span></span>
<span id="cb5-540"><a href="#cb5-540" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>tile_k<span class="op">,</span> tile_n<span class="op">),</span></span>
<span id="cb5-541"><a href="#cb5-541" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span><span class="dv">0</span><span class="op">,</span> block_n<span class="op">),</span></span>
<span id="cb5-542"><a href="#cb5-542" aria-hidden="true" tabindex="-1"></a>        b_dist<span class="op">);</span></span>
<span id="cb5-543"><a href="#cb5-543" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-544"><a href="#cb5-544" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_window <span class="op">=</span> make_tile_window<span class="op">(</span></span>
<span id="cb5-545"><a href="#cb5-545" aria-hidden="true" tabindex="-1"></a>        c_tensor<span class="op">,</span></span>
<span id="cb5-546"><a href="#cb5-546" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>tile_m<span class="op">,</span> tile_n<span class="op">),</span></span>
<span id="cb5-547"><a href="#cb5-547" aria-hidden="true" tabindex="-1"></a>        make_tuple<span class="op">(</span>block_m<span class="op">,</span> block_n<span class="op">),</span></span>
<span id="cb5-548"><a href="#cb5-548" aria-hidden="true" tabindex="-1"></a>        c_dist<span class="op">);</span></span>
<span id="cb5-549"><a href="#cb5-549" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-550"><a href="#cb5-550" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create distributed tensors for register storage</span></span>
<span id="cb5-551"><a href="#cb5-551" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_reg <span class="op">=</span> make_static_distributed_tensor<span class="op">&lt;</span>AType<span class="op">&gt;(</span>a_dist<span class="op">);</span></span>
<span id="cb5-552"><a href="#cb5-552" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> b_reg <span class="op">=</span> make_static_distributed_tensor<span class="op">&lt;</span>BType<span class="op">&gt;(</span>b_dist<span class="op">);</span></span>
<span id="cb5-553"><a href="#cb5-553" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> c_reg <span class="op">=</span> make_static_distributed_tensor<span class="op">&lt;</span>CType<span class="op">&gt;(</span>c_dist<span class="op">);</span></span>
<span id="cb5-554"><a href="#cb5-554" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-555"><a href="#cb5-555" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize accumulator</span></span>
<span id="cb5-556"><a href="#cb5-556" aria-hidden="true" tabindex="-1"></a>    c_reg<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb5-557"><a href="#cb5-557" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-558"><a href="#cb5-558" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Main GEMM loop</span></span>
<span id="cb5-559"><a href="#cb5-559" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">index_t</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> K<span class="op">;</span> k <span class="op">+=</span> tile_k<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-560"><a href="#cb5-560" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update window positions</span></span>
<span id="cb5-561"><a href="#cb5-561" aria-hidden="true" tabindex="-1"></a>        a_window<span class="op">.</span>set_window_origin<span class="op">(</span>make_tuple<span class="op">(</span><span class="dv">0</span><span class="op">,</span> k<span class="op">));</span></span>
<span id="cb5-562"><a href="#cb5-562" aria-hidden="true" tabindex="-1"></a>        b_window<span class="op">.</span>set_window_origin<span class="op">(</span>make_tuple<span class="op">(</span>k<span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb5-563"><a href="#cb5-563" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-564"><a href="#cb5-564" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Load tiles</span></span>
<span id="cb5-565"><a href="#cb5-565" aria-hidden="true" tabindex="-1"></a>        a_window<span class="op">.</span>load<span class="op">(</span>a_reg<span class="op">);</span></span>
<span id="cb5-566"><a href="#cb5-566" aria-hidden="true" tabindex="-1"></a>        b_window<span class="op">.</span>load<span class="op">(</span>b_reg<span class="op">);</span></span>
<span id="cb5-567"><a href="#cb5-567" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-568"><a href="#cb5-568" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Compute</span></span>
<span id="cb5-569"><a href="#cb5-569" aria-hidden="true" tabindex="-1"></a>        gemm<span class="op">(</span>a_reg<span class="op">,</span> b_reg<span class="op">,</span> c_reg<span class="op">);</span></span>
<span id="cb5-570"><a href="#cb5-570" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-571"><a href="#cb5-571" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-572"><a href="#cb5-572" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Store result</span></span>
<span id="cb5-573"><a href="#cb5-573" aria-hidden="true" tabindex="-1"></a>    c_window<span class="op">.</span>store<span class="op">(</span>c_reg<span class="op">);</span></span>
<span id="cb5-574"><a href="#cb5-574" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-575"><a href="#cb5-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-576"><a href="#cb5-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-577"><a href="#cb5-577" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load-Compute-Store Pipeline</span></span>
<span id="cb5-578"><a href="#cb5-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-579"><a href="#cb5-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-580"><a href="#cb5-580" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-581"><a href="#cb5-581" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb5-582"><a href="#cb5-582" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Iteration i"</span></span>
<span id="cb5-583"><a href="#cb5-583" aria-hidden="true" tabindex="-1"></a><span class="in">        L1["Load A[i]&lt;br/&gt;Load B[i]"]</span></span>
<span id="cb5-584"><a href="#cb5-584" aria-hidden="true" tabindex="-1"></a><span class="in">        C1["Compute&lt;br/&gt;C += A[i] × B[i]"]</span></span>
<span id="cb5-585"><a href="#cb5-585" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-586"><a href="#cb5-586" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-587"><a href="#cb5-587" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Iteration i+1"</span></span>
<span id="cb5-588"><a href="#cb5-588" aria-hidden="true" tabindex="-1"></a><span class="in">        L2["Load A[i+1]&lt;br/&gt;Load B[i+1]"]</span></span>
<span id="cb5-589"><a href="#cb5-589" aria-hidden="true" tabindex="-1"></a><span class="in">        C2["Compute&lt;br/&gt;C += A[i+1] × B[i+1]"]</span></span>
<span id="cb5-590"><a href="#cb5-590" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-591"><a href="#cb5-591" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-592"><a href="#cb5-592" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Final"</span></span>
<span id="cb5-593"><a href="#cb5-593" aria-hidden="true" tabindex="-1"></a><span class="in">        S["Store C"]</span></span>
<span id="cb5-594"><a href="#cb5-594" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-595"><a href="#cb5-595" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-596"><a href="#cb5-596" aria-hidden="true" tabindex="-1"></a><span class="in">    L1 --&gt; C1</span></span>
<span id="cb5-597"><a href="#cb5-597" aria-hidden="true" tabindex="-1"></a><span class="in">    C1 --&gt; L2</span></span>
<span id="cb5-598"><a href="#cb5-598" aria-hidden="true" tabindex="-1"></a><span class="in">    L2 --&gt; C2</span></span>
<span id="cb5-599"><a href="#cb5-599" aria-hidden="true" tabindex="-1"></a><span class="in">    C2 --&gt; S</span></span>
<span id="cb5-600"><a href="#cb5-600" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-601"><a href="#cb5-601" aria-hidden="true" tabindex="-1"></a><span class="in">    style L1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px</span></span>
<span id="cb5-602"><a href="#cb5-602" aria-hidden="true" tabindex="-1"></a><span class="in">    style C1 fill:#fff3e0,stroke:#f57c00,stroke-width:2px</span></span>
<span id="cb5-603"><a href="#cb5-603" aria-hidden="true" tabindex="-1"></a><span class="in">    style S fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb5-604"><a href="#cb5-604" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-605"><a href="#cb5-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-606"><a href="#cb5-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-607"><a href="#cb5-607" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pipeline Optimization</span></span>
<span id="cb5-608"><a href="#cb5-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-609"><a href="#cb5-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-610"><a href="#cb5-610" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-611"><a href="#cb5-611" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb5-612"><a href="#cb5-612" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Basic Pipeline"</span></span>
<span id="cb5-613"><a href="#cb5-613" aria-hidden="true" tabindex="-1"></a><span class="in">        B1["Load"] --&gt; B2["Compute"] --&gt; B3["Store"]</span></span>
<span id="cb5-614"><a href="#cb5-614" aria-hidden="true" tabindex="-1"></a><span class="in">        BTime["Time: 3 units"]</span></span>
<span id="cb5-615"><a href="#cb5-615" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-616"><a href="#cb5-616" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-617"><a href="#cb5-617" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Software Pipelining"</span></span>
<span id="cb5-618"><a href="#cb5-618" aria-hidden="true" tabindex="-1"></a><span class="in">        P1["Load[i+1]"]</span></span>
<span id="cb5-619"><a href="#cb5-619" aria-hidden="true" tabindex="-1"></a><span class="in">        P2["Compute[i]"]</span></span>
<span id="cb5-620"><a href="#cb5-620" aria-hidden="true" tabindex="-1"></a><span class="in">        P3["Store[i-1]"]</span></span>
<span id="cb5-621"><a href="#cb5-621" aria-hidden="true" tabindex="-1"></a><span class="in">        PTime["Time: 1 unit per iteration"]</span></span>
<span id="cb5-622"><a href="#cb5-622" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-623"><a href="#cb5-623" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-624"><a href="#cb5-624" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Double Buffering"</span></span>
<span id="cb5-625"><a href="#cb5-625" aria-hidden="true" tabindex="-1"></a><span class="in">        DB1["Buffer A: Load"]</span></span>
<span id="cb5-626"><a href="#cb5-626" aria-hidden="true" tabindex="-1"></a><span class="in">        DB2["Buffer B: Compute"]</span></span>
<span id="cb5-627"><a href="#cb5-627" aria-hidden="true" tabindex="-1"></a><span class="in">        DBSwap["Swap buffers"]</span></span>
<span id="cb5-628"><a href="#cb5-628" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-629"><a href="#cb5-629" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-630"><a href="#cb5-630" aria-hidden="true" tabindex="-1"></a><span class="in">    B3 --&gt; P1</span></span>
<span id="cb5-631"><a href="#cb5-631" aria-hidden="true" tabindex="-1"></a><span class="in">    P1 --&gt; P2</span></span>
<span id="cb5-632"><a href="#cb5-632" aria-hidden="true" tabindex="-1"></a><span class="in">    P2 --&gt; P3</span></span>
<span id="cb5-633"><a href="#cb5-633" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-634"><a href="#cb5-634" aria-hidden="true" tabindex="-1"></a><span class="in">    P3 --&gt; DB1</span></span>
<span id="cb5-635"><a href="#cb5-635" aria-hidden="true" tabindex="-1"></a><span class="in">    DB1 --&gt; DB2</span></span>
<span id="cb5-636"><a href="#cb5-636" aria-hidden="true" tabindex="-1"></a><span class="in">    DB2 --&gt; DBSwap</span></span>
<span id="cb5-637"><a href="#cb5-637" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-638"><a href="#cb5-638" aria-hidden="true" tabindex="-1"></a><span class="in">    style P1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px</span></span>
<span id="cb5-639"><a href="#cb5-639" aria-hidden="true" tabindex="-1"></a><span class="in">    style P2 fill:#fff3e0,stroke:#f57c00,stroke-width:2px</span></span>
<span id="cb5-640"><a href="#cb5-640" aria-hidden="true" tabindex="-1"></a><span class="in">    style P3 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px</span></span>
<span id="cb5-641"><a href="#cb5-641" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-642"><a href="#cb5-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-643"><a href="#cb5-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-644"><a href="#cb5-644" aria-hidden="true" tabindex="-1"></a><span class="fu">## Window Configuration Space</span></span>
<span id="cb5-645"><a href="#cb5-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-646"><a href="#cb5-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-647"><a href="#cb5-647" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class="mermaid"&gt;</span></span>
<span id="cb5-648"><a href="#cb5-648" aria-hidden="true" tabindex="-1"></a><span class="in">graph TB</span></span>
<span id="cb5-649"><a href="#cb5-649" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Window Parameters"</span></span>
<span id="cb5-650"><a href="#cb5-650" aria-hidden="true" tabindex="-1"></a><span class="in">        Size["Window Size&lt;br/&gt;Trade-off: registers vs reuse"]</span></span>
<span id="cb5-651"><a href="#cb5-651" aria-hidden="true" tabindex="-1"></a><span class="in">        Origin["Window Origin&lt;br/&gt;Starting position"]</span></span>
<span id="cb5-652"><a href="#cb5-652" aria-hidden="true" tabindex="-1"></a><span class="in">        Stride["Window Stride&lt;br/&gt;Overlap pattern"]</span></span>
<span id="cb5-653"><a href="#cb5-653" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-654"><a href="#cb5-654" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-655"><a href="#cb5-655" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Performance Factors"</span></span>
<span id="cb5-656"><a href="#cb5-656" aria-hidden="true" tabindex="-1"></a><span class="in">        Reg["Register Usage&lt;br/&gt;Limited resource"]</span></span>
<span id="cb5-657"><a href="#cb5-657" aria-hidden="true" tabindex="-1"></a><span class="in">        Reuse["Data Reuse&lt;br/&gt;Bandwidth savings"]</span></span>
<span id="cb5-658"><a href="#cb5-658" aria-hidden="true" tabindex="-1"></a><span class="in">        Coal["Coalescing&lt;br/&gt;Memory efficiency"]</span></span>
<span id="cb5-659"><a href="#cb5-659" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-660"><a href="#cb5-660" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-661"><a href="#cb5-661" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph "Optimal Configuration"</span></span>
<span id="cb5-662"><a href="#cb5-662" aria-hidden="true" tabindex="-1"></a><span class="in">        Opt["Balance all factors&lt;br/&gt;Architecture-specific"]</span></span>
<span id="cb5-663"><a href="#cb5-663" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb5-664"><a href="#cb5-664" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-665"><a href="#cb5-665" aria-hidden="true" tabindex="-1"></a><span class="in">    Size --&gt; Reg</span></span>
<span id="cb5-666"><a href="#cb5-666" aria-hidden="true" tabindex="-1"></a><span class="in">    Size --&gt; Reuse</span></span>
<span id="cb5-667"><a href="#cb5-667" aria-hidden="true" tabindex="-1"></a><span class="in">    Origin --&gt; Coal</span></span>
<span id="cb5-668"><a href="#cb5-668" aria-hidden="true" tabindex="-1"></a><span class="in">    Stride --&gt; Reuse</span></span>
<span id="cb5-669"><a href="#cb5-669" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-670"><a href="#cb5-670" aria-hidden="true" tabindex="-1"></a><span class="in">    Reg --&gt; Opt</span></span>
<span id="cb5-671"><a href="#cb5-671" aria-hidden="true" tabindex="-1"></a><span class="in">    Reuse --&gt; Opt</span></span>
<span id="cb5-672"><a href="#cb5-672" aria-hidden="true" tabindex="-1"></a><span class="in">    Coal --&gt; Opt</span></span>
<span id="cb5-673"><a href="#cb5-673" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb5-674"><a href="#cb5-674" aria-hidden="true" tabindex="-1"></a><span class="in">    style Opt fill:#d1fae5,stroke:#10b981,stroke-width:3px</span></span>
<span id="cb5-675"><a href="#cb5-675" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/div&gt;</span></span>
<span id="cb5-676"><a href="#cb5-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-677"><a href="#cb5-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-678"><a href="#cb5-678" aria-hidden="true" tabindex="-1"></a><span class="fu">## Best Practices</span></span>
<span id="cb5-679"><a href="#cb5-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-680"><a href="#cb5-680" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Window Size Selection</span></span>
<span id="cb5-681"><a href="#cb5-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-684"><a href="#cb5-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-685"><a href="#cb5-685" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-686"><a href="#cb5-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-687"><a href="#cb5-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-688"><a href="#cb5-688" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_window_size(tensor_shape, available_registers, elements_per_thread):</span>
<span id="cb5-689"><a href="#cb5-689" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Recommend optimal window size based on constraints"""</span></span>
<span id="cb5-690"><a href="#cb5-690" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Window Size Recommendation"</span>)</span>
<span id="cb5-691"><a href="#cb5-691" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb5-692"><a href="#cb5-692" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tensor shape: </span><span class="sc">{</span>tensor_shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-693"><a href="#cb5-693" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Available registers per thread: </span><span class="sc">{</span>available_registers<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-694"><a href="#cb5-694" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Elements per thread: </span><span class="sc">{</span>elements_per_thread<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-695"><a href="#cb5-695" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-696"><a href="#cb5-696" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate maximum window size based on register constraints</span></span>
<span id="cb5-697"><a href="#cb5-697" aria-hidden="true" tabindex="-1"></a>    max_window_elements <span class="op">=</span> available_registers <span class="op">//</span> elements_per_thread</span>
<span id="cb5-698"><a href="#cb5-698" aria-hidden="true" tabindex="-1"></a>    max_window_dim <span class="op">=</span> <span class="bu">int</span>(max_window_elements <span class="op">**</span> <span class="fl">0.5</span>)</span>
<span id="cb5-699"><a href="#cb5-699" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-700"><a href="#cb5-700" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Consider common tile sizes</span></span>
<span id="cb5-701"><a href="#cb5-701" aria-hidden="true" tabindex="-1"></a>    common_sizes <span class="op">=</span> [<span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>]</span>
<span id="cb5-702"><a href="#cb5-702" aria-hidden="true" tabindex="-1"></a>    recommended <span class="op">=</span> []</span>
<span id="cb5-703"><a href="#cb5-703" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-704"><a href="#cb5-704" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> size <span class="kw">in</span> common_sizes:</span>
<span id="cb5-705"><a href="#cb5-705" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> size <span class="op">&lt;=</span> max_window_dim <span class="kw">and</span> <span class="bu">all</span>(dim <span class="op">%</span> size <span class="op">==</span> <span class="dv">0</span> <span class="cf">for</span> dim <span class="kw">in</span> tensor_shape):</span>
<span id="cb5-706"><a href="#cb5-706" aria-hidden="true" tabindex="-1"></a>            recommended.append(size)</span>
<span id="cb5-707"><a href="#cb5-707" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-708"><a href="#cb5-708" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Recommended window sizes: </span><span class="sc">{</span>recommended<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-709"><a href="#cb5-709" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recommended:</span>
<span id="cb5-710"><a href="#cb5-710" aria-hidden="true" tabindex="-1"></a>        optimal <span class="op">=</span> recommended[<span class="op">-</span><span class="dv">1</span>]  <span class="co"># Largest that fits</span></span>
<span id="cb5-711"><a href="#cb5-711" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Optimal choice: </span><span class="sc">{</span>optimal<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>optimal<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-712"><a href="#cb5-712" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Uses </span><span class="sc">{</span>optimal<span class="op">*</span>optimal<span class="op">*</span>elements_per_thread<span class="sc">}</span><span class="ss"> registers per thread"</span>)</span>
<span id="cb5-713"><a href="#cb5-713" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Achieves </span><span class="sc">{</span>(optimal<span class="op">*</span>optimal)<span class="op">/</span>max_window_elements<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% register utilization"</span>)</span>
<span id="cb5-714"><a href="#cb5-714" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-715"><a href="#cb5-715" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> recommended</span>
<span id="cb5-716"><a href="#cb5-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-717"><a href="#cb5-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Example recommendation</span></span>
<span id="cb5-718"><a href="#cb5-718" aria-hidden="true" tabindex="-1"></a>recommend_window_size(</span>
<span id="cb5-719"><a href="#cb5-719" aria-hidden="true" tabindex="-1"></a>    tensor_shape<span class="op">=</span>[<span class="dv">256</span>, <span class="dv">256</span>],</span>
<span id="cb5-720"><a href="#cb5-720" aria-hidden="true" tabindex="-1"></a>    available_registers<span class="op">=</span><span class="dv">256</span>,</span>
<span id="cb5-721"><a href="#cb5-721" aria-hidden="true" tabindex="-1"></a>    elements_per_thread<span class="op">=</span><span class="dv">4</span></span>
<span id="cb5-722"><a href="#cb5-722" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-723"><a href="#cb5-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-724"><a href="#cb5-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-725"><a href="#cb5-725" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Access Pattern Optimization</span></span>
<span id="cb5-726"><a href="#cb5-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-729"><a href="#cb5-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{pyodide}</span></span>
<span id="cb5-730"><a href="#cb5-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb5-731"><a href="#cb5-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb5-732"><a href="#cb5-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-733"><a href="#cb5-733" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_access_pattern(window_shape, thread_block_shape):</span>
<span id="cb5-734"><a href="#cb5-734" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Determine optimal access pattern for coalescing"""</span></span>
<span id="cb5-735"><a href="#cb5-735" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Access Pattern Optimization"</span>)</span>
<span id="cb5-736"><a href="#cb5-736" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb5-737"><a href="#cb5-737" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Window shape: </span><span class="sc">{</span>window_shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-738"><a href="#cb5-738" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Thread block: </span><span class="sc">{</span>thread_block_shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-739"><a href="#cb5-739" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-740"><a href="#cb5-740" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate threads per row for coalescing</span></span>
<span id="cb5-741"><a href="#cb5-741" aria-hidden="true" tabindex="-1"></a>    threads_per_row <span class="op">=</span> thread_block_shape[<span class="dv">1</span>]</span>
<span id="cb5-742"><a href="#cb5-742" aria-hidden="true" tabindex="-1"></a>    elements_per_row <span class="op">=</span> window_shape[<span class="dv">1</span>]</span>
<span id="cb5-743"><a href="#cb5-743" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-744"><a href="#cb5-744" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> elements_per_row <span class="op">%</span> threads_per_row <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-745"><a href="#cb5-745" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">✓ Perfect coalescing possible!"</span>)</span>
<span id="cb5-746"><a href="#cb5-746" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Each thread loads </span><span class="sc">{</span>elements_per_row <span class="op">//</span> threads_per_row<span class="sc">}</span><span class="ss"> consecutive elements"</span>)</span>
<span id="cb5-747"><a href="#cb5-747" aria-hidden="true" tabindex="-1"></a>        access_pattern <span class="op">=</span> <span class="st">"row-major coalesced"</span></span>
<span id="cb5-748"><a href="#cb5-748" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-749"><a href="#cb5-749" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">⚠ Partial coalescing"</span>)</span>
<span id="cb5-750"><a href="#cb5-750" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  Consider adjusting window or thread block dimensions"</span>)</span>
<span id="cb5-751"><a href="#cb5-751" aria-hidden="true" tabindex="-1"></a>        access_pattern <span class="op">=</span> <span class="st">"row-major partial"</span></span>
<span id="cb5-752"><a href="#cb5-752" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-753"><a href="#cb5-753" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Suggest vectorization</span></span>
<span id="cb5-754"><a href="#cb5-754" aria-hidden="true" tabindex="-1"></a>    vector_sizes <span class="op">=</span> [<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb5-755"><a href="#cb5-755" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> vec_size <span class="kw">in</span> vector_sizes:</span>
<span id="cb5-756"><a href="#cb5-756" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> elements_per_row <span class="op">%</span> (threads_per_row <span class="op">*</span> vec_size) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-757"><a href="#cb5-757" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Vectorization: Use float</span><span class="sc">{</span>vec_size<span class="sc">}</span><span class="ss"> for optimal loads"</span>)</span>
<span id="cb5-758"><a href="#cb5-758" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>elements_per_row <span class="op">//</span> (threads_per_row <span class="op">*</span> vec_size)<span class="sc">}</span><span class="ss"> vector loads per thread"</span>)</span>
<span id="cb5-759"><a href="#cb5-759" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb5-760"><a href="#cb5-760" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-761"><a href="#cb5-761" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> access_pattern</span>
<span id="cb5-762"><a href="#cb5-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-763"><a href="#cb5-763" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimize for common configurations</span></span>
<span id="cb5-764"><a href="#cb5-764" aria-hidden="true" tabindex="-1"></a>optimize_access_pattern(</span>
<span id="cb5-765"><a href="#cb5-765" aria-hidden="true" tabindex="-1"></a>    window_shape<span class="op">=</span>[<span class="dv">32</span>, <span class="dv">32</span>],</span>
<span id="cb5-766"><a href="#cb5-766" aria-hidden="true" tabindex="-1"></a>    thread_block_shape<span class="op">=</span>[<span class="dv">8</span>, <span class="dv">32</span>]</span>
<span id="cb5-767"><a href="#cb5-767" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-768"><a href="#cb5-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-769"><a href="#cb5-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-770"><a href="#cb5-770" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb5-771"><a href="#cb5-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-772"><a href="#cb5-772" aria-hidden="true" tabindex="-1"></a>TileWindow provides:</span>
<span id="cb5-773"><a href="#cb5-773" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Automatic optimization**: Generates optimal memory access patterns</span>
<span id="cb5-774"><a href="#cb5-774" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Distribution awareness**: Works seamlessly with TileDistribution</span>
<span id="cb5-775"><a href="#cb5-775" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flexible windowing**: Supports various access patterns and window configurations</span>
<span id="cb5-776"><a href="#cb5-776" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Zero overhead**: Compile-time optimization in C++</span>
<span id="cb5-777"><a href="#cb5-777" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Safety**: Automatic boundary handling</span>
<span id="cb5-778"><a href="#cb5-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-779"><a href="#cb5-779" aria-hidden="true" tabindex="-1"></a>Key benefits:</span>
<span id="cb5-780"><a href="#cb5-780" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Performance**: Achieves peak memory bandwidth through coalescing and vectorization</span>
<span id="cb5-781"><a href="#cb5-781" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Productivity**: Eliminates manual memory management code</span>
<span id="cb5-782"><a href="#cb5-782" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Correctness**: Automatic boundary checking and handling</span>
<span id="cb5-783"><a href="#cb5-783" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Composability**: Integrates cleanly with other CK abstractions</span>
<span id="cb5-784"><a href="#cb5-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-785"><a href="#cb5-785" aria-hidden="true" tabindex="-1"></a>The TileWindow abstraction is essential for building high-performance GPU kernels, providing a clean interface for complex memory access patterns while maintaining peak performance.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script src="font-cleanup.js"></script>




</body></html>